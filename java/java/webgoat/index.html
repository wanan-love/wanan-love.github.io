<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>webgoat分析 | wanan</title><meta name="keywords" content="java,代码审计,webgoat分析"><meta name="author" content="wanan"><meta name="copyright" content="wanan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="安装webgoat下载源码 https:&#x2F;&#x2F;github.com&#x2F;WebGoat&#x2F;WebGoat.git  下载mvn  环境变量  mvn -v   idea打开  jdk设置为17  改一下构建工具  下载依赖  我也是莫名其妙下完的,刚学这个不太懂 找到这个目录点这个箭头,如果下载完成了的话构建就会正常的    这样做主要是因为spring boot没学过,不会配置 MyWebGoat 这里">
<meta property="og:type" content="article">
<meta property="og:title" content="webgoat分析">
<meta property="og:url" content="https://www.wanan.red/java/java/webgoat/index.html">
<meta property="og:site_name" content="wanan">
<meta property="og:description" content="安装webgoat下载源码 https:&#x2F;&#x2F;github.com&#x2F;WebGoat&#x2F;WebGoat.git  下载mvn  环境变量  mvn -v   idea打开  jdk设置为17  改一下构建工具  下载依赖  我也是莫名其妙下完的,刚学这个不太懂 找到这个目录点这个箭头,如果下载完成了的话构建就会正常的    这样做主要是因为spring boot没学过,不会配置 MyWebGoat 这里">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg">
<meta property="article:published_time" content="2022-08-30T05:27:58.743Z">
<meta property="article:modified_time" content="2022-08-30T05:33:51.923Z">
<meta property="article:author" content="wanan">
<meta property="article:tag" content="java">
<meta property="article:tag" content="代码审计">
<meta property="article:tag" content="webgoat分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg"><link rel="shortcut icon" href="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092159138.jpeg"><link rel="canonical" href="https://www.wanan.red/java/java/webgoat/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="Lkrie_55AalLqll4AtBs-NEomlv8QQYHGMx1V0cbq88"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'webgoat分析',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-30 13:33:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/202203092159138.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">82</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">64</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">wanan</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">webgoat分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-30T05:27:58.743Z" title="发表于 2022-08-30 13:27:58">2022-08-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-30T05:33:51.923Z" title="更新于 2022-08-30 13:33:51">2022-08-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>140分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="webgoat分析"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="安装webgoat"><a href="#安装webgoat" class="headerlink" title="安装webgoat"></a>安装webgoat</h1><p>下载源码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/WebGoat/WebGoat.git</span><br></pre></td></tr></table></figure>

<p>下载mvn</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524163535138.png" alt="image-20220524163535138"></p>
<p>环境变量</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524163613082.png" alt="image-20220524163613082"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524163638372.png" alt="image-20220524163638372"></p>
<p>idea打开</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524192934466.png" alt="image-20220524192934466"></p>
<p>jdk设置为17</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524192952447.png" alt="image-20220524192952447"></p>
<p>改一下构建工具</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524193029108.png" alt="image-20220524193029108"></p>
<p>下载依赖</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524193046703.png" alt="image-20220524193046703"></p>
<p>我也是莫名其妙下完的,刚学这个不太懂</p>
<p>找到这个目录点这个箭头,如果下载完成了的话构建就会正常的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524193157199.png" alt="image-20220524193157199"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524193241713.png" alt="image-20220524193241713"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220524193247826.png" alt="image-20220524193247826"></p>
<p>这样做主要是因为spring boot没学过,不会配置</p>
<h1 id="MyWebGoat"><a href="#MyWebGoat" class="headerlink" title="MyWebGoat"></a>MyWebGoat</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702155125505.png" alt="image-20220702155125505"></p>
<p>这里先了解了一些pom.xml的语法规则</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702132857005.png" alt="image-20220702132857005"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41570658/article/details/120646393">https://blog.csdn.net/qq_41570658/article/details/120646393</a></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702145820274.png" alt="image-20220702145820274"></p>
<p>propertiesw文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.error.include-stacktrace</span>=<span class="string">always</span></span><br><span class="line"><span class="comment">#显示异常堆栈信息</span></span><br><span class="line"><span class="attr">server.error.path</span>=<span class="string">/error.html</span></span><br><span class="line"><span class="comment">#writelabel的默认路径是error.可以通过设置server.error.path参数自定义错误页面</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.servlet.context-path</span>=<span class="string">/WebGoat</span></span><br><span class="line"><span class="comment">#设置应用的上下文路径,项目的路径作为url地址的一部分</span></span><br><span class="line"><span class="attr">server.servlet.session.persistent</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#server.servlet.session.persistent默认值为false，但会持久化，需要在配置文件中重新配置为false，才会不持久化。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">$&#123;webgoat.port:8080&#125;</span></span><br><span class="line"><span class="comment">#服务器端口 这里就相当于如果webgoat.port有配置就使用webgoat.prot 如果没有配置就使用8080</span></span><br><span class="line"><span class="attr">server.address</span>=<span class="string">$&#123;webgoat.host&#125;</span></span><br><span class="line"><span class="comment">#服务器ip</span></span><br><span class="line"></span><br><span class="line"><span class="attr">webgoat.host</span>=<span class="string">$&#123;WEBGOAT_HOST:127.0.0.1&#125;</span></span><br><span class="line"><span class="comment">#服务器ip</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">WebGoat</span></span><br><span class="line"><span class="comment">#是用来代表服务名的</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.ssl.key-store-type</span>=<span class="string">$&#123;WEBGOAT_KEYSTORE_TYPE:PKCS12&#125;</span></span><br><span class="line"><span class="comment">#ssl证书的类型PKCS12</span></span><br><span class="line"><span class="attr">server.ssl.key-store</span>=<span class="string">$&#123;WEBGOAT_KEYSTORE:classpath:goatkeystore.pkcs12&#125;</span></span><br><span class="line"><span class="comment">#ssl证书的路径</span></span><br><span class="line"><span class="attr">server.ssl.key-store-password</span>=<span class="string">$&#123;WEBGOAT_KEYSTORE_PASSWORD:password&#125;</span></span><br><span class="line"><span class="comment">#ssl保存证书密钥库的密码</span></span><br><span class="line"><span class="attr">server.ssl.key-alias</span>=<span class="string">$&#123;WEBGOAT_KEY_ALIAS:goat&#125;</span></span><br><span class="line"><span class="comment">#ssl标识密钥库中密钥的别名</span></span><br><span class="line"><span class="attr">server.ssl.enabled</span>=<span class="string">$&#123;WEBGOAT_SSLENABLED:false&#125;</span></span><br><span class="line"><span class="comment">#是否启用ssl支持</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:hsqldb:file:$&#123;webgoat.server.directory&#125;/webgoat</span></span><br><span class="line"><span class="comment">#连接数据库的路径</span></span><br><span class="line"><span class="attr">spring.jpa.properties.hibernate.dialect</span>=<span class="string">org.hibernate.dialect.HSQLDialect</span></span><br><span class="line"><span class="comment">#使用的jpa语言是什么</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">org.hsqldb.jdbc.JDBCDriver</span></span><br><span class="line"><span class="comment">#使用的驱动名称</span></span><br><span class="line"><span class="attr">spring.jpa.properties.hibernate.default_schema</span>=<span class="string">CONTAINER</span></span><br><span class="line"><span class="attr">spring.banner.location</span>=<span class="string">classpath:banner.txt</span></span><br><span class="line"><span class="comment">#这个是启动时的文字图片</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging.level.org.thymeleaf</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment">#thymeleaf 支持 trace、debug、info级别的日志信息</span></span><br><span class="line"><span class="attr">logging.level.org.thymeleaf.TemplateEngine.CONFIG</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment">#初始化期间输出详细配置信息</span></span><br><span class="line"><span class="attr">logging.level.org.thymeleaf.TemplateEngine.TIMER</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment">#输出模板引擎执行时间</span></span><br><span class="line"><span class="attr">logging.level.org.thymeleaf.TemplateEngine.cache.TEMPLATE_CACHE</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment">#输出模板表达式缓存信息</span></span><br><span class="line"><span class="attr">logging.level.org.springframework.web</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment">#org.springframework.web包下的日志以info级别输出</span></span><br><span class="line"><span class="attr">logging.level.org.springframework</span>=<span class="string">INFO</span></span><br><span class="line"><span class="attr">logging.level.org.springframework.boot.devtools</span>=<span class="string">INFO</span></span><br><span class="line"><span class="attr">logging.level.org.owasp</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">logging.level.org.owasp.webgoat</span>=<span class="string">DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="attr">webgoat.server.directory</span>=<span class="string">$&#123;user.home&#125;/.webgoat-$&#123;webgoat.build.version&#125;/</span></span><br><span class="line"><span class="comment">#webgoat.server.directory的目录</span></span><br><span class="line"><span class="attr">webgoat.user.directory</span>=<span class="string">$&#123;user.home&#125;/.webgoat-$&#123;webgoat.build.version&#125;/</span></span><br><span class="line"><span class="comment">#webgoat.user.directory的目录</span></span><br><span class="line"><span class="attr">webgoat.build.version</span>=<span class="string">@project.version@</span></span><br><span class="line"><span class="comment">#这里也就是从pom.xml中取出版本</span></span><br><span class="line"><span class="attr">webgoat.email</span>=<span class="string">webgoat@owasp.org</span></span><br><span class="line"><span class="attr">webgoat.emaillist</span>=<span class="string">owasp-webgoat@lists.owasp.org</span></span><br><span class="line"><span class="attr">webgoat.feedback.address</span>=<span class="string">webgoat@owasp.org</span></span><br><span class="line"><span class="attr">webgoat.feedback.address.html</span>=<span class="string">&lt;A HREF=mailto:webgoat@owasp.org&gt;webgoat@owasp.org&lt;/A&gt;</span></span><br><span class="line"><span class="attr">webgoat.database.connection.string</span>=<span class="string">jdbc:hsqldb:mem:&#123;USER&#125;</span></span><br><span class="line"><span class="attr">webgoat.default.language</span>=<span class="string">en</span></span><br><span class="line"></span><br><span class="line"><span class="attr">webwolf.host</span>=<span class="string">$&#123;WEBWOLF_HOST:127.0.0.1&#125;</span></span><br><span class="line"><span class="comment">#webwolf的ip</span></span><br><span class="line"><span class="attr">webwolf.port</span>=<span class="string">$&#123;WEBWOLF_PORT:9090&#125;</span></span><br><span class="line"><span class="comment">#webwolf的端口</span></span><br><span class="line"><span class="attr">webwolf.url</span>=<span class="string">http://$&#123;webwolf.host&#125;:$&#123;webwolf.port&#125;</span></span><br><span class="line"><span class="comment">#webwolf的url</span></span><br><span class="line"><span class="attr">webwolf.landingpage.url</span>=<span class="string">$&#123;webwolf.url&#125;/landing</span></span><br><span class="line"></span><br><span class="line"><span class="attr">webwolf.mail.url</span>=<span class="string">$&#123;webwolf.url&#125;/mail</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.jackson.serialization.indent_output</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#忽略无法转换的对象</span></span><br><span class="line"><span class="attr">spring.jackson.serialization.write-dates-as-timestamps</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#将date转换为时间戳</span></span><br><span class="line"><span class="comment">#For static file refresh ... and faster dev :D</span></span><br><span class="line"><span class="attr">spring.devtools.restart.additional-paths</span>=<span class="string">webgoat-container/src/main/resources/static/js,webgoat-container/src/main/resources/static/css</span></span><br><span class="line"><span class="comment">#添加的路径</span></span><br><span class="line"><span class="attr">exclude.categories</span>=<span class="string">$&#123;EXCLUDE_CATEGORIES:none,none&#125;</span></span><br><span class="line"><span class="comment">#exclude based on the enum of the Category</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exclude.lessons</span>=<span class="string">$&#123;EXCLUDE_LESSONS:none,none&#125;</span></span><br><span class="line"><span class="comment">#exclude based on the class name of a lesson e.g.: LessonTemplate</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.health.db.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#启用开发者配置内容的健康指标</span></span><br><span class="line"><span class="attr">management.endpoint.health.show-details</span>=<span class="string">always</span></span><br><span class="line"><span class="comment">#health端点公开的信息可以配置 详细信息显示给所有用户</span></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">env, health,configprops</span></span><br><span class="line"><span class="comment">#暴露需要监控的接口</span></span><br></pre></td></tr></table></figure>

<h1 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702153801895.png" alt="image-20220702153801895"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702153838830.png" alt="image-20220702153838830"></p>
<p>会发现添加了一个依赖项目</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702153910207.png" alt="image-20220702153910207"></p>
<p>源码下载</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn dependency:resolve -Dclassifier=sources</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702160618821.png" alt="image-20220702160618821"></p>
<h2 id="server-StartWebGoat"><a href="#server-StartWebGoat" class="headerlink" title="server.StartWebGoat"></a>server.StartWebGoat</h2><p>从这里开始并不是直接写完这个一个startwebGoat文件的,而是从这里遇到新的就去写.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.server;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.WebGoat;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.WebApplicationType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.SocketUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Optional.of;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Optional.ofNullable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartWebGoat</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WEBGOAT_PORT</span> <span class="operator">=</span> <span class="string">&quot;webgoat.port&quot;</span>;</span><br><span class="line">    <span class="comment">//    定义webgoat的字符</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_PORT</span> <span class="operator">=</span> <span class="number">9999</span>;</span><br><span class="line">    <span class="comment">//    定义最大端口</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        setEnvironmentVariableForPort(WEBGOAT_PORT,<span class="string">&quot;8080&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>().parent(ParentConfig.class)<span class="comment">//使用Parentconfig配置类</span></span><br><span class="line">                .web(WebApplicationType.NONE).bannerMode(Banner.Mode.OFF)<span class="comment">//不启动内嵌的WebServer，不是运行web application   banner也就是启动的那个图</span></span><br><span class="line">                .child(WebGoat.class)<span class="comment">//定义子配置项</span></span><br><span class="line">                .web(WebApplicationType.SERVLET)<span class="comment">//启动内嵌的reactive web server，这个application是一个reactive web application</span></span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于设置环境端口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 自定义端口号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 默认端口号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setEnvironmentVariableForPort</span><span class="params">(String name,String defaultValue)</span>&#123;</span><br><span class="line">        ofNullable(System.getProperty(name))<span class="comment">//       如果 value 非 null ，则创建一个包含了指定 T 类型的 value 值的 Optional 实例，否则创建一个空的 Optional 实例</span></span><br><span class="line"></span><br><span class="line">                .or(()-&gt;of(defaultValue)) <span class="comment">//or 就是如果指定了端口就返回指定端口 如果没有指定端口就用默认端口</span></span><br><span class="line">                .map(Integer::parseInt) <span class="comment">//如果给定端口就进行类型转换</span></span><br><span class="line">                .map(port -&gt; findPort(port)) <span class="comment">//同样如果给定端口就去寻找是否有可用端口</span></span><br><span class="line">                .ifPresent(port -&gt; System.setProperty(name,port));<span class="comment">//如果找到了就将端口定下来</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">findPort</span><span class="params">(<span class="type">int</span> port)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(port == MAX_PORT)&#123;</span><br><span class="line"><span class="comment">//            如果端口到达最大端口就打印日志并返回端口信息</span></span><br><span class="line">                log.error(<span class="string">&quot;No free port found from 8080 - &#123;&#125;&quot;</span>,MAX_PORT);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>+ port;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span> + SocketUtils.findAvailableTcpPort(port,port);</span><br><span class="line"><span class="comment">//        从端口范围中随机选择一个可用端口</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException var4)&#123;</span><br><span class="line">            <span class="keyword">return</span> findPort(port +<span class="number">1</span>);</span><br><span class="line"><span class="comment">//                    如果没有端口不可用就端口加一再次寻找端口</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="container"><a href="#container" class="headerlink" title="container"></a>container</h1><h2 id="WebGoat"><a href="#WebGoat" class="headerlink" title="WebGoat"></a>WebGoat</h2><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702200431223.png" alt="image-20220702200431223"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702200359178.png" alt="image-20220702200359178"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.UserSessionData;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.wanan.webgoat.container&quot;,&quot;com.wanan.webgoat.lessons&quot;&#125;)</span></span><br><span class="line"><span class="comment">//根据定义的扫描路径，把符合扫描规则的类装配到spring容器中</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application-webgoat.properties&quot;)</span></span><br><span class="line"><span class="comment">//properties类型配置文件</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="comment">//@EnableAutoConfiguration注释，此注释自动载入应用程序所需的所有Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebGoat</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;pluginTargetDirectory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> File <span class="title function_">pluginTargetDirectory</span><span class="params">(<span class="meta">@Value(&quot;$&#123;webgoat.user.directory&#125;&quot;)</span> <span class="keyword">final</span> String webgoatHome)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>(webgoatHome);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    取出用户配置中的路径信息</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope(value = &quot;session&quot;,proxyMode = ScopedProxyMode.TARGET_CLASS)</span></span><br><span class="line">    <span class="keyword">public</span> WebSession <span class="title function_">webSession</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebSession</span>();&#125;</span><br><span class="line"><span class="comment">//    根据session类创建返回一个session对象</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope(value = &quot;session&quot;,proxyMode = ScopedProxyMode.TARGET_CLASS)</span></span><br><span class="line">    <span class="keyword">public</span> UserSessionData <span class="title function_">userSessionData</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserSessionData</span>(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;data&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="users"><a href="#users" class="headerlink" title="users"></a>users</h2><h3 id="WebGoatUser"><a href="#WebGoatUser" class="headerlink" title="WebGoatUser"></a>WebGoatUser</h3><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702170759289.png" alt="image-20220702170759289"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702170920741.png" alt="image-20220702170920741"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702171034696.png" alt="image-20220702171034696"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">// @Entity是指这个类映射到数据库表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebGoatUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROLE_USER</span> <span class="operator">=</span> <span class="string">&quot;WEBGOAT_USER&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROLE_ADMIN</span>  <span class="operator">=</span> <span class="string">&quot;WEBGOAT_ADMIN&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line"><span class="comment">//    用于声明一个实体类的属性映射为数据库的主键列。该属性通常置于属性声明语句之前，可与声明语句同行，也可写在单独行上。</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">role</span> <span class="operator">=</span> ROLE_USER;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line"><span class="comment">//    java 的transient关键字的作用是需要实现Serilizable接口，将不需要序列化的属性前添加关键字transient，序列化对象的时候，这个属性就不会序列化到指定的目的地中。</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">WebGoatUser</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebGoatUser</span><span class="params">(String username,String password)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>(username,password,ROLE_USER);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebGoatUser</span><span class="params">(String username,String password,String role)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.role = role;</span><br><span class="line">        createUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = <span class="keyword">new</span> <span class="title class_">User</span>(username,password,getAuthorities());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRole</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> role;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> o <span class="keyword">instanceof</span> WebGoatUser webGoatUser &amp;&amp; <span class="built_in">this</span>.user.equals(webGoatUser.user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(getRole()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isAccountNonExpired();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isAccountNonLocked();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isCredentialsNonExpired();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isEnabled();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="lessons"><a href="#lessons" class="headerlink" title="lessons"></a>lessons</h2><h3 id="Assignment"><a href="#Assignment" class="headerlink" title="Assignment"></a>Assignment</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Assignment</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line"><span class="comment">//    场景：公司开发使用Mysql数据库，生产使用Oracle数据库，当同时使用两种数据库时，JPA主键生成策略可以选择GenerationType.Auto来实现。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String &gt; hints;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Assignment</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Assignment</span><span class="params">(String name,String path,List&lt;String&gt; hints)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (path.equals(<span class="string">&quot;&quot;</span>) || path.equals(<span class="string">&quot;/&quot;</span>) || path.equals(<span class="string">&quot;/WebGoat/&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;The path of assignment &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; overrides WebGoat endpoints, please choose a path within the scope of the lesson&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.path = path;</span><br><span class="line">        <span class="built_in">this</span>.hints = hints;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Lesson"><a href="#Lesson" class="headerlink" title="Lesson"></a>Lesson</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jdk.jfr.Category;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Assignment&gt; assignments;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Lesson</span><span class="params">()</span> &#123;</span><br><span class="line">        id =++count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> getClass().getName();</span><br><span class="line">        <span class="keyword">return</span> className.substring(className.lastIndexOf(<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    返回本类名</span></span><br><span class="line">    <span class="keyword">public</span> Category <span class="title function_">getCategory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDefaultCategory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getTitle</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getPath</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;#lesson/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLink</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s%s.lesson&quot;</span>,getPath(),getId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getId</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;<span class="keyword">return</span> getTitle();&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getPackage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">packageName</span>  <span class="operator">=</span> <span class="built_in">this</span>.getClass().getPackageName();</span><br><span class="line">        <span class="keyword">return</span> packageName.replaceAll(<span class="string">&quot;com.wanan.webgoat.lessons&quot;</span>,<span class="string">&quot;&quot;</span>).replaceAll(<span class="string">&quot;\\..*&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Category</span> &#123;</span><br><span class="line">    INTRODUCTION(<span class="string">&quot;Introduction&quot;</span>,<span class="number">5</span>),</span><br><span class="line">    GENERAL(<span class="string">&quot;General&quot;</span>,<span class="number">100</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    A1(<span class="string">&quot;(A1) Broken Access Control&quot;</span>, <span class="number">301</span>),</span><br><span class="line">    A2(<span class="string">&quot;(A2) Cryptographic Failures&quot;</span>, <span class="number">302</span>),</span><br><span class="line">    A3(<span class="string">&quot;(A3) Injection&quot;</span>, <span class="number">303</span>),</span><br><span class="line"></span><br><span class="line">    A5(<span class="string">&quot;(A5) Security Misconfiguration&quot;</span>, <span class="number">305</span>),</span><br><span class="line">    A6(<span class="string">&quot;(A6) Vuln &amp; Outdated Components&quot;</span>, <span class="number">306</span>),</span><br><span class="line">    A7(<span class="string">&quot;(A7) Identity &amp; Auth Failure&quot;</span>, <span class="number">307</span>),</span><br><span class="line">    A8(<span class="string">&quot;(A8) Software &amp; Data Integrity&quot;</span>, <span class="number">308</span>),</span><br><span class="line">    A9(<span class="string">&quot;(A9) Security Logging Failures&quot;</span>, <span class="number">309</span>),</span><br><span class="line">    A10(<span class="string">&quot;(A10) Server-side Request Forgery&quot;</span>, <span class="number">310</span>),</span><br><span class="line"></span><br><span class="line">    CLIENT_SIDE(<span class="string">&quot;Client side&quot;</span>, <span class="number">1700</span>),</span><br><span class="line"></span><br><span class="line">    CHALLENGE(<span class="string">&quot;Challenges&quot;</span>, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> Integer ranking;</span><br><span class="line">    Category(String name,Integer ranking)&#123;</span><br><span class="line">        <span class="built_in">this</span>.name= name;</span><br><span class="line">        <span class="built_in">this</span>.ranking = ranking;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;<span class="keyword">return</span> getName();&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebSession"><a href="#WebSession" class="headerlink" title="WebSession"></a>WebSession</h3><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702170315844.png" alt="image-20220702170315844"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702170401824.png" alt="image-20220702170401824"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.WebGoatUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serial;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSession</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8965787678158574766L</span>;</span><br><span class="line"><span class="comment">//    可序列化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebGoatUser currentUser;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Lesson currentLesson;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> securityEnabled;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentUser = (WebGoatUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    获取当前用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentLesson</span><span class="params">(Lesson lesson)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.currentLesson = lesson;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Lesson <span class="title function_">getCurrentLesson</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.currentLesson;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentUser.getUsername();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> WebGoatUser <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentUser;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">toggleSecurity</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.securityEnabled = !<span class="built_in">this</span>.securityEnabled;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSecurityEnable</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> securityEnabled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><h3 id="UserSessionData"><a href="#UserSessionData" class="headerlink" title="UserSessionData"></a>UserSessionData</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSessionData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String ,Object&gt; userSessionData = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserSessionData</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserSessionData</span><span class="params">(String key,String value)</span>&#123;</span><br><span class="line">        setValue(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!userSessionData.containsKey(key))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userSessionData.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String key,Object value)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userSessionData.containsKey(key))&#123;</span><br><span class="line">            userSessionData.replace(key,value);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            userSessionData.put(key,value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="webwolf"><a href="#webwolf" class="headerlink" title="webwolf"></a>webwolf</h1><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220705180756835.png" alt="image-20220705180756835"></p>
<h2 id="WebWolf"><a href="#WebWolf" class="headerlink" title="WebWolf"></a>WebWolf</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.webwolf.requests.WebWolfTraceRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.trace.http.HttpTraceRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//用于定义配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.wanan.webgoat.webwolf&quot;)</span></span><br><span class="line"><span class="comment">//告诉Spring 哪个packages 的用注解标识的类 会被spring自动扫描并且装入bean容器,param即用来指定扫描包的范围。</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application-webwolf.properties&quot;)</span></span><br><span class="line"><span class="comment">//properties类型配置文件</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="comment">//@EnableAutoConfiguration就是借助@Import来收集所有符合自动配置条件的bean定义，并加载到IOC容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebWolf</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HttpTraceRepository <span class="title function_">traceRepository</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebWolfTraceRepository</span>();&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h2><h3 id="WebWolfTraceRepository"><a href="#WebWolfTraceRepository" class="headerlink" title="WebWolfTraceRepository"></a>WebWolfTraceRepository</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.requests;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.EvictingQueue;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.trace.http.HttpTrace;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.trace.http.HttpTraceRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebWolfTraceRepository</span> <span class="keyword">implements</span> <span class="title class_">HttpTraceRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EvictingQueue&lt;HttpTrace&gt; traces = EvictingQueue.create(<span class="number">10000</span>);</span><br><span class="line"><span class="comment">//    最近N次执行http请求，执行时间超过阈值T的次数大于等于M，则认为当前网络慢 用于缓存</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; exclusionList = List.of(<span class="string">&quot;/tmpdir&quot;</span>,<span class="string">&quot;/home&quot;</span>,<span class="string">&quot;/files&quot;</span>,<span class="string">&quot;/images/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/favicon.ico&quot;</span>,<span class="string">&quot;/js/&quot;</span>,<span class="string">&quot;/webjars&quot;</span>,<span class="string">&quot;/requests&quot;</span>,<span class="string">&quot;/css/&quot;</span>,<span class="string">&quot;/mail&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;HttpTrace&gt; <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> List.of();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;HttpTrace&gt; <span class="title function_">findAllTraces</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(traces);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isInExclusionList</span><span class="params">(String path)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> exclusionList.stream().anyMatch(e-&gt;path.contains(e));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HttpTrace httpTrace)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">path</span> <span class="operator">=</span> httpTrace.getRequest().getUri().getPath();</span><br><span class="line"><span class="comment">//        获取uri路径</span></span><br><span class="line">        <span class="keyword">if</span>(!isInExclusionList(path))&#123;</span><br><span class="line">            traces.add(httpTrace);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="修复异常启动"><a href="#修复异常启动" class="headerlink" title="修复异常启动"></a>修复异常启动</h1><p>这里直接启动肯定会出现非常多的异常,大概就是pom.xml中缺少依赖项目,springboot版本不同.properties配置未添加,</p>
<p>application-webgoat.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">webgoat.user.directory</span>=<span class="string">$&#123;user.home&#125;/.webgoat-$&#123;webgoat.build.version&#125;/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:hsqldb:file:$&#123;webgoat.server.directory&#125;/webgoat</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">org.hsqldb.jdbc.JDBCDriver</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">webgoat.build.version</span>=<span class="string">@project.version@</span></span><br></pre></td></tr></table></figure>

<p>application-webwolf.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">$&#123;webwolf.port:9090&#125;</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">WebWolf</span></span><br></pre></td></tr></table></figure>

<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>MyWebGoat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.2.3-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>MyWebGoat<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>MyWebGoat<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        被继承的父项目的构件表示符--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        被继承的父项目全球唯一标识符--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        被继承的父项目的版本--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.6.6<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--跟tomcat一样，也是一个web服务器。--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hsqldb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hsqldb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--        自动化管理Webdriver驱动文件--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>16<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>16<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.wanan.webgoat.server.StartWebGoat<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220702210331524.png" alt="image-20220702210331524"></p>
<h1 id="container-1"><a href="#container-1" class="headerlink" title="container"></a>container</h1><h2 id="MvcConfiguration"><a href="#MvcConfiguration" class="headerlink" title="MvcConfiguration"></a>MvcConfiguration</h2><p>这里我们初始时没有添加thymeleaf模板引擎,所以访问会爆500错误,因此我们需要添加上去</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220703162250649.png" alt="image-20220703162250649"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220703161328196.png" alt="image-20220703161328196"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220703162353426.png" alt="image-20220703162353426"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220704171709746.png" alt="image-20220704171709746"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.Language;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.Messages;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.PluginMessages;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.LessonScanner;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.LabelDebugger;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ResourceLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ViewResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.i18n.SessionLocaleResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.IEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.extras.springsecurity5.dialect.SpringSecurityDialect;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.spring5.SpringTemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.spring5.view.ThymeleafViewResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.FileTemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.ITemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.StringTemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresource.ITemplateResource;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresource.StringTemplateResource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//注解类</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="comment">//写在类上可以代替@Autowired注解，需要注意的是在注入时需要用final定义，或者使用@notnull注解</span></span><br><span class="line"><span class="comment">//@Autowired 注释添加到需要该类型数组的字段或方法，则 Spring 会从ApplicationContext 中搜寻符合指定类型的所有 bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UTF8</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"><span class="comment">//    定义字符集</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LessonScanner lessonScanner;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/login&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/lesson_content&quot;</span>).setViewName(<span class="string">&quot;lesson_content&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/start.mvc&quot;</span>).setViewName(<span class="string">&quot;main_new&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/scoreboard&quot;</span>).setViewName(<span class="string">&quot;scoreboard&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ViewResolver <span class="title function_">viewResolver</span><span class="params">(SpringTemplateEngine thymeleafTemplateEngine)</span>&#123;</span><br><span class="line">        <span class="type">ThymeleafViewResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThymeleafViewResolver</span>();</span><br><span class="line">        resolver.setTemplateEngine(thymeleafTemplateEngine);</span><br><span class="line"><span class="comment">//        设置模板引擎是thymeleafTemplateEngine</span></span><br><span class="line">        resolver.setCharacterEncoding(StandardCharsets.UTF_8.displayName());</span><br><span class="line"><span class="comment">//        设置字符集utf-8</span></span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ITemplateResolver <span class="title function_">lessonThymeleafTemplateResolver</span><span class="params">(ResourceLoader resourceLoader)</span>&#123;</span><br><span class="line"><span class="comment">//        大概就是获取一个模板解析器</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileTemplateResolver</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> ITemplateResource <span class="title function_">computeTemplateResource</span><span class="params">(IEngineConfiguration configuration, String ownerTemplate, String template, String resourceName, String characterEncoding, Map&lt;String ,Object&gt; templateResolutionAttributes)</span>&#123;</span><br><span class="line">                <span class="keyword">try</span>(<span class="type">var</span> <span class="variable">is</span> <span class="operator">=</span> resourceLoader.getResource(<span class="string">&quot;classpath:&quot;</span>+resourceName).getInputStream()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringTemplateResource</span>(<span class="keyword">new</span> <span class="title class_">String</span>(is.readAllBytes(),StandardCharsets.UTF_8));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        resolver.setOrder(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//        设置解析器的执行顺序为1</span></span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ITemplateResolver <span class="title function_">springThymeleafTemplateResolver</span><span class="params">(ApplicationContext applicationContext)</span>&#123;</span><br><span class="line">        <span class="type">SpringResourceTemplateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringResourceTemplateResolver</span>();</span><br><span class="line">        resolver.setPrefix(<span class="string">&quot;classpath:/webgoat/templates/&quot;</span>);</span><br><span class="line"><span class="comment">//        设置模板文件的前缀</span></span><br><span class="line">        resolver.setSuffix(<span class="string">&quot;.html&quot;</span>);</span><br><span class="line"><span class="comment">//        设置模本文件的后缀</span></span><br><span class="line">        resolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line"><span class="comment">//        设置模本模型为html</span></span><br><span class="line">        resolver.setOrder(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//        设置解析器的执行顺序为2</span></span><br><span class="line">        resolver.setCharacterEncoding(UTF8);</span><br><span class="line"><span class="comment">//        设置字符集</span></span><br><span class="line">        resolver.setApplicationContext(applicationContext);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LessonTemplateResolver <span class="title function_">LessonTemplateResolver</span><span class="params">(ResourceLoader resourceLoader)</span>&#123;</span><br><span class="line">        <span class="type">LessonTemplateResolver</span> <span class="variable">lessonTemplateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LessonTemplateResolver</span>(resourceLoader);</span><br><span class="line">        lessonTemplateResolver.setOrder(<span class="number">0</span>);</span><br><span class="line">        lessonTemplateResolver.setCacheable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//        不启用缓存模式</span></span><br><span class="line">        lessonTemplateResolver.setCharacterEncoding(UTF8);</span><br><span class="line">        <span class="keyword">return</span> lessonTemplateResolver;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AsciiDoctorTemplateResolver <span class="title function_">asciiDoctorTemplateResolver</span><span class="params">(ResourceLoader resourceLoader)</span>&#123;</span><br><span class="line">        <span class="type">AsciiDoctorTemplateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsciiDoctorTemplateResolver</span>(resourceLoader);</span><br><span class="line">        resolver.setCacheable(<span class="literal">false</span>);</span><br><span class="line">        resolver.setOrder(<span class="number">1</span>);</span><br><span class="line">        resolver.setCharacterEncoding(UTF8);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringTemplateEngine <span class="title function_">thymeleafTemplateEngine</span><span class="params">(ITemplateResolver springThymeleafTemplateResolver,</span></span><br><span class="line"><span class="params">                                                        LessonTemplateResolver lessonTemplateResolver,</span></span><br><span class="line"><span class="params">                                                        AsciiDoctorTemplateResolver asciiDoctorTemplateResolver,</span></span><br><span class="line"><span class="params">                                                        ITemplateResolver lessonThymeleafTemplateResolver)</span>&#123;</span><br><span class="line">        <span class="type">SpringTemplateEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTemplateEngine</span>();</span><br><span class="line">        engine.setEnableSpringELCompiler(<span class="literal">true</span>);</span><br><span class="line">        engine.addDialect(<span class="keyword">new</span> <span class="title class_">SpringSecurityDialect</span>());</span><br><span class="line">        engine.setTemplateResolvers(Set.of(lessonTemplateResolver, asciiDoctorTemplateResolver, lessonThymeleafTemplateResolver, springThymeleafTemplateResolver));</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/css/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webgoat/static/css/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/js/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webgoat/static/js/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/plugins/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webgoat/static/plugins/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/fonts/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webgoat/static/fonts/&quot;</span>);</span><br><span class="line"><span class="comment">//        注册静态资源</span></span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/images/**&quot;</span>).addResourceLocations(lessonScanner.applyPattern(<span class="string">&quot;classpath:/lessons/%s/images/&quot;</span>).toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/lesson_js/**&quot;</span>).addResourceLocations(lessonScanner.applyPattern(<span class="string">&quot;classpath:/lessons/%s/js/&quot;</span>).toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/lesson_css/**&quot;</span>).addResourceLocations(lessonScanner.applyPattern(<span class="string">&quot;classpath:/lessons/%s/css/&quot;</span>).toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/lesson_templates/**&quot;</span>).addResourceLocations(lessonScanner.applyPattern(<span class="string">&quot;classpath:/lessons/%s/templates&quot;</span>).toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/video/**&quot;</span>).addResourceLocations(lessonScanner.applyPattern(<span class="string">&quot;classpath:/lessons/%s/video&quot;</span>).toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line"><span class="comment">//        注册lessons的静态资源</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PluginMessages <span class="title function_">pluginMessages</span><span class="params">(Messages messages, Language language,</span></span><br><span class="line"><span class="params">                                         ResourcePatternResolver resourcePatternResolver)</span>&#123;</span><br><span class="line">        <span class="type">PluginMessages</span> <span class="variable">pluginMessages</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PluginMessages</span>(messages,language,resourcePatternResolver);</span><br><span class="line">        pluginMessages.setDefaultEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        pluginMessages.setBasename(<span class="string">&quot;i18n/WebGoatLables&quot;</span>);</span><br><span class="line">        pluginMessages.setFallbackToSystemLocale(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> pluginMessages;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Language <span class="title function_">language</span><span class="params">(LocaleResolver localeResolver)</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Language</span>(localeResolver);&#125;</span><br><span class="line"><span class="comment">//    配置语言</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Messages <span class="title function_">messageSource</span><span class="params">(Language language)</span>&#123;</span><br><span class="line">        <span class="type">Messages</span> <span class="variable">messages</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Messages</span>(language);</span><br><span class="line">        messages.setDefaultEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        messages.setBasename(<span class="string">&quot;classpath:i18n/messages&quot;</span>);</span><br><span class="line">        messages.setFallbackToSystemLocale(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> messages;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SessionLocaleResolver</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LabelDebugger <span class="title function_">labelDebugger</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LabelDebugger</span>();&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="lessons-1"><a href="#lessons-1" class="headerlink" title="lessons"></a>lessons</h2><h3 id="LessonScanner"><a href="#LessonScanner" class="headerlink" title="LessonScanner"></a>LessonScanner</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//@Componnet是用在类上，声明这个类是一个组件被spring管理起来</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">//使用日志组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonScanner</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">lessonPattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^.*/lessons/([^/]*)/.*$&quot;</span>);</span><br><span class="line"><span class="comment">//            使用的是Java中的Pattern.compile函数来实现对指定字符串的截取。 匹配 aaa/lessons//aaa 为啥匹配这个? 是文件名吗</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String &gt; lessons = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//    用于存放读取到的lessons</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonScanner</span><span class="params">(ResourcePatternResolver resourcePatternResolver)</span>&#123;</span><br><span class="line">        <span class="comment">//       ResourcePatternResolver 用于解析资源文件的策略接口，其特殊的地方在于，它应该提供带有*号这种通配符的资源路径。</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">var</span> <span class="variable">resources</span> <span class="operator">=</span> resourcePatternResolver.getResources(<span class="string">&quot;classpath:/lessons/*/*&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> resource : resources)&#123;</span><br><span class="line">                <span class="type">var</span> <span class="variable">url</span> <span class="operator">=</span> resource.getURL();</span><br><span class="line"><span class="comment">//                这里的url我感觉是路径的意思 其实是一个file协议去读取lessons的内容</span></span><br><span class="line">                <span class="type">var</span> <span class="variable">matcher</span> <span class="operator">=</span> lessonPattern.matcher(url.toString());</span><br><span class="line">                <span class="keyword">if</span> (matcher.matches())&#123;</span><br><span class="line"><span class="comment">//                    如果匹配到了就添加到上面的lessons中数组中</span></span><br><span class="line">                    lessons.add(matcher.group(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;Found &#123;&#125; lessons&quot;</span>,lessons.size());</span><br><span class="line"><span class="comment">//            打印日志看看找到了多少个lessons文件</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;No lessons found...&quot;</span>);</span><br><span class="line"><span class="comment">//            打印lessons没有找到的日志</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//                加载多文件</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String &gt; applyPattern(String pattern)&#123;</span><br><span class="line">        <span class="keyword">return</span> lessons.stream().map(lesson -&gt; String.format(pattern,lesson)).toList();</span><br><span class="line"><span class="comment">//        使用stream() 将源数据—包括集合、数组等转换成流  将集合中的每一个字符进行格式化输出 将数据存储到列表中</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220703144834368.png" alt="image-20220703144834368"></p>
<h2 id="LessonTemplateResolver"><a href="#LessonTemplateResolver" class="headerlink" title="LessonTemplateResolver"></a>LessonTemplateResolver</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ResourceLoader;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.IEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.FileTemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresource.ITemplateResource;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresource.StringTemplateResource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonTemplateResolver</span> <span class="keyword">extends</span> <span class="title class_">FileTemplateResolver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX</span> <span class="operator">=</span> <span class="string">&quot;lesson:&quot;</span>;</span><br><span class="line"><span class="comment">//    定义前缀</span></span><br><span class="line">    <span class="keyword">private</span> ResourceLoader resourceLoader;</span><br><span class="line"><span class="comment">//    定义资源加载器</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String ,<span class="type">byte</span>[]&gt; resources = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//    定义容器存放加载到的文件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonTemplateResolver</span><span class="params">(ResourceLoader resourceLoader)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">        setResolvablePatterns(Set.of(PREFIX + <span class="string">&quot;*&quot;</span>));</span><br><span class="line"><span class="comment">//        设置新的 模式 应用建立的 模板可以通过这个模板解析器来解决。  Set.of用于简单的创建不可变的少量元素的集合</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> ITemplateResource <span class="title function_">computeTemplateResource</span><span class="params">(IEngineConfiguration configuration,String ownerTemplate, String template, String resourceName, String characterEncoding, Map&lt;String, Object&gt; templateResolutionAttributes)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">templateName</span> <span class="operator">=</span> resourceName.substring(PREFIX.length());</span><br><span class="line"><span class="comment">//        截取模板的名字</span></span><br><span class="line">        <span class="type">byte</span>[] resource = resources.get(templateName);</span><br><span class="line"><span class="comment">//        获取存在map中的这个值</span></span><br><span class="line">        <span class="keyword">if</span> (resource == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                resource = resourceLoader.getResource(<span class="string">&quot;classpath:/&quot;</span> + templateName).getInputStream().readAllBytes();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Unable to find lesson HTML:&#123;&#125;&quot;</span>,template);</span><br><span class="line">            &#125;</span><br><span class="line">            resources.put(templateName,resource);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringTemplateResource</span>(<span class="keyword">new</span> <span class="title class_">String</span>(resource, StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AsciiDoctorTemplateResolver-java"><a href="#AsciiDoctorTemplateResolver-java" class="headerlink" title="AsciiDoctorTemplateResolver.java"></a>AsciiDoctorTemplateResolver.java</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ************************************************************************************************</span></span><br><span class="line"><span class="comment"> * This file is part of WebGoat, an Open Web Application Security Project utility. For details,</span></span><br><span class="line"><span class="comment"> * please see http://www.owasp.org/</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2002 - 2014 Bruce Mayhew</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This program is free software; you can redistribute it and/or modify it under the terms of the</span></span><br><span class="line"><span class="comment"> * GNU General Public License as published by the Free Software Foundation; either version 2 of the</span></span><br><span class="line"><span class="comment"> * License, or (at your option) any later version.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without</span></span><br><span class="line"><span class="comment"> * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span></span><br><span class="line"><span class="comment"> * General Public License for more details.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * You should have received a copy of the GNU General Public License along with this program; if</span></span><br><span class="line"><span class="comment"> * not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</span></span><br><span class="line"><span class="comment"> * 02111-1307, USA.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Getting Source ==============</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Source for this application is maintained at https://github.com/WebGoat/WebGoat, a repository for free software</span></span><br><span class="line"><span class="comment"> * projects.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> WebGoat</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> $Id: $Id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> December 12, 2015</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.owasp.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.Asciidoctor;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.extension.JavaExtensionRegistry;</span><br><span class="line"><span class="keyword">import</span> org.owasp.webgoat.container.asciidoc.OperatingSystemMacro;</span><br><span class="line"><span class="keyword">import</span> org.owasp.webgoat.container.asciidoc.UsernameMacro;</span><br><span class="line"><span class="keyword">import</span> org.owasp.webgoat.container.asciidoc.WebGoatTmpDirMacro;</span><br><span class="line"><span class="keyword">import</span> org.owasp.webgoat.container.asciidoc.WebGoatVersionMacro;</span><br><span class="line"><span class="keyword">import</span> org.owasp.webgoat.container.asciidoc.WebWolfMacro;</span><br><span class="line"><span class="keyword">import</span> org.owasp.webgoat.container.asciidoc.WebWolfRootMacro;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ResourceLoader;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.IEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.FileTemplateResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresource.ITemplateResource;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresource.StringTemplateResource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.asciidoctor.Asciidoctor.Factory.create;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Thymeleaf resolver for AsciiDoc used in the lesson, can be used as follows inside a lesson file:</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;code&gt;</span></span><br><span class="line"><span class="comment"> * &lt;div th:replace=&quot;doc:AccessControlMatrix_plan.adoc&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/code&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsciiDoctorTemplateResolver</span> <span class="keyword">extends</span> <span class="title class_">FileTemplateResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Asciidoctor</span> <span class="variable">asciidoctor</span> <span class="operator">=</span> create();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX</span> <span class="operator">=</span> <span class="string">&quot;doc:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResourceLoader resourceLoader;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AsciiDoctorTemplateResolver</span><span class="params">(ResourceLoader resourceLoader)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">        setResolvablePatterns(Set.of(PREFIX + <span class="string">&quot;*&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> ITemplateResource <span class="title function_">computeTemplateResource</span><span class="params">(IEngineConfiguration configuration, String ownerTemplate, String template, String resourceName, String characterEncoding, Map&lt;String, Object&gt; templateResolutionAttributes)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">templateName</span> <span class="operator">=</span> resourceName.substring(PREFIX.length());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> resourceLoader.getResource(<span class="string">&quot;classpath:/&quot;</span> + templateName).getInputStream()) &#123;</span><br><span class="line">            <span class="type">JavaExtensionRegistry</span> <span class="variable">extensionRegistry</span> <span class="operator">=</span> asciidoctor.javaExtensionRegistry();</span><br><span class="line">            extensionRegistry.inlineMacro(<span class="string">&quot;webWolfLink&quot;</span>, WebWolfMacro.class);</span><br><span class="line">            extensionRegistry.inlineMacro(<span class="string">&quot;webWolfRootLink&quot;</span>, WebWolfRootMacro.class);</span><br><span class="line">            extensionRegistry.inlineMacro(<span class="string">&quot;webGoatVersion&quot;</span>, WebGoatVersionMacro.class);</span><br><span class="line">            extensionRegistry.inlineMacro(<span class="string">&quot;webGoatTempDir&quot;</span>, WebGoatTmpDirMacro.class);</span><br><span class="line">            extensionRegistry.inlineMacro(<span class="string">&quot;operatingSystem&quot;</span>, OperatingSystemMacro.class);</span><br><span class="line">            extensionRegistry.inlineMacro(<span class="string">&quot;username&quot;</span>, UsernameMacro.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">StringWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">            asciidoctor.convert(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is), writer, createAttributes());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringTemplateResource</span>(writer.getBuffer().toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringTemplateResource</span>(<span class="string">&quot;&lt;div&gt;Unable to find documentation for: &quot;</span> + templateName + <span class="string">&quot; &lt;/div&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title function_">createAttributes</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; attributes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        attributes.put(<span class="string">&quot;source-highlighter&quot;</span>, <span class="string">&quot;coderay&quot;</span>);</span><br><span class="line">        attributes.put(<span class="string">&quot;backend&quot;</span>, <span class="string">&quot;xhtml&quot;</span>);</span><br><span class="line">        attributes.put(<span class="string">&quot;icons&quot;</span>, org.asciidoctor.Attributes.FONT_ICONS);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; options = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        options.put(<span class="string">&quot;attributes&quot;</span>, attributes);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220703205540754.png" alt="image-20220703205540754"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220703205741992.png" alt="image-20220703205741992"></p>
<h2 id="asciidoc"><a href="#asciidoc" class="headerlink" title="asciidoc"></a>asciidoc</h2><h3 id="WebWolfMacro"><a href="#WebWolfMacro" class="headerlink" title="WebWolfMacro"></a>WebWolfMacro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.ast.ContentNode;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.extension.InlineMacroProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebWolfMacro</span> <span class="keyword">extends</span> <span class="title class_">InlineMacroProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebWolfMacro</span><span class="params">(String macroName)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebWolfMacro</span><span class="params">(String macroName, Map&lt;String, Object&gt; config)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName,config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(ContentNode contentNode,String linkText,Map&lt;String,Object&gt; attributes)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">env</span> <span class="operator">=</span> EnvironmentExposure.getEnv();</span><br><span class="line">        <span class="type">var</span> <span class="variable">hostname</span> <span class="operator">=</span> determineHost(env.getProperty(<span class="string">&quot;webwolf.port&quot;</span>));</span><br><span class="line"><span class="comment">//        这里的webwolf.port其实就是配置文件中的webwolf端口</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">target</span> <span class="operator">=</span> (String ) attributes.getOrDefault(<span class="string">&quot;target&quot;</span>,<span class="string">&quot;home&quot;</span>);</span><br><span class="line"><span class="comment">//        这里设定默认值为home?</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">href</span> <span class="operator">=</span> hostname + <span class="string">&quot;/&quot;</span> +target;</span><br><span class="line">        <span class="keyword">if</span> (displayCompleteLinkNoFormatting(attributes))&#123;</span><br><span class="line"><span class="comment">//            判断是一个nolink的话</span></span><br><span class="line">            linkText = href;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">var</span> <span class="variable">options</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String ,Object&gt;();</span><br><span class="line">        options.put(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;:link&quot;</span>);</span><br><span class="line">        options.put(<span class="string">&quot;target&quot;</span>,href);</span><br><span class="line">        attributes.put(<span class="string">&quot;window&quot;</span>,<span class="string">&quot;_blank&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> createPhraseNode(contentNode,<span class="string">&quot;anchor&quot;</span>,linkText,attributes,options).convert();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">displayCompleteLinkNoFormatting</span><span class="params">(Map&lt;String ,Object&gt; attributes)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> attributes.values().stream().anyMatch(a-&gt;a.equals(<span class="string">&quot;noLink&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">determineHost</span><span class="params">(String port)</span>&#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Host&quot;</span>);</span><br><span class="line"><span class="comment">//        获取请求头中的host</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">semicolonIndex</span> <span class="operator">=</span> host.indexOf(<span class="string">&quot;:&quot;</span>);</span><br><span class="line"><span class="comment">//        将host以:进行分割获取:的位置</span></span><br><span class="line">        <span class="keyword">if</span> (semicolonIndex == -<span class="number">1</span> || host.endsWith(<span class="string">&quot;:80&quot;</span>))&#123;</span><br><span class="line"><span class="comment">//            如果没有找到: 或者host是以:80结尾,那么就将:80进行替换 将www.web ...进行替换</span></span><br><span class="line">            host = host.replace(<span class="string">&quot;:80&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;www.webgoat.local&quot;</span>,<span class="string">&quot;www.webwolf.local&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            host = host.substring(<span class="number">0</span>,semicolonIndex);</span><br><span class="line">            <span class="comment">//            将host以semicolonIndex 进行分割</span></span><br><span class="line">            host = host.concat(<span class="string">&quot;:&quot;</span>).concat(port);</span><br><span class="line"><span class="comment">//            将9090进行拼接进去</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http://&quot;</span>+host +(includeWebWolfContext() ? <span class="string">&quot;/WebWolf&quot;</span>:<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">includeWebWolfContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以自己调试一下</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220704140556124.png" alt="image-20220704140556124"></p>
<h3 id="EnvironmentExposure"><a href="#EnvironmentExposure" class="headerlink" title="EnvironmentExposure"></a>EnvironmentExposure</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnvironmentExposure</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext context;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Environment <span class="title function_">getEnv</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context.getEnvironment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        context = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="WebWolfRootMacro"><a href="#WebWolfRootMacro" class="headerlink" title="WebWolfRootMacro"></a>WebWolfRootMacro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebWolfRootMacro</span> <span class="keyword">extends</span> <span class="title class_">WebWolfMacro</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebWolfRootMacro</span><span class="params">(String macroName)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebWolfRootMacro</span><span class="params">(String macroName, Map&lt;String,Object&gt; config)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName,config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">includeWebWolfContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebGoatVersionMacro"><a href="#WebGoatVersionMacro" class="headerlink" title="WebGoatVersionMacro"></a>WebGoatVersionMacro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.ast.ContentNode;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.extension.InlineMacroProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebGoatVersionMacro</span> <span class="keyword">extends</span> <span class="title class_">InlineMacroProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebGoatVersionMacro</span><span class="params">(String macroName)</span>&#123;<span class="built_in">super</span>(macroName);&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebGoatVersionMacro</span><span class="params">(String macroName, Map&lt;String,Object&gt; config)</span>&#123;<span class="built_in">super</span>(macroName,config);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(ContentNode contentNode,String target,Map&lt;String,Object&gt; attributes)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">webgoatVersion</span> <span class="operator">=</span> EnvironmentExposure.getEnv().getProperty(<span class="string">&quot;webgoat.build.version&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> createPhraseNode(contentNode,<span class="string">&quot;quoted&quot;</span>,webgoatVersion);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebGoatTmpDirMacro"><a href="#WebGoatTmpDirMacro" class="headerlink" title="WebGoatTmpDirMacro"></a>WebGoatTmpDirMacro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.ast.ContentNode;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.extension.InlineMacroProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebGoatTmpDirMacro</span> <span class="keyword">extends</span> <span class="title class_">InlineMacroProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebGoatTmpDirMacro</span><span class="params">(String macroName)</span>&#123;<span class="built_in">super</span>(macroName);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebGoatTmpDirMacro</span><span class="params">(String macroName, Map&lt;String ,Object&gt; config)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName, config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(ContentNode contentNode,String  target,Map&lt;String ,Object&gt; attributes)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">env</span> <span class="operator">=</span> EnvironmentExposure.getEnv().getProperty(<span class="string">&quot;webgoat.server.directory&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> createPhraseNode(contentNode,<span class="string">&quot;quoted&quot;</span>,env);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OperatingSystemMacro"><a href="#OperatingSystemMacro" class="headerlink" title="OperatingSystemMacro"></a>OperatingSystemMacro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.ast.ContentNode;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.extension.InlineMacroProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperatingSystemMacro</span> <span class="keyword">extends</span> <span class="title class_">InlineMacroProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OperatingSystemMacro</span><span class="params">(String macroName)</span>&#123;<span class="built_in">super</span>(macroName);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OperatingSystemMacro</span><span class="params">(String macroName, Map&lt;String,Object&gt; config)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName,config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(ContentNode contentNode,String target,Map&lt;String ,Object&gt; attributes)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">osName</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> createPhraseNode(contentNode,<span class="string">&quot;quoted&quot;</span>,osName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="UsernameMacro"><a href="#UsernameMacro" class="headerlink" title="UsernameMacro"></a>UsernameMacro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.asciidoc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.WebGoat;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.WebGoatUser;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.ast.ContentNode;</span><br><span class="line"><span class="keyword">import</span> org.asciidoctor.extension.InlineMacroProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsernameMacro</span> <span class="keyword">extends</span> <span class="title class_">InlineMacroProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameMacro</span><span class="params">(String macroName)</span>&#123;<span class="built_in">super</span>(macroName);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameMacro</span><span class="params">(String macroName, Map&lt;String,Object&gt; config)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(macroName,config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(ContentNode contentNode,String target,Map&lt;String ,Object&gt; attributes)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">auth</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="type">var</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (auth.getPrincipal() <span class="keyword">instanceof</span> WebGoatUser webGoatUser)&#123;</span><br><span class="line">            username = webGoatUser.getUsername();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> createPhraseNode(contentNode,<span class="string">&quot;quoted&quot;</span>,username);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="i18n"><a href="#i18n" class="headerlink" title="i18n"></a>i18n</h2><h3 id="PluginMessages"><a href="#PluginMessages" class="headerlink" title="PluginMessages"></a>PluginMessages</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.i18n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ReloadableResourceBundleMessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PluginMessages</span> <span class="keyword">extends</span> <span class="title class_">ReloadableResourceBundleMessageSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PROPERTIES_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;.properties&quot;</span>;</span><br><span class="line"><span class="comment">//    定义后缀</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Language language;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResourcePatternResolver resourcePatternResolver;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PluginMessages</span><span class="params">(Messages messages,Language language,ResourcePatternResolver resourcePatternResolver)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.language = language;</span><br><span class="line">        <span class="built_in">this</span>.setParentMessageSource(messages);</span><br><span class="line">        <span class="built_in">this</span>.setBasename(<span class="string">&quot;WebGoatLabels&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.resourcePatternResolver = resourcePatternResolver;</span><br><span class="line"><span class="comment">//        进行初始化</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> PropertiesHolder <span class="title function_">refreshProperties</span><span class="params">(String filename,PropertiesHolder propertiesHolder)</span>&#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">var</span> <span class="variable">resources</span> <span class="operator">=</span> resourcePatternResolver.getResources(<span class="string">&quot;classpath:/lessons/**/i18n&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;/WebGoatLabels&quot;</span>+PROPERTIES_SUFFIX);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> resource : resources)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">sourcePath</span> <span class="operator">=</span> resource.getURI().toString().replace(PROPERTIES_SUFFIX,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//                获取资源路径</span></span><br><span class="line">                <span class="type">PropertiesHolder</span> <span class="variable">holder</span> <span class="operator">=</span> <span class="built_in">super</span>.refreshProperties(sourcePath,propertiesHolder);</span><br><span class="line">                properties.putAll(holder.getProperties());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Unable to read plugin message&quot;</span>,e);</span><br><span class="line"><span class="comment">//            打印异常</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertiesHolder</span>(properties,lastModified);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getMessages</span><span class="params">()</span>&#123;<span class="keyword">return</span> getMergedProperties(language.getLocale()).getProperties();&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">(String code,Object... args)</span>&#123;<span class="keyword">return</span> getMessage(code,args,language.getLocale());&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">(String code,String defaultValue,Object... args)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getMessage(code,args,defaultValue,language.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Language"><a href="#Language" class="headerlink" title="Language"></a>Language</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.i18n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//作用于类，生成参数为所有实例变量的构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Language</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocaleResolver localeResolver;</span><br><span class="line">    <span class="keyword">public</span> Locale <span class="title function_">getLocale</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> localeResolver.resolveLocale(((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Messages"><a href="#Messages" class="headerlink" title="Messages"></a>Messages</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.i18n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ReloadableResourceBundleMessageSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//作用于类，生成参数为所有实例变量的构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Messages</span> <span class="keyword">extends</span> <span class="title class_">ReloadableResourceBundleMessageSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Language language;</span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getMessages</span><span class="params">()</span>&#123;<span class="keyword">return</span> getMergedProperties(language.getLocale()).getProperties();&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">(String code,Object... args)</span>&#123;<span class="keyword">return</span> getMessage(code,args,language.getLocale());&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">(String code,String defaultValue,Object... args)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getMessage(code,args,defaultValue,language.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="session-1"><a href="#session-1" class="headerlink" title="session"></a>session</h2><h3 id="LabelDebugger"><a href="#LabelDebugger" class="headerlink" title="LabelDebugger"></a>LabelDebugger</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LabelDebugger</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> enabled=<span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span>&#123;<span class="keyword">return</span> enabled;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.enabled = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span>&#123;<span class="built_in">this</span>.enabled = <span class="literal">false</span>;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEnabled</span><span class="params">(<span class="type">boolean</span> enabled)</span>&#123;<span class="built_in">this</span>.enabled = enabled;&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="启动试一下"><a href="#启动试一下" class="headerlink" title="启动试一下"></a>启动试一下</h1><p>报这个错</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220705104852655.png" alt="image-20220705104852655"></p>
<p>这里查这个错误 最后还是没找到具体那个依赖出现了问题,这里最终也是排除到了依赖上面出了问题,这里我们就直接使用webgoat的依赖了,其中有一个问题</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220705172611280.png" alt="image-20220705172611280"></p>
<p>使用时需要先删除这个日志管理</p>
<p>启动之后这里做了渲染,是自带的吗</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220705172753229.png" alt="image-20220705172753229"></p>
<p>其实这是Spring Boot自带的安全自动配置</p>
<p>在日志这里也有密码 用户名是user</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220705204826857.png" alt="image-20220705204826857"></p>
<p>测试一下是没有问题的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220705205054461.png" alt="image-20220705205054461"></p>
<p>这里我们是因为还没有配置WebSecurityConfig所以才会这样</p>
<h1 id="container-2"><a href="#container-2" class="headerlink" title="container"></a>container</h1><h2 id="WebSecurityConfig"><a href="#WebSecurityConfig" class="headerlink" title="WebSecurityConfig"></a>WebSecurityConfig</h2><p>资料</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * .loginPage(&quot;/login.html&quot;)指定了跳转到登录页面的请求URL，</span></span><br><span class="line"><span class="comment"> * .loginProcessingUrl(&quot;/login&quot;)对应登录页面form表单的action=&quot;/login&quot;，</span></span><br><span class="line"><span class="comment"> * .antMatchers(&quot;/login.html&quot;).permitAll()表示跳转到登录页面的请求不被拦截</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> http</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.addFilterBefore(validateCodeFilter, UsernamePasswordAuthenticationFilter.class) <span class="comment">// 添加验证码校验过滤器</span></span><br><span class="line">            .addFilterBefore(smsCodeFilter, UsernamePasswordAuthenticationFilter.class) <span class="comment">// 添加短信验证码校验过滤器</span></span><br><span class="line">            .formLogin() <span class="comment">// 表单登录</span></span><br><span class="line">            <span class="comment">// http.httpBasic() // HTTP Basic</span></span><br><span class="line">            .loginPage(<span class="string">&quot;/authentication/require&quot;</span>) <span class="comment">// 登录跳转 URL, 进行验证或者登陆页 跳转</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>) <span class="comment">// 处理表单登录 URL</span></span><br><span class="line">            .successHandler(authenticationSucessHandler) <span class="comment">// 处理登录成功</span></span><br><span class="line">            .failureHandler(authenticationFailureHandler) <span class="comment">// 处理登录失败</span></span><br><span class="line">            .and()</span><br><span class="line">            .rememberMe()</span><br><span class="line">            .tokenRepository(persistentTokenRepository()) <span class="comment">// 配置 token 持久化仓库</span></span><br><span class="line">            .tokenValiditySeconds(<span class="number">3600</span>) <span class="comment">// remember 过期时间，单为秒</span></span><br><span class="line">            .userDetailsService(userDetailService) <span class="comment">// 处理自动登录逻辑</span></span><br><span class="line">            .and()</span><br><span class="line">            .authorizeRequests() <span class="comment">// 授权配置</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/authentication/require&quot;</span>, <span class="string">&quot;/login.html&quot;</span>, <span class="string">&quot;/code/image&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/code/sms&quot;</span>, <span class="string">&quot;/session/invalid&quot;</span>, <span class="string">&quot;/css/*&quot;</span>, <span class="string">&quot;/js/*&quot;</span>, <span class="string">&quot;/login1.html&quot;</span>, <span class="string">&quot;/statics/**&quot;</span>, <span class="string">&quot;/signout/success&quot;</span>).permitAll() <span class="comment">// 登录跳转 URL 无需认证 (含登录页的静态资源)</span></span><br><span class="line">            .anyRequest()  <span class="comment">// 所有请求</span></span><br><span class="line">            .authenticated() <span class="comment">// 都需要认证</span></span><br><span class="line">            .and()</span><br><span class="line">            .sessionManagement() <span class="comment">// 添加 Session管理器</span></span><br><span class="line">            .invalidSessionUrl(<span class="string">&quot;/session/invalid&quot;</span>) <span class="comment">// Session失效后跳转到这个链接</span></span><br><span class="line">            .maximumSessions(<span class="number">1</span>) <span class="comment">//最大session并发数量，超过定义数量前一个session就会失效</span></span><br><span class="line">            .maxSessionsPreventsLogin(<span class="literal">true</span>) <span class="comment">//Session达到最大有效数的时候，不再允许相同的账户登录。</span></span><br><span class="line">            .expiredSessionStrategy(mySessionExpiredStrategy)<span class="comment">//配置了Session在并发下失效后的处理策略;</span></span><br><span class="line">            .sessionRegistry(sessionRegistry)<span class="comment">//添加 session 注册</span></span><br><span class="line">            .and()</span><br><span class="line">            .and()</span><br><span class="line">            .logout()<span class="comment">//自定义退出登录</span></span><br><span class="line">            .logoutUrl(<span class="string">&quot;/signout&quot;</span>)<span class="comment">//退出登录的URL</span></span><br><span class="line">            .invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">            <span class="comment">//.logoutSuccessUrl(&quot;/signout/success&quot;)//退出成功后跳转的URL</span></span><br><span class="line">            .deleteCookies(<span class="string">&quot;JSESSIONID&quot;</span>)<span class="comment">//退出成功后删除名称为JSESSIONID的cookie, 删除不成功？？？</span></span><br><span class="line">            .logoutSuccessHandler(logOutSuccessHandler) <span class="comment">//logoutSuccessHandler指定退出成功处理器来处理退出成功后的逻辑：</span></span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()<span class="comment">// 关闭 CSRF攻击防御关了</span></span><br><span class="line">            .apply(smsAuthenticationConfig);<span class="comment">// 将短信验证码认证配置加到 Spring Security 中</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.NoOp;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configurers.ExpressionUrlAuthorizationConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.NoOpPasswordEncoder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//用于定义配置类</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//自动生成构造方法</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="comment">//@EnableWebSecurity，用于在我们的项目中启用SpringSecurity。为某些请求路径开启安全认证策略。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ExpressionUrlAuthorizationConfigurer&lt;HttpSecurity&gt;.<span class="type">ExpressionInterceptUrlRegistry</span> <span class="variable">security</span> <span class="operator">=</span> httpSecurity</span><br><span class="line">                .authorizeRequests()</span><br><span class="line"><span class="comment">//                http请求是否要登录认证</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/css/**&quot;</span>, <span class="string">&quot;/images/**&quot;</span>, <span class="string">&quot;/js/**&quot;</span>, <span class="string">&quot;fonts/**&quot;</span>, <span class="string">&quot;/plugins/**&quot;</span>, <span class="string">&quot;/registration&quot;</span>, <span class="string">&quot;/register.mvc&quot;</span>, <span class="string">&quot;/actuator/**&quot;</span>).permitAll()</span><br><span class="line"><span class="comment">//                antMatcher用在多个HttpSecurity的场景下，用来为每个HttpSecurity过滤  permitAll() 不管登入,不登入 都能访问</span></span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line"><span class="comment">//               任何请求都必须经过身份验证</span></span><br><span class="line">        security.and()</span><br><span class="line"><span class="comment">//                 and() 是将方法链接在一起的一种方式。</span></span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"><span class="comment">//                在未登录时自动跳转到login页面</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/welcome.mvc&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//                登录认证成功之后默认跳转的路径 defaultSuccessUrl 就是说，它会默认跳转到 Referer 来源页面，如果 Referer 为空，没有来源页，则跳转到默认设置的页面。</span></span><br><span class="line"><span class="comment">//        successForwardUrl 表示不管 Referer 从何而来，登录成功后一律跳转到指定的地址  defaultSuccessUrl 中如果第二个参数输入为 true，则效果和 successForwardUrl 一致。</span></span><br><span class="line">                .usernameParameter(<span class="string">&quot;username&quot;</span>)</span><br><span class="line"><span class="comment">//                登录表单form中用户名输入框中的name名,不修改的话默认是username</span></span><br><span class="line">                .passwordParameter(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"><span class="comment">//                登录表单form中面输入框input的name名,不修改的话默认就是password</span></span><br><span class="line">                .permitAll();</span><br><span class="line"><span class="comment">//        不需要登录就可以访问的</span></span><br><span class="line">        security.and()</span><br><span class="line"><span class="comment">//                将方法连接在一起的方式NMnmnmMMmMmmMMmmM</span></span><br><span class="line">                .logout().deleteCookies(<span class="string">&quot;JSESSIONID&quot;</span>).invalidateHttpSession(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//        登出 删除cookies</span></span><br><span class="line">        security.and().csrf().disable();</span><br><span class="line"><span class="comment">//        关闭csrf防护</span></span><br><span class="line">        httpSecurity.headers().cacheControl().disable();</span><br><span class="line"><span class="comment">//      禁用缓存</span></span><br><span class="line">        httpSecurity.exceptionHandling().authenticationEntryPoint(<span class="keyword">new</span> <span class="title class_">AjaxAuthenticationEntryPoint</span>(<span class="string">&quot;/login&quot;</span>));</span><br><span class="line"><span class="comment">//       添加自定义的未授权和为登录结果返回</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    这个注解就是spring可以自动帮你把Bean里面引用的对象的setter/getter方法省略,他会自动帮你set/get</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureGlobal</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsServiceBean</span><span class="params">()</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">return</span> userDetailsService;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">()</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line"><span class="comment">//    表示不检测过期的方法,不显示使用了不赞成使用的类或方法时的警告</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> NoOpPasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (NoOpPasswordEncoder) NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="users-1"><a href="#users-1" class="headerlink" title="users"></a>users</h2><h3 id="UserService"><a href="#UserService" class="headerlink" title="UserService"></a>UserService</h3><p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220707161213187.png" alt="image-20220707161213187"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Initializeable;</span><br><span class="line"><span class="keyword">import</span> org.flywaydb.core.Flyway;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">//@Service注解用于类上，标记当前类是一个service类，加上该注解会将当前类自动注入到spring容器中，不需要再在applicationContext.xml文件定义bean了</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//生成构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserTrackerRepository userTrackerRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="comment">//                获取JdbcTemplat实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Function&lt;String,Flyway&gt; flywayLessons;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Initializeable&gt; lessonInitializables;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> WebGoatUser <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException&#123;</span><br><span class="line">        <span class="type">WebGoatUser</span> <span class="variable">webGoatUser</span> <span class="operator">=</span> userRepository.findByUsername(username);</span><br><span class="line"><span class="comment">//        根据用户名查找用户</span></span><br><span class="line">        <span class="keyword">if</span> (webGoatUser == <span class="literal">null</span> )&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;User not found&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            webGoatUser.createUser();</span><br><span class="line">            lessonInitializables.forEach(l-&gt;l.initialize(webGoatUser));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> webGoatUser;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(String username ,String password)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">userAlreadyExists</span> <span class="operator">=</span> userRepository.existsByUsername(username);</span><br><span class="line"><span class="comment">//        根据用户名查看是否存在用户</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">webGoatUser</span> <span class="operator">=</span> userRepository.save(<span class="keyword">new</span> <span class="title class_">WebGoatUser</span>(username,password));</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">        <span class="keyword">if</span> (!userAlreadyExists)&#123;</span><br><span class="line">            userTrackerRepository.save(<span class="keyword">new</span> <span class="title class_">UserTracker</span>(username));</span><br><span class="line"><span class="comment">//            如果用户存在就不会在创建了</span></span><br><span class="line">            createLessonsForUser(webGoatUser);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createLessonsForUser</span><span class="params">(WebGoatUser webGoatUser)</span>&#123;</span><br><span class="line">        jdbcTemplate.execute(<span class="string">&quot;CREATE SCHEMA \&quot;&quot;</span>+webGoatUser.getUsername()+<span class="string">&quot;\&quot; authorization dba&quot;</span>);</span><br><span class="line">        <span class="comment">//使用该实例的execute(String sql)方法执行 SQL语句创建一个以user用户名的数据库</span></span><br><span class="line">        flywayLessons.apply(webGoatUser.getUsername()).migrate();</span><br><span class="line"><span class="comment">//      进行迁移应用</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;WebGoatUser&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>&#123;<span class="keyword">return</span> userRepository.findAll();&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserRepository"><a href="#UserRepository" class="headerlink" title="UserRepository"></a>UserRepository</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;WebGoatUser,String&gt; &#123;</span><br><span class="line">    WebGoatUser <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"><span class="comment">//    根据用户名去查找用户</span></span><br><span class="line">    List&lt;WebGoatUser&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserTrackerRepository"><a href="#UserTrackerRepository" class="headerlink" title="UserTrackerRepository"></a>UserTrackerRepository</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserTrackerRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;UserTracker,String&gt; &#123;</span><br><span class="line">    UserTracker <span class="title function_">findByUser</span><span class="params">(String user)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserTracker"><a href="#UserTracker" class="headerlink" title="UserTracker"></a>UserTracker</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Assignment;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">//启动日志</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">//是指这个类映射到数据库中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTracker</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line"><span class="comment">//    用于声明一个实体类的属性映射为数据库的主键列,该属性通常置于属性语句之前,可与声明语句同行,也可写在单独行上面</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line"><span class="comment">//    公司开发使用Mysql数据库，生产使用Oracle数据库，当同时使用两种数据库时，JPA主键生成策略可以选择GenerationType.Auto来实现。</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Column(name=&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="meta">@OneToMany(cascade = CascadeType.ALL,fetch = FetchType.EAGER)</span></span><br><span class="line"><span class="comment">// @OneToMany 一对多关联映射   @Cascade：相当于set标签的cascade属性 fetch: 加载类型，有lazy和eager两种</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;LessonTracker&gt; lessonTrackers = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserTracker</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserTracker</span><span class="params">(<span class="keyword">final</span> String user)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> LessonTracker <span class="title function_">getLessonTracker</span><span class="params">(Lesson lesson)</span>&#123;</span><br><span class="line">        Optional&lt;LessonTracker&gt; lessonTracker  = lessonTrackers</span><br><span class="line">                .stream().filter(l-&gt;l.getLessonName().equals(lesson.getId())).findFirst();</span><br><span class="line">        <span class="keyword">if</span> (!lessonTracker.isPresent())&#123;</span><br><span class="line"><span class="comment">//            如果lessonTracker存在</span></span><br><span class="line">            <span class="type">LessonTracker</span> <span class="variable">newLessonTracker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LessonTracker</span>(lesson);</span><br><span class="line">            lessonTrackers.add(newLessonTracker);</span><br><span class="line">            <span class="keyword">return</span> newLessonTracker;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> lessonTracker.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Optional&lt;LessonTracker&gt; <span class="title function_">getLessonTracker</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lessonTrackers.stream().filter(l-&gt;l.getLessonName().equals(id)).findFirst();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assignmentSolved</span><span class="params">(Lesson lesson,String assignmentName)</span>&#123;</span><br><span class="line">        <span class="type">LessonTracker</span> <span class="variable">lessonTracker</span> <span class="operator">=</span> getLessonTracker(lesson);</span><br><span class="line">        lessonTracker.incrementAttempts();</span><br><span class="line">        lessonTracker.assignmentSolved(assignmentName);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assignmentFailed</span><span class="params">(Lesson lesson)</span>&#123;</span><br><span class="line">        LessonTracker lessonTracker= getLessonTracker(lesson);</span><br><span class="line">        lessonTracker.incrementAttempts();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">(Lesson al)</span>&#123;</span><br><span class="line">        <span class="type">LessonTracker</span> <span class="variable">lessonTracker</span> <span class="operator">=</span> getLessonTracker(al);</span><br><span class="line">        lessonTracker.reset();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numberOfLessonsSolved</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numberOfLessonsSolved</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (LessonTracker lessonTracker:lessonTrackers)&#123;</span><br><span class="line">            <span class="keyword">if</span> (lessonTracker.isLessonSolved())&#123;</span><br><span class="line">                numberOfLessonsSolved = numberOfLessonsSolved+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> numberOfLessonsSolved;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numberOfAssignmentsSolved</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numberOfAssignmentsSolved</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (LessonTracker lessonTracker : lessonTrackers)&#123;</span><br><span class="line">            Map&lt;Assignment,Boolean&gt; lessonOverview = lessonTracker.getLessonOverview();</span><br><span class="line">            numberOfAssignmentsSolved = lessonOverview.values().stream().filter(b-&gt;b).collect(Collectors.counting()).intValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> numberOfAssignmentsSolved;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LessonTracker"><a href="#LessonTracker" class="headerlink" title="LessonTracker"></a>LessonTracker</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Assignment;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">//映射到数据库</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonTracker</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line"><span class="comment">//      用于声明一个实体类的属性映射为数据库的主键列,该属性通常置于属性语句之前,可与声明语句同行,也可写在单独行上面</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String lessonName;</span><br><span class="line">    <span class="meta">@OneToMany(cascade = CascadeType.ALL,fetch = FetchType.EAGER)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Assignment&gt; solvedAssignments = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@OneToMany(cascade = CascadeType.ALL,fetch = FetchType.EAGER)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Assignment&gt; allAssignments = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">numberOfAttempts</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LessonTracker</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonTracker</span><span class="params">(Lesson lesson)</span>&#123;</span><br><span class="line">        lessonName = lesson.getId();</span><br><span class="line">        allAssignments.addAll(lesson.getAssignments() == <span class="literal">null</span> ? List.of() : lesson.getAssignments());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Optional&lt;Assignment&gt; <span class="title function_">getAssignment</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> allAssignments.stream().filter(a-&gt;a.getName().equals(name)).findFirst();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assignmentSolved</span><span class="params">(String solvedAssignment)</span>&#123;</span><br><span class="line">        getAssignment(solvedAssignment).ifPresent(solvedAssignments::add);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLessonSolved</span><span class="params">()</span>&#123;<span class="keyword">return</span> allAssignments.size() == solvedAssignments.size();&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementAttempts</span><span class="params">()</span>&#123;</span><br><span class="line">        numberOfAttempts++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span>&#123;solvedAssignments.clear();&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;Assignment,Boolean&gt; <span class="title function_">getLessonOverview</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Assignment&gt; notSolved = allAssignments.stream()</span><br><span class="line">                .filter(i-&gt; !solvedAssignments.contains(i))</span><br><span class="line">                .toList();</span><br><span class="line">        Map&lt;Assignment,Boolean&gt; overview = notSolved.stream().collect(Collectors.toMap(a-&gt;a,b-&gt;<span class="literal">false</span>));</span><br><span class="line">        overview.putAll(solvedAssignments.stream().collect(Collectors.toMap(a-&gt;a,b-&gt;<span class="literal">true</span>)));</span><br><span class="line">        <span class="keyword">return</span> overview;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="AjaxAuthenticationEntryPoint"><a href="#AjaxAuthenticationEntryPoint" class="headerlink" title="AjaxAuthenticationEntryPoint"></a>AjaxAuthenticationEntryPoint</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AjaxAuthenticationEntryPoint</span> <span class="keyword">extends</span> <span class="title class_">LoginUrlAuthenticationEntryPoint</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AjaxAuthenticationEntryPoint</span><span class="params">(String loginFormUrl)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(loginFormUrl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authenticationException)</span> <span class="keyword">throws</span> IOException, ServletException&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getHeader(<span class="string">&quot;x-requested-with&quot;</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            x-requested-with 请求头 区分ajax请求还是普通请求 </span></span><br><span class="line">            response.sendError(<span class="number">401</span>,authenticationException.getMessage());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.commence(request,response,authenticationException);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="lessons-2"><a href="#lessons-2" class="headerlink" title="lessons"></a>lessons</h2><h3 id="Initializeable"><a href="#Initializeable" class="headerlink" title="Initializeable"></a>Initializeable</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.WebGoatUser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Initializeable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(WebGoatUser webGoatUser)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DatabaseConfiguration"><a href="#DatabaseConfiguration" class="headerlink" title="DatabaseConfiguration"></a>DatabaseConfiguration</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.LessonScanner;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.flywaydb.core.Flyway;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//这是一个配置类</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="comment">//@RequiredArgsConstructor(onConstructor =@_(@Autowired))</span></span><br><span class="line"><span class="comment">//写在类上可以代替@Autowired注解，需要注意的是在注入时需要用final定义，或者使用@notnull注解</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">//使用日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSourceProperties properties;</span><br><span class="line"><span class="comment">//   用于读取配置信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LessonScanner lessonScanner;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line"><span class="comment">//    @Primary只是让系统知道如果存在多个相同类型的bean时，自动选择哪一个。</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DriverManagerDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DriverManagerDataSource</span>();</span><br><span class="line">        dataSource.setDriverClassName(properties.getDriverClassName());</span><br><span class="line"><span class="comment">//        获取驱动类</span></span><br><span class="line">        dataSource.setUrl(properties.getUrl());</span><br><span class="line"><span class="comment">//        获取路径信息</span></span><br><span class="line">        dataSource.setUsername(properties.getUsername());</span><br><span class="line"><span class="comment">//        获取username</span></span><br><span class="line">        dataSource.setPassword(properties.getPassword());</span><br><span class="line"><span class="comment">//        获取密码</span></span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(initMethod = &quot;migrate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flyway <span class="title function_">flyWayContainer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Flyway</span><br><span class="line">                .configure()</span><br><span class="line"><span class="comment">//                创建一个配置</span></span><br><span class="line">                .configuration(Map.of(<span class="string">&quot;driver&quot;</span>,properties.getDriverClassName()))</span><br><span class="line"><span class="comment">//          取出驱动放入配置中去</span></span><br><span class="line">                .dataSource(dataSource())</span><br><span class="line"><span class="comment">//                从上面的数据源放入flyway中</span></span><br><span class="line">                .schemas(<span class="string">&quot;container&quot;</span>)</span><br><span class="line"><span class="comment">//                设置管理模式</span></span><br><span class="line">                .locations(<span class="string">&quot;db/container&quot;</span>)</span><br><span class="line"><span class="comment">//                设置递归扫描迁移的位置为classpath:db/container</span></span><br><span class="line">                .load();</span><br><span class="line"><span class="comment">//              返回flyway对象</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Function&lt;String,Flyway&gt; <span class="title function_">flywayLessons</span><span class="params">(LessonDataSource lessonDataSource)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> schema -&gt; Flyway</span><br><span class="line">                .configure()</span><br><span class="line">                .configuration(Map.of(<span class="string">&quot;driver&quot;</span>,properties.getDriverClassName()))</span><br><span class="line">                .schemas(schema)</span><br><span class="line">                .dataSource(lessonDataSource)</span><br><span class="line">                .locations(<span class="string">&quot;lessons&quot;</span>)</span><br><span class="line">                .load();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LessonDataSource <span class="title function_">lessonDataSource</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LessonDataSource</span>(dataSource());&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LessonDataSource"><a href="#LessonDataSource" class="headerlink" title="LessonDataSource"></a>LessonDataSource</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.LessonConnectionInvocationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.ConnectionProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.crypto.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLFeatureNotSupportedException;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonDataSource</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSource originalDataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonDataSource</span><span class="params">(DataSource dataSource)</span>&#123;<span class="built_in">this</span>.originalDataSource = dataSource;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">targetConnection</span> <span class="operator">=</span> originalDataSource.getConnection();</span><br><span class="line"><span class="comment">//        获取与数据库的连接</span></span><br><span class="line">        <span class="keyword">return</span> (Connection) Proxy.newProxyInstance(</span><br><span class="line">                ConnectionProxy.class.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;ConnectionProxy.class&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LessonConnectionInvocationHandler</span>(targetConnection));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> originalDataSource.getConnection(username,password);</span><br><span class="line"><span class="comment">//        获取连接</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PrintWriter <span class="title function_">getLogWriter</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> originalDataSource.getLogWriter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLogWriter</span><span class="params">(PrintWriter out)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        originalDataSource.setLogWriter(out);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        originalDataSource.setLoginTimeout(seconds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLoginTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> originalDataSource.getLoginTimeout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Logger <span class="title function_">getParentLogger</span><span class="params">()</span> <span class="keyword">throws</span> SQLFeatureNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> originalDataSource.getParentLogger();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">unwrap</span><span class="params">(Class&lt;T&gt; iface)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> originalDataSource.unwrap(iface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isWrapperFor</span><span class="params">(Class&lt;?&gt; iface)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> originalDataSource.isWrapperFor(iface);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="lessons-3"><a href="#lessons-3" class="headerlink" title="lessons"></a>lessons</h2><h3 id="LessonConnectionInvocationHandler"><a href="#LessonConnectionInvocationHandler" class="headerlink" title="LessonConnectionInvocationHandler"></a>LessonConnectionInvocationHandler</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.WebGoatUser;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">//日志系统</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonConnectionInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Connection targetConnection;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonConnectionInvocationHandler</span><span class="params">(Connection targetConnection)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.targetConnection = targetConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line"><span class="comment">//        进行身份验证的?</span></span><br><span class="line">        <span class="keyword">if</span> (authentication != <span class="literal">null</span> &amp;&amp; authentication.getPrincipal() <span class="keyword">instanceof</span> WebGoatUser user)&#123;</span><br><span class="line"><span class="comment">//            如果拿到的对象输入webgoatuser就执行</span></span><br><span class="line">            <span class="keyword">try</span>(<span class="type">var</span> <span class="variable">statement</span> <span class="operator">=</span> targetConnection.createStatement())&#123;</span><br><span class="line">                statement.execute(<span class="string">&quot;SET SCHEMA \&quot;&quot;</span> + user.getUsername() + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//                使模式成为SQL控制台会话的默认模式。如果不使用此语句，则会将默认模式视为用户模式。如果您正在使用系统用户，则很危险。</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(targetConnection,args);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InvocationTargetException e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> e.getTargetException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="启动一下"><a href="#启动一下" class="headerlink" title="启动一下"></a>启动一下</h1><p>主要db下的目录要进行更改,并复制一个sql文件过来,否则无法正常启动</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713132111818.png" alt="image-20220713132111818"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713132146615.png" alt="image-20220713132146615"></p>
<h1 id="更改数据库为mysql"><a href="#更改数据库为mysql" class="headerlink" title="更改数据库为mysql"></a>更改数据库为mysql</h1><p>我实在是没搞懂这个hsqldb是咋访问的 我们先更改webgoat项目</p>
<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713132847377.png" alt="image-20220713132847377"></p>
<p>创建数据库</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713132712936.png" alt="image-20220713132712936"></p>
<p>修改properties文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/webgoat?serverTimezone=GMT%2B8&amp;characterEncoding=utf8&amp;useSSL=true</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>一看这三个肯定都是要更改的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713133100515.png" alt="image-20220713133100515"></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.jpa.database-platform</span>=<span class="string">org.hibernate.dialect.MySQL5Dialect</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/webgoat?serverTimezone=GMT%2B8&amp;characterEncoding=utf8&amp;useSSL=true</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713133236412.png" alt="image-20220713133236412"></p>
<p>这样启动会爆第一个错误 大概意思是sql语法错误,说明前后我们使用的数据库不同</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713212446172.png" alt="image-20220713212446172"></p>
<p>我们先删除这个两个sql文件 备份哦</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713212550955.png" alt="image-20220713212550955"></p>
<p>很明显这样启动也不会有好结果,这是因为我们数据库里并没有这些表</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713212708628.png" alt="image-20220713212708628"></p>
<p>那么我们现在需要去手动添加上这些表</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220714144857063.png" alt="image-20220714144857063"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713212900593.png" alt="image-20220713212900593"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713212916444.png" alt="image-20220713212916444"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713212943887.png" alt="image-20220713212943887"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213018476.png" alt="image-20220713213018476"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213038848.png" alt="image-20220713213038848"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213258184.png" alt="image-20220713213258184"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213316115.png" alt="image-20220713213316115"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213326142.png" alt="image-20220713213326142"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213348775.png" alt="image-20220713213348775"></p>
<p>有关联关系 你不会不会执行吧?</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713213506799.png" alt="image-20220713213506799"></p>
<p>发现注册的时候报错了 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713222315600.png" alt="image-20220713222315600"></p>
<p>但是用户注册上了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220713222347793.png" alt="image-20220713222347793"></p>
<h1 id="server"><a href="#server" class="headerlink" title="server"></a>server</h1><h2 id="StartWebGoat"><a href="#StartWebGoat" class="headerlink" title="StartWebGoat"></a>StartWebGoat</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.hsqldb.lib.StringUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.event.ApplicationReadyEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.ContextStoppedEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// 把普通破击实例化到spring容器中</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//自动生成无参构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartupMessage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line"><span class="comment">//    用于事件的监听</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStartup</span><span class="params">(ApplicationReadyEvent event)</span>&#123;</span><br><span class="line"><span class="comment">//        这里是启动时做的事情</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(port) &amp;&amp; !StringUtils.hasText(System.getProperty(<span class="string">&quot;running.in.docker&quot;</span>)))&#123;</span><br><span class="line"><span class="comment">//            运行在docker</span></span><br><span class="line">            log.info(<span class="string">&quot;Please browse to http://&#123;&#125;:&#123;&#125;/WebGoat to get started...&quot;</span>,address,port);</span><br><span class="line"><span class="comment">//            打出日志</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (event.getApplicationContext().getApplicationName().contains(<span class="string">&quot;WebGoat&quot;</span>))&#123;</span><br><span class="line">            port = event.getApplicationContext().getEnvironment().getProperty(<span class="string">&quot;server.port&quot;</span>);</span><br><span class="line">            address = event.getApplicationContext().getEnvironment().getProperty(<span class="string">&quot;server.address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">void</span>  <span class="title function_">onShutdown</span><span class="params">(ContextStoppedEvent event)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220714162530862.png" alt="image-20220714162530862"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220714163628605.png" alt="image-20220714163628605"></p>
<h1 id="container-3"><a href="#container-3" class="headerlink" title="container"></a>container</h1><h2 id="HammerHead"><a href="#HammerHead" class="headerlink" title="HammerHead"></a>HammerHead</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.Course;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HammerHead</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Course course;</span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/attack&quot;,method = &#123;RequestMethod.GET,RequestMethod.POST&#125;)</span></span><br><span class="line"><span class="comment">//   接受/attack 的get和post请求</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">attack</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        视图层和数据层</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;redirect:&quot;</span>+<span class="string">&quot;start.mvc&quot;</span> + course.getFirstLesson().getLink());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="session-2"><a href="#session-2" class="headerlink" title="session"></a>session</h2><h3 id="Course"><a href="#Course" class="headerlink" title="Course"></a>Course</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Course</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Lesson&gt; lessons;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Course</span><span class="params">(List&lt;Lesson&gt; lessons)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.lessons = lessons;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">getCategories</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lessons.parallelStream().map(Lesson::getCategory).distinct().sorted().toList();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Lesson <span class="title function_">getFirstLesson</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getLessons(getCategories().get(<span class="number">0</span>)).get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Lesson&gt; <span class="title function_">getLessons</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.lessons;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Lesson&gt; <span class="title function_">getLessons</span><span class="params">(Category category)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.lessons.stream().filter(l-&gt;l.getCategory() == category).toList();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLessons</span><span class="params">(List&lt;Lesson&gt; lessons)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.lessons = lessons;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalOfLessons</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.lessons.size();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalOfAssignments</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.lessons.stream().reduce(<span class="number">0</span>,(total,lessons) -&gt; lessons.getAssignments().size() + total,Integer::sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="assignments"><a href="#assignments" class="headerlink" title="assignments"></a>assignments</h2><h3 id="AssignmentHints"><a href="#AssignmentHints" class="headerlink" title="AssignmentHints"></a>AssignmentHints</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.assignments;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="comment">//注解作用于接口 类 枚举</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//注解不仅被保存到class文件中,jvm加载class文件之后依然存在</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AssignmentHints &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AssignmentPath"><a href="#AssignmentPath" class="headerlink" title="AssignmentPath"></a>AssignmentPath</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.assignments;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="comment">//存放在接口 类 枚举</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AssignmentPath &#123;</span><br><span class="line">    String[] path() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    RequestMethod[] method() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="AssignmentEndpoint"><a href="#AssignmentEndpoint" class="headerlink" title="AssignmentEndpoint"></a>AssignmentEndpoint</h3><h3 id="AttackResult"><a href="#AttackResult" class="headerlink" title="AttackResult"></a>AttackResult</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.assignments;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.PluginMessages;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.commons.text.StringEscapeUtils.escapeJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttackResult</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AttackResultBuilder</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> lessonCompleted;</span><br><span class="line"><span class="comment">//        关卡是否完成</span></span><br><span class="line">        <span class="keyword">private</span> PluginMessages messages;</span><br><span class="line">        <span class="keyword">private</span> Object[] feedbackArgs;</span><br><span class="line">        <span class="keyword">private</span> String feedbackResourceBundleKey;</span><br><span class="line">        <span class="keyword">private</span> String output;</span><br><span class="line">        <span class="keyword">private</span> Object[] outputArgs;</span><br><span class="line">        <span class="keyword">private</span> AssignmentEndpoint assignment;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">attemptWasMade</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">AttackResultBuilder</span> <span class="params">(PluginMessages messages)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.messages = messages;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">lessonCompleted</span><span class="params">(<span class="type">boolean</span> lessonCompleted)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.lessonCompleted = lessonCompleted;</span><br><span class="line">            <span class="built_in">this</span>.feedbackResourceBundleKey = <span class="string">&quot;lesson.completed&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">leslessonCompleted</span><span class="params">(<span class="type">boolean</span> lessonCompleted,String resourceBundleKey)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.lessonCompleted = lessonCompleted;</span><br><span class="line">            <span class="built_in">this</span>.feedbackResourceBundleKey = resourceBundleKey;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">feedbackArgs</span><span class="params">(Object... args)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.feedbackArgs = args;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">feedback</span><span class="params">(String resourceBundleKey)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.feedbackResourceBundleKey = resourceBundleKey;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">output</span><span class="params">(String output)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.output = output;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">outputArgs</span><span class="params">(Object... args)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.outputArgs = args;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">attemptWasMade</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.attemptWasMade = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResult <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AttackResult</span>(lessonCompleted, messages.getMessage(feedbackResourceBundleKey, feedbackArgs), messages.getMessage(output, output, outputArgs), assignment.getClass().getSimpleName(), attemptWasMade);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> AttackResultBuilder <span class="title function_">assignment</span><span class="params">(AssignmentEndpoint assignment)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.assignment = assignment;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> lessonCompleted;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String feedback;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String output;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String assignment;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> attemptWasMade;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AttackResult</span><span class="params">(<span class="type">boolean</span> lessonCompleted,String feedback, String output,String assignment,<span class="type">boolean</span> attemptWasMade)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.lessonCompleted = lessonCompleted;</span><br><span class="line">        <span class="built_in">this</span>.feedback = escapeJson(feedback);</span><br><span class="line">        <span class="built_in">this</span>.output = escapeJson(output);</span><br><span class="line">        <span class="built_in">this</span>.assignment = assignment;</span><br><span class="line">        <span class="built_in">this</span>.attemptWasMade = attemptWasMade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  AttackResultBuilder <span class="title function_">builder</span><span class="params">(PluginMessages messages)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AttackResultBuilder</span>(messages);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">assignmentSolved</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lessonCompleted;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="LessonTrackerInterceptor"><a href="#LessonTrackerInterceptor" class="headerlink" title="LessonTrackerInterceptor"></a>LessonTrackerInterceptor</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.assignments;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTracker;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTrackerRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.MethodParameter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonTrackerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ResponseBodyAdvice</span>&lt;Object&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> UserTrackerRepository userTrackerRepository;</span><br><span class="line">    <span class="keyword">private</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonTrackerInterceptor</span><span class="params">(UserTrackerRepository userTrackerRepository,WebSession webSession)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.userTrackerRepository = userTrackerRepository;</span><br><span class="line">        <span class="built_in">this</span>.webSession = webSession;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(MethodParameter methodParameter, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">beforeBodyWrite</span><span class="params">(Object o, MethodParameter methodParameter, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> AttackResult attackResult)&#123;</span><br><span class="line">            trackProgress(attackResult);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> AttackResult <span class="title function_">trackProgress</span><span class="params">(AttackResult attackResult)</span>&#123;</span><br><span class="line">        <span class="type">UserTracker</span> <span class="variable">userTracker</span> <span class="operator">=</span> userTrackerRepository.findByUser(webSession.getUserName());</span><br><span class="line">        <span class="keyword">if</span> (userTracker == <span class="literal">null</span>)&#123;</span><br><span class="line">            userTracker = <span class="keyword">new</span> <span class="title class_">UserTracker</span>(webSession.getUserName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (attackResult.assignmentSolved())&#123;</span><br><span class="line">            userTracker.assignmentSolved(webSession.getCurrentLesson(),attackResult.getAssignment());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            userTracker.assignmentFailed(webSession.getCurrentLesson());</span><br><span class="line">        &#125;</span><br><span class="line">        userTrackerRepository.saveAndFlush(userTracker);</span><br><span class="line">        <span class="keyword">return</span> attackResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><h3 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//Controller 该类代表控制器(控制层 表现层)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Welcome</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WELCOMED</span> <span class="operator">=</span> <span class="string">&quot;welcomed&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(path = &#123;&quot;welcome.mvc&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">welcome</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="comment">//        获取httpsession对象</span></span><br><span class="line">        <span class="keyword">if</span> (session.getAttribute(WELCOMED) == <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            如果获取到的webcomed是空就进行赋值</span></span><br><span class="line">            session.setAttribute(WELCOMED,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        model.setViewName(<span class="string">&quot;forward:/attack?start=true&quot;</span>);</span><br><span class="line"><span class="comment">//        这里也是进行请求转发到/attack?start=true</span></span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="StartLesson"><a href="#StartLesson" class="headerlink" title="StartLesson"></a>StartLesson</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.Course;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartLesson</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession ws;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Course course;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StartLesson</span><span class="params">(WebSession ws,Course course)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.ws = ws;</span><br><span class="line">        <span class="built_in">this</span>.course = course;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path =  &quot;startlesson.mvc&quot;,method = &#123;RequestMethod.GET,RequestMethod.POST&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        model.addObject(<span class="string">&quot;course&quot;</span>,course);</span><br><span class="line">        model.addObject(<span class="string">&quot;lesson&quot;</span>,ws.getCurrentLesson());</span><br><span class="line"><span class="comment">//        设置model中存放的数据</span></span><br><span class="line">        model.setViewName(<span class="string">&quot;lesson_content&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;*.lesson&quot;&#125;,produces = &quot;text/html&quot;)</span></span><br><span class="line"><span class="comment">//  produces指定返回编码</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">lessonPage</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;lesson_content&quot;</span>);</span><br><span class="line">        <span class="type">var</span> <span class="variable">path</span> <span class="operator">=</span> request.getRequestURI().toString();</span><br><span class="line"><span class="comment">//        获取得到的路径 现在我们得到了 /a/b/c/AccessControlMatrix.lesson</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">lessonName</span> <span class="operator">=</span> path.substring(path.lastIndexOf(<span class="string">&#x27;/&#x27;</span>)+<span class="number">1</span>,path.indexOf(<span class="string">&quot;.lesson&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        course.getLessons()</span><br><span class="line">                .stream()</span><br><span class="line">                .filter(l-&gt;l.getId().equals(lessonName))</span><br><span class="line">                .findFirst()</span><br><span class="line">                .ifPresent(lesson -&gt; &#123;</span><br><span class="line">                    ws.setCurrentLesson(lesson);</span><br><span class="line">                    model.addObject(<span class="string">&quot;lesson&quot;</span>,lesson);</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="lessons-4"><a href="#lessons-4" class="headerlink" title="lessons"></a>lessons</h2><h3 id="CourseConfiguration"><a href="#CourseConfiguration" class="headerlink" title="CourseConfiguration"></a>CourseConfiguration</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.Course;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ArrayUtils;</span><br><span class="line"><span class="keyword">import</span> org.hsqldb.lib.ArrayUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.stream.Collectors.groupingBy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//将想要的组件添加到容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Lesson&gt; lessons;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;AssignmentEndpoint&gt; assignment;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String,List&lt;AssignmentEndpoint&gt;&gt; assignmentsByPackage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CourseConfiguration</span><span class="params">(List&lt;Lesson&gt; lessons, List&lt;AssignmentEndpoint&gt; assignment)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lessons = lessons;</span><br><span class="line">        <span class="built_in">this</span>.assignment = assignment;</span><br><span class="line">        assignmentsByPackage = <span class="built_in">this</span>.assignment.stream().collect(groupingBy(a -&gt;a.getClass().getPackageName()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Course <span class="title function_">course</span><span class="params">()</span>&#123;</span><br><span class="line">        lessons.stream().forEach(l-&gt;l.setAssignments(createAssignment(l)));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Course</span>(lessons);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Assignment&gt; <span class="title function_">createAssignment</span><span class="params">(Lesson lesson)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">endpoints</span> <span class="operator">=</span> assignmentsByPackage.get(lesson.getClass().getPackageName());</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(endpoints))&#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Lesson:&#123;&#125; hax no endpoints, is this intentionally?&quot;</span>,lesson.getTitle());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> endpoints.stream()</span><br><span class="line">                .map(e-&gt;<span class="keyword">new</span> <span class="title class_">Assignment</span>(e.getClass().getSimpleName(),getPath(e.getClass()),getHints(e.getClass())))</span><br><span class="line">                .toList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getPath</span><span class="params">(Class&lt;? extends AssignmentEndpoint&gt; e)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Method m : e.getMethods())&#123;</span><br><span class="line">            <span class="keyword">if</span> (methodReturnTypeIsOfTypeAttackResult(m))&#123;</span><br><span class="line">                <span class="type">var</span> <span class="variable">mapping</span> <span class="operator">=</span> getMapping(m);</span><br><span class="line">                <span class="keyword">if</span> (mapping != <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> mapping;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Assignment endpoint: &quot;</span> + e + <span class="string">&quot; has no mapping like @GetMapping/@PostMapping etc,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;with return type &#x27;AttackResult&#x27; or &#x27;ResponseEntity&lt;AttackResult&gt;&#x27; please consider adding one&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">methodReturnTypeIsOfTypeAttackResult</span><span class="params">(Method m )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (m.getReturnType() == AttackResult.class)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">var</span> <span class="variable">genericType</span> <span class="operator">=</span> m.getGenericReturnType();</span><br><span class="line">        <span class="keyword">if</span> (genericType <span class="keyword">instanceof</span> ParameterizedType)&#123;</span><br><span class="line">            <span class="keyword">return</span> ((ParameterizedType) m.getGenericReturnType()).getActualTypeArguments()[<span class="number">0</span>] == AttackResult.class;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getMapping</span><span class="params">(Method m)</span>&#123;</span><br><span class="line">        String[] paths = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (m.getAnnotation(RequestMapping.class)!= <span class="literal">null</span>)&#123;</span><br><span class="line">            paths = ArrayUtils.addAll(m.getAnnotation(RequestMapping.class).value(),m.getAnnotation(RequestMapping.class).path());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m.getAnnotation(PostMapping.class) != <span class="literal">null</span>) &#123;</span><br><span class="line">            paths = ArrayUtils.addAll(m.getAnnotation(PostMapping.class).value(), m.getAnnotation(PostMapping.class).path());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m.getAnnotation(GetMapping.class) != <span class="literal">null</span>) &#123;</span><br><span class="line">            paths = ArrayUtils.addAll(m.getAnnotation(GetMapping.class).value(), m.getAnnotation(GetMapping.class).path());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m.getAnnotation(PutMapping.class) != <span class="literal">null</span>) &#123;</span><br><span class="line">            paths = ArrayUtils.addAll(m.getAnnotation(PutMapping.class).value(), m.getAnnotation(PutMapping.class).path());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (paths == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.stream(paths).filter(path -&gt; !<span class="string">&quot;&quot;</span>.equals(path) ).findFirst().orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String &gt; getHints(Class&lt;? <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &gt; e)&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.isAnnotationPresent(AssignmentHints.class))&#123;</span><br><span class="line">            <span class="keyword">return</span> List.of(e.getAnnotationsByType(AssignmentHints.class)[<span class="number">0</span>].value());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Value;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="comment">//@Value同样会生成getter、toString、hashCode等方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hint</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String hint;</span><br><span class="line">    <span class="keyword">private</span> String assignmentPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LessonInfoModel"><a href="#LessonInfoModel" class="headerlink" title="LessonInfoModel"></a>LessonInfoModel</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonInfoModel</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String lessonTitle;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasSource;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasSolution;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasPlan;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LessonMenuItem"><a href="#LessonMenuItem" class="headerlink" title="LessonMenuItem"></a>LessonMenuItem</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonMenuItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> LessonMenuItemType type;</span><br><span class="line">    <span class="keyword">private</span> List&lt;LessonMenuItem&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> complete;</span><br><span class="line">    <span class="keyword">private</span> String link;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> ranking;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">setName</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  List&lt;LessonMenuItem&gt; <span class="title function_">getChildren</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChildren</span><span class="params">(List&lt;LessonMenuItem&gt; children)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.children = children;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> LessonMenuItemType <span class="title function_">getType</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(LessonMenuItemType type)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addChild</span><span class="params">(LessonMenuItem child)</span>&#123;</span><br><span class="line">        children.add(child);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        builder.append(<span class="string">&quot;Name: &quot;</span>).append(name).append(<span class="string">&quot; | &quot;</span>);</span><br><span class="line">        builder.append(<span class="string">&quot;Type: &quot;</span>).append(name).append(<span class="string">&quot; | &quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isComplete</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> complete;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setComplete</span><span class="params">(<span class="type">boolean</span> complete)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.complete = complete;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLink</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> link;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLink</span><span class="params">(String link)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.link = link;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">setRanking</span><span class="params">(<span class="type">int</span> ranking)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.ranking = ranking;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getRanking</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.ranking;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LessonMenuItemType"><a href="#LessonMenuItemType" class="headerlink" title="LessonMenuItemType"></a>LessonMenuItemType</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.lessons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">LessonMenuItemType</span> &#123;</span><br><span class="line"><span class="comment">//    定义一个枚举类型</span></span><br><span class="line">    CATEGORY,</span><br><span class="line">    LESSON,</span><br><span class="line">    STAGE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="WebWolfRedirect"><a href="#WebWolfRedirect" class="headerlink" title="WebWolfRedirect"></a>WebWolfRedirect</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebWolfRedirect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApplicationContext applicationContext;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/WebWolf&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">openWebWolf</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">url</span> <span class="operator">=</span> applicationContext.getEnvironment().getProperty(<span class="string">&quot;webwolf.url&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;redirect:&quot;</span>+url+<span class="string">&quot;/home&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="webwolf-1"><a href="#webwolf-1" class="headerlink" title="webwolf"></a>webwolf</h1><h2 id="user"><a href="#user" class="headerlink" title="user"></a>user</h2><h3 id="UserService-1"><a href="#UserService-1" class="headerlink" title="UserService"></a>UserService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">//@Service注解用于类上，标记当前类是一个service类，加上该注解会将当前类自动注入到spring容器中，不需要再在applicationContext.xml文件定义bean了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> WebGoatUser <span class="title function_">loadUserByUsername</span><span class="params">(<span class="keyword">final</span> String username)</span> <span class="keyword">throws</span> UsernameNotFoundException&#123;</span><br><span class="line">        <span class="type">WebGoatUser</span> <span class="variable">webGoatUser</span> <span class="operator">=</span> userRepository.findByUsername(username);</span><br><span class="line"><span class="comment">//        调接口去查找用户名</span></span><br><span class="line">        <span class="keyword">if</span> (webGoatUser == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;User not found&quot;</span>);</span><br><span class="line"><span class="comment">//            抛出新异常User 没找到</span></span><br><span class="line">        &#125;</span><br><span class="line">        webGoatUser.createUser();</span><br><span class="line">        <span class="keyword">return</span> webGoatUser;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(<span class="keyword">final</span> String username, <span class="keyword">final</span> String password)</span> &#123;</span><br><span class="line">        userRepository.save(<span class="keyword">new</span> <span class="title class_">WebGoatUser</span>(username, password));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserRepository-1"><a href="#UserRepository-1" class="headerlink" title="UserRepository"></a>UserRepository</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.WebGoatUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;WebGoatUser,String&gt; &#123;</span><br><span class="line"><span class="comment">//   JpaRepository 主要是用来查询的</span></span><br><span class="line">    WebGoatUser <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebGoatUser-1"><a href="#WebGoatUser-1" class="headerlink" title="WebGoatUser"></a>WebGoatUser</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Transient;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebGoatUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">WebGoatUser</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">WebGoatUser</span><span class="params">(String username,String password)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        createUser();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.user = <span class="keyword">new</span> <span class="title class_">User</span>(username,password,getAuthorities());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities()&#123;<span class="keyword">return</span> Collections.emptyList();&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isAccountNonExpired();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isAccountNonLocked();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isCredentialsNonExpired();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.user.isEnabled();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="WebSecurityConfig-1"><a href="#WebSecurityConfig-1" class="headerlink" title="WebSecurityConfig"></a>WebSecurityConfig</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.webwolf.user.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configurers.ExpressionUrlAuthorizationConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.NoOpPasswordEncoder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//告诉spring 这是一个配置类</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//作用于类,生成一个参数为所有实例变量的构造方法</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="comment">//用于在项目中启用springsecurity 开启安全认证</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userDetailsService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span>  Exception&#123;</span><br><span class="line">        ExpressionUrlAuthorizationConfigurer&lt;HttpSecurity&gt;.<span class="type">ExpressionInterceptUrlRegistry</span> <span class="variable">security</span> <span class="operator">=</span> http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">//                开启登录匹配</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/webjars/**&quot;</span>,<span class="string">&quot;/home&quot;</span>).permitAll()</span><br><span class="line"><span class="comment">//                允许匿名的url 可以理解为放行接口 多个接口使用,分割</span></span><br><span class="line">                .antMatchers(HttpMethod.GET,<span class="string">&quot;/mail/**&quot;</span>,<span class="string">&quot;/requests/**&quot;</span>).authenticated()</span><br><span class="line"><span class="comment">//                这些get请求需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/files&quot;</span>).authenticated()</span><br><span class="line"><span class="comment">//                这些请求需要登录才能访问</span></span><br><span class="line">                .anyRequest().permitAll();</span><br><span class="line"><span class="comment">//              剩余请求可随意访问</span></span><br><span class="line">        security.and()</span><br><span class="line"><span class="comment">//                进行拼接</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line"><span class="comment">//              关闭csrf跨域</span></span><br><span class="line">                .formLogin().loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"><span class="comment">//                设置登录页面</span></span><br><span class="line">                .failureForwardUrl(<span class="string">&quot;/login?error=true&quot;</span>);</span><br><span class="line"><span class="comment">//                设置登录失败页面</span></span><br><span class="line"></span><br><span class="line">        security.and()</span><br><span class="line">                .formLogin().loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"><span class="comment">//                设置表单登录页面</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/home&quot;</span>,<span class="literal">true</span>)</span><br><span class="line">                .permitAll();</span><br><span class="line">        security.and()</span><br><span class="line">                .logout()</span><br><span class="line">                .permitAll();</span><br><span class="line"><span class="comment">//        注销操作</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureGlobal</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    将用户设置在内存中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsServiceBean</span><span class="params">()</span> <span class="keyword">throws</span>  Exception&#123;</span><br><span class="line">        <span class="keyword">return</span>  userDetailsService;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> NoOpPasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (NoOpPasswordEncoder) NoOpPasswordEncoder.getInstance();</span><br><span class="line"><span class="comment">//        不对密码进行加密操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MvcConfiguration-1"><a href="#MvcConfiguration-1" class="headerlink" title="MvcConfiguration"></a>MvcConfiguration</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//作为配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;webwolf.fileserver.location&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fileLocation;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/files/**&quot;</span>).addResourceLocations(<span class="string">&quot;file:///&quot;</span>+fileLocation+<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="comment">//        意思就是前段浏览器访问路径带有/file/**就转到对应磁盘下读取图片</span></span><br><span class="line"><span class="comment">//        类似于前端访问tomcat webapp下file文件夹中文件</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/css/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webwolf/static/css/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/js/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webwolf/static/js/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/images/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/webwolf/static/images/&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    当在springboot创建容器时执行</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createDirectory</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileLocation);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists())&#123;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="requests-1"><a href="#requests-1" class="headerlink" title="requests"></a>requests</h2><h3 id="Requests"><a href="#Requests" class="headerlink" title="Requests"></a>Requests</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.requests;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.trace.http.HttpTrace;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.trace.http.HttpTrace.Request;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.stream.Collectors.toList;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">// 该类代表控制类 控制层 响应层</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="comment">//写在类上可以代替@Autowired注解,需要注意的是在注入时需要用final定义,或者使用@notnull注解</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">//日志</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/requests&quot;)</span></span><br><span class="line"><span class="comment">//对应请求的路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Requests</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebWolfTraceRepository traceRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectMapper objectMapper;</span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//    生成有参构造</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Tracert</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Instant date;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String path;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String json;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;requests&quot;</span>);</span><br><span class="line">        <span class="type">var</span> <span class="variable">user</span> <span class="operator">=</span> (UserDetails) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line">        <span class="type">var</span> <span class="variable">traces</span> <span class="operator">=</span> traceRepository.findAllTraces().stream()</span><br><span class="line">                .filter(t -&gt; allowedTrace(t,user))</span><br><span class="line">                .map(t -&gt; <span class="keyword">new</span> <span class="title class_">Tracert</span>(t.getTimestamp(),path(t),toJsonString(t))).collect(toList());</span><br><span class="line">        model.addObject(<span class="string">&quot;traces&quot;</span>,traces);</span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">allowedTrace</span><span class="params">(HttpTrace t, UserDetails user)</span>&#123;</span><br><span class="line">        <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> t.getRequest();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allowed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (req.getUri().getPath().contains(<span class="string">&quot;/files&quot;</span>) &amp;&amp; !req.getUri().getPath().contains(user.getUsername()))&#123;</span><br><span class="line">            allowed = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.getUri().getPath().contains(<span class="string">&quot;/landing&quot;</span>) &amp;&amp; req.getUri().getPath()!=<span class="literal">null</span> &amp;&amp; req.getUri().getQuery().contains(<span class="string">&quot;uniqueCode&quot;</span>) &amp;&amp; !req.getUri().getQuery().contains(StringUtils.reverse(user.getUsername())))&#123;</span><br><span class="line">            allowed = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> allowed;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">path</span><span class="params">(HttpTrace t)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (String) t.getRequest().getUri().getPath();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">toJsonString</span><span class="params">(HttpTrace trace)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> objectMapper.writeValueAsString(trace);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JsonProcessingException e)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;Unable to create json&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No request(s) found&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LandingPage"><a href="#LandingPage" class="headerlink" title="LandingPage"></a>LandingPage</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.requests;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/landing/**&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LandingPage</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(method = &#123;RequestMethod.POST,RequestMethod.GET,RequestMethod.DELETE,RequestMethod.DELETE,RequestMethod.PATCH,RequestMethod.PUT&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> Callable&lt;ResponseEntity&lt;?&gt;&gt; ok(HttpServletRequest request)&#123;</span><br><span class="line">        <span class="keyword">return</span> ()-&gt;&#123;</span><br><span class="line">            log.trace(<span class="string">&quot;Incoming request for: &#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="FileServer"><a href="#FileServer" class="headerlink" title="FileServer"></a>FileServer</h2><p>注意导入的WebGoatUser是那个类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.webwolf.user.WebGoatUser;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.view.RedirectView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.http.MediaType.ALL_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//代表控制类 控制层响应层</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;webwolf.fileserver.location&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fileLocation;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.address&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String server;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path= &quot;/file-server-location&quot;,consumes = ALL_VALUE,produces = MediaType.TEXT_PLAIN_VALUE)</span></span><br><span class="line"><span class="comment">//   consumes 指定处理请求的提交内容类型(Content-Type) 例如application/json text/html</span></span><br><span class="line"><span class="comment">//    produces 指定返回的内容类型,仅当request请求头中Accept类型中包含该指定类型才返回</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFileLocation</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileLocation;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/fileupload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">importFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span>MultipartFile myFile)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line"><span class="comment">//        MultipartFile 文件上传工具类</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">user</span> <span class="operator">=</span> (WebGoatUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line"><span class="comment">//        用于获取当前对象</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">destinationDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileLocation,user.getUsername());</span><br><span class="line"><span class="comment">//        新建文件名和文件位置</span></span><br><span class="line">        destinationDir.mkdirs();</span><br><span class="line"><span class="comment">//        mkdirs可以创建多级目录</span></span><br><span class="line">        myFile.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(destinationDir,myFile.getOriginalFilename()));</span><br><span class="line">        log.debug(<span class="string">&quot;File save to &#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">File</span>(destinationDir,myFile.getOriginalFilename()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">RedirectView</span>(<span class="string">&quot;files&quot;</span>,<span class="literal">true</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ModelMap</span>().addAttribute(<span class="string">&quot;uploadSuccess&quot;</span>,<span class="string">&quot;File uploaded successful&quot;</span>)</span><br><span class="line"></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//    生成有参构造</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line"><span class="comment">//    生成get方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">UploadedFile</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String size;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String link;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/files&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">getFiles</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">WebGoatUser</span> <span class="variable">user</span> <span class="operator">=</span> (WebGoatUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line"><span class="comment">//        获取当前用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> user.getUsername();</span><br><span class="line">        <span class="type">File</span> <span class="variable">destinationDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileLocation,username);</span><br><span class="line"></span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line"><span class="comment">//        新建视图层</span></span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;files&quot;</span>);</span><br><span class="line"><span class="comment">//        添加视图名称</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">changeIndicatorFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destinationDir,user.getUsername()+<span class="string">&quot;_changed&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (changeIndicatorFile.exists())&#123;</span><br><span class="line"><span class="comment">//            如果文件已经存在的话 就添加请求上传成功</span></span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;uploadSuccess&quot;</span>,request.getParameter(<span class="string">&quot;uploadSuccess&quot;</span>));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        changeIndicatorFile.delete();</span><br><span class="line"><span class="comment">//        然后把文件删除</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">uploadedFiles</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        File[] files = destinationDir.listFiles(File::isFile);</span><br><span class="line">        <span class="keyword">if</span> (files != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (File file : files)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">size</span> <span class="operator">=</span> FileUtils.byteCountToDisplaySize(file.length());</span><br><span class="line">                <span class="type">String</span> <span class="variable">link</span> <span class="operator">=</span> String.format(<span class="string">&quot;files/%s/%s&quot;</span>,username,file.getName());</span><br><span class="line">                uploadedFiles.add(<span class="keyword">new</span> <span class="title class_">UploadedFile</span>(file.getName(),size,link));</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            列出文件名并添加进去</span></span><br><span class="line">        &#125;</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;files&quot;</span>,uploadedFiles);</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;webwolf_url&quot;</span>,<span class="string">&quot;http://&quot;</span>+server+<span class="string">&quot;:&quot;</span>+port);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="mailbox"><a href="#mailbox" class="headerlink" title="mailbox"></a>mailbox</h2><h3 id="Email"><a href="#Email" class="headerlink" title="Email"></a>Email</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.mailbox;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//作为数据类</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="comment">//可以链式调用的方式给赋值</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//生成有参构造</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">//指数据映射到数据库中</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//生成无参构造</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Email</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy =  GenerationType.IDENTITY)</span></span><br><span class="line"><span class="comment">// 主键自增</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line"><span class="comment">//    在json时进行忽略</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"><span class="comment">//    返回当时时区的时间</span></span><br><span class="line">    <span class="meta">@Column(length = 1024)</span></span><br><span class="line"><span class="comment">//    对string类型设置最大长度</span></span><br><span class="line">    <span class="keyword">private</span> String contents;</span><br><span class="line">    <span class="keyword">private</span> String sender;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String recipient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSummary</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-&quot;</span> + <span class="built_in">this</span>.contents.substring(<span class="number">0</span>,Math.min(<span class="number">50</span>,contents.length()));</span><br><span class="line"><span class="comment">//        先取contents的长度与50之中的最小值 接着进行截取</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> LocalDateTime <span class="title function_">getTimestamp</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> time;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTime</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DateTimeFormatter.ofPattern(<span class="string">&quot;h:mm a&quot;</span>).format(time);</span><br><span class="line"><span class="comment">//        进行时间格式化</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getShortSender</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sender.substring(<span class="number">0</span>,sender.indexOf(<span class="string">&quot;@&quot;</span>));</span><br><span class="line"><span class="comment">//        进行截取</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MailboxController"><a href="#MailboxController" class="headerlink" title="MailboxController"></a>MailboxController</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.mailbox;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">//@RestController 是@controller和@ResponseBody 的结合</span></span><br><span class="line"><span class="comment">//@Controller 将当前修饰的类注入到springboot ioc容器,使得从该类所在的项目跑起来的过程中,这个类就被实例化</span></span><br><span class="line"><span class="comment">//@ResponseBody 它的作用简短的说就是指该类中的api即可返回的数据 不管对应方法返回map或者其他的object,它会以json字符串的形式返回给客户端</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailboxController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MailboxRepository mailboxRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/mail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">mail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> (UserDetails) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line"><span class="comment">//        获取当前用户名称</span></span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        List&lt;Email&gt; emails = mailboxRepository.findByRecipientOrderByTimeDesc(user.getUsername());</span><br><span class="line">        <span class="keyword">if</span> (emails != <span class="literal">null</span> &amp;&amp; !emails.isEmpty())&#123;</span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;total&quot;</span>,emails.size());</span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;emails&quot;</span>,emails);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;mailbox&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/mail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; sendEmail(<span class="meta">@RequestBody</span> Email email)&#123;</span><br><span class="line"><span class="comment">//获取请求体</span></span><br><span class="line">        mailboxRepository.save(email);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MailboxRepository"><a href="#MailboxRepository" class="headerlink" title="MailboxRepository"></a>MailboxRepository</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.mailbox;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MailboxRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Email,String &gt; &#123;</span><br><span class="line">    List&lt;Email&gt; <span class="title function_">findByRecipientOrderByTimeDesc</span><span class="params">(String recipient)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h2><h3 id="JWTController"><a href="#JWTController" class="headerlink" title="JWTController"></a>JWTController</h3><p>这里进行了修改,不然会造成jwt功能的无法正常使用.注意这里与原版的差异</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822202924467.png" alt="image-20220822202924467"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.owasp.webgoat.webwolf.jwt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.http.MediaType.APPLICATION_FORM_URLENCODED_VALUE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.http.MediaType.APPLICATION_JSON_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/jwt&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">jwt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;jwt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/WebWolf/jwt/decode&quot;, consumes = APPLICATION_FORM_URLENCODED_VALUE, produces = APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> JWTToken <span class="title function_">decode</span><span class="params">(<span class="meta">@RequestBody</span> MultiValueMap&lt;String, String&gt; formData)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">jwt</span> <span class="operator">=</span> formData.getFirst(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="type">var</span> <span class="variable">secretKey</span> <span class="operator">=</span> formData.getFirst(<span class="string">&quot;secretKey&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> JWTToken.decode(jwt, secretKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/WebWolf/jwt/encode&quot;, consumes = APPLICATION_FORM_URLENCODED_VALUE, produces = APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> JWTToken <span class="title function_">encode</span><span class="params">(<span class="meta">@RequestBody</span> MultiValueMap&lt;String, String&gt; formData)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">header</span> <span class="operator">=</span> formData.getFirst(<span class="string">&quot;header&quot;</span>);</span><br><span class="line">        <span class="type">var</span> <span class="variable">payload</span> <span class="operator">=</span> formData.getFirst(<span class="string">&quot;payload&quot;</span>);</span><br><span class="line">        <span class="type">var</span> <span class="variable">secretKey</span> <span class="operator">=</span> formData.getFirst(<span class="string">&quot;secretKey&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> JWTToken.encode(header, payload, secretKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JWTToken"><a href="#JWTToken" class="headerlink" title="JWTToken"></a>JWTToken</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.webwolf.jwt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.*;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.jws.JsonWebSignature;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.jwt.consumer.InvalidJwtException;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.jwt.consumer.JwtConsumer;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.jwt.consumer.JwtConsumerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.jwx.CompactSerializer;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.keys.HmacKey;</span><br><span class="line"><span class="keyword">import</span> org.jose4j.lang.JoseException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.nio.charset.StandardCharsets.UTF_8;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.util.Base64Utils.decodeFromUrlSafeString;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.util.StringUtils.hasText;</span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//生成无参构造</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//生成全参构造</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="comment">//生成getter方法</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="comment">//生成setter方法</span></span><br><span class="line"><span class="meta">@Builder(toBuilder = true)</span></span><br><span class="line"><span class="comment">//可连续初始化对象  可以修改这个属性的值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTToken</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">encoded</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> validHeader;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> validPayload;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> validToken;</span><br><span class="line">    <span class="keyword">private</span> String payload;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">signatureValid</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JWTToken <span class="title function_">decode</span><span class="params">(String jwt, String secretKey)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">token</span> <span class="operator">=</span> parseToken(jwt.trim().replace(System.getProperty(<span class="string">&quot;line.separator&quot;</span>), <span class="string">&quot;&quot;</span>));</span><br><span class="line"><span class="comment">//        先去除字符串两端空格 这里是获取系统换行符接着将jwt中的换行符替换为空</span></span><br><span class="line">        <span class="keyword">return</span> token.toBuilder().signatureValid(validateSignature(secretKey, jwt)).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">parse</span><span class="params">(String header)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> reader.readValue(header, TreeMap.class);</span><br><span class="line"><span class="comment">//            这里进行反序列化出了一个treemap对象</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> Map.of();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">write</span><span class="params">(String originalValue, Map&lt;String, Object&gt; data)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writerWithDefaultPrettyPrinter();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.isEmpty()) &#123;</span><br><span class="line"><span class="comment">//                如果data是空的</span></span><br><span class="line">                <span class="keyword">return</span> originalValue;</span><br><span class="line"><span class="comment">//                就返回原先的字符串</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> writer.writeValueAsString(data);</span><br><span class="line"><span class="comment">//            将传入的对象序列化成json格式</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> originalValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JWTToken <span class="title function_">encode</span><span class="params">(String header,String payloadAsString,String secretKey)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">headers</span> <span class="operator">=</span> parse(header);</span><br><span class="line">        <span class="type">var</span> <span class="variable">payload</span> <span class="operator">=</span> parse(payloadAsString);</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">builder</span> <span class="operator">=</span> JWTToken.builder()</span><br><span class="line">                .header(write(header,headers))</span><br><span class="line">                .payload(write(header,headers))</span><br><span class="line">                .validHeader(!hasText(header)||!headers.isEmpty())</span><br><span class="line">                .validToken(<span class="literal">true</span>)</span><br><span class="line">                .validPayload(!hasText(payloadAsString)|| !payload.isEmpty());</span><br><span class="line">        <span class="type">JsonWebSignature</span> <span class="variable">jws</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonWebSignature</span>();</span><br><span class="line">        jws.setPayload(payloadAsString);</span><br><span class="line">        headers.forEach((k,v)-&gt;jws.setHeader(k,v));</span><br><span class="line">        <span class="keyword">if</span> (!headers.isEmpty())&#123;</span><br><span class="line">            builder.encoded(CompactSerializer.serialize(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;jws.getHeaders().getEncodedHeader(),jws.getEncodedPayload()&#125;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!headers.isEmpty() &amp;&amp; !payload.isEmpty() &amp;&amp; hasText(secretKey))&#123;</span><br><span class="line">            jws.setDoKeyValidation(<span class="literal">false</span>);</span><br><span class="line">            jws.setKey(<span class="keyword">new</span> <span class="title class_">HmacKey</span>(secretKey.getBytes(UTF_8)));</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                builder.encoded(jws.getCompactSerialization());</span><br><span class="line">                builder.signatureValid(<span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JoseException e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JWTToken <span class="title function_">parseToken</span><span class="params">(String jwt)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">token</span> <span class="operator">=</span> jwt.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line"><span class="comment">//        按.分割jwt</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">builder</span> <span class="operator">=</span> JWTToken.builder().encoded(jwt);</span><br><span class="line"><span class="comment">//        给encoded赋值为jwt</span></span><br><span class="line">        <span class="keyword">if</span> (token.length &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">var</span> <span class="variable">header</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decodeFromUrlSafeString(token[<span class="number">0</span>]), UTF_8);</span><br><span class="line"><span class="comment">//            先进行base64解码返回一个数组 接着转换成utf-8的形式</span></span><br><span class="line">            <span class="type">var</span> <span class="variable">payloadAsString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decodeFromUrlSafeString(token[<span class="number">1</span>]), UTF_8);</span><br><span class="line"></span><br><span class="line">            <span class="type">var</span> <span class="variable">headers</span> <span class="operator">=</span> parse(header);</span><br><span class="line">            <span class="type">var</span> <span class="variable">payload</span> <span class="operator">=</span> parse(payloadAsString);</span><br><span class="line">            builder.header(write(header, headers));</span><br><span class="line">            builder.payload(write(payloadAsString, payload));</span><br><span class="line">            builder.validHeader(!headers.isEmpty());</span><br><span class="line">            builder.validPayload(!payload.isEmpty());</span><br><span class="line">            builder.validToken(!headers.isEmpty() &amp;&amp; !payload.isEmpty());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            builder.validToken(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">validateSignature</span><span class="params">(String secretKey, String jwt)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasText(secretKey))&#123;</span><br><span class="line">            <span class="type">JwtConsumer</span> <span class="variable">jwtConsumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JwtConsumerBuilder</span>()</span><br><span class="line">                    .setSkipAllValidators()</span><br><span class="line">                    .setVerificationKey(<span class="keyword">new</span> <span class="title class_">HmacKey</span>(secretKey.getBytes(UTF_8)))</span><br><span class="line"><span class="comment">//                    设置密钥</span></span><br><span class="line">                    .setRelaxVerificationKeyValidation()</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                jwtConsumer.processToClaims(jwt);</span><br><span class="line"><span class="comment">//                这里是用自定义的密钥去验证jwt</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvalidJwtException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="resources"><a href="#resources" class="headerlink" title="resources"></a>resources</h2><p>webwolf静态资源 了解一下 thymeleaf 语法</p>
<p><img src="C:/Users/14980/AppData/Roaming/Typora/typora-user-images/image-20220723084922401.png" alt="image-20220723084922401"></p>
<p>注意这里的静态资源包里面的properties文件其实是html文件中会取出来的变量</p>
<p><img src="C:/Users/14980/AppData/Roaming/Typora/typora-user-images/image-20220723093406862.png" alt="image-20220723093406862"></p>
<h1 id="container-4"><a href="#container-4" class="headerlink" title="container"></a>container</h1><h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><h3 id="EnvironmentService"><a href="#EnvironmentService" class="headerlink" title="EnvironmentService"></a>EnvironmentService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController(&quot;/environment&quot;)</span></span><br><span class="line"><span class="comment">//@RestController 是@Controller和@ResponseBody的结合</span></span><br><span class="line"><span class="comment">//@Controller 将当前修饰的类注入到springboot ioc容器是的从该类所在的项目pao起来的过程中.这个类就被实例化</span></span><br><span class="line"><span class="comment">//@ResponseBody 它的作用简短的说就是该类中的api即可返回的数据不管对应方法返回map或者其他的object,他会以json字符串的形式返回给客户端</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="comment">//所有参数的构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnvironmentService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApplicationContext context;</span><br><span class="line"><span class="comment">//    用于访问程序资源</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/server-directory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">homeDirectory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context.getEnvironment().getProperty(<span class="string">&quot;webgoat.server.directory&quot;</span>);</span><br><span class="line"><span class="comment">//        读取配置文件</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="HintService"><a href="#HintService" class="headerlink" title="HintService"></a>HintService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Assignment;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Hint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.engine.HibernateIterator;</span><br><span class="line"><span class="keyword">import</span> org.jcodings.util.Hash;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HintService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_HINTS_MVC</span> <span class="operator">=</span> <span class="string">&quot;/service/hint.mvc&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HintService</span><span class="params">(WebSession webSession)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.webSession = webSession;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(path = URL_HINTS_MVC,produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="comment">//    返回json数据</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Hint&gt; <span class="title function_">getHints</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Lesson</span> <span class="variable">l</span> <span class="operator">=</span> webSession.getCurrentLesson();</span><br><span class="line">        <span class="keyword">return</span> createAssignmentHints(l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Hint&gt; <span class="title function_">createAssignmentHints</span><span class="params">(Lesson l )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l!= <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> l.getAssignments().stream()</span><br><span class="line">                    .map(<span class="built_in">this</span>::createHint)</span><br><span class="line">                    .flatMap(Collection::stream)</span><br><span class="line">                    .toList();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> List.of();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Hint&gt; <span class="title function_">createHint</span><span class="params">(Assignment a)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.getHints().stream().map(h -&gt; <span class="keyword">new</span> <span class="title class_">Hint</span>(h,a.getPath())).toList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LabelDebugService"><a href="#LabelDebugService" class="headerlink" title="LabelDebugService"></a>LabelDebugService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.LabelDebugger;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LabelDebugService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_DEBUG_LABELS_MVC</span> <span class="operator">=</span> <span class="string">&quot;/service/debug/labels.mvc&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_ENABLED</span> <span class="operator">=</span> <span class="string">&quot;enabled&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LabelDebugger labelDebugger;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = URL_DEBUG_LABELS_MVC,produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> ResponseEntity&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">checkDebuggingStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;Checking label debugging,it is &#123;&#125;&quot;</span>,labelDebugger.isEnabled());</span><br><span class="line">        Map&lt;String,Object&gt; result = createResponse(labelDebugger.isEnabled());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value = URL_DEBUG_LABELS_MVC,produces = MediaType.APPLICATION_JSON_VALUE,params = KEY_ENABLED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> ResponseEntity&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">setDebuggingStatus</span><span class="params">(<span class="meta">@RequestParam(&quot;enabled&quot;)</span> Boolean enabled)</span>&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;Setting label debugging to &#123;&#125;&quot;</span>,labelDebugger.isEnabled());</span><br><span class="line">        Map&lt;String,Object&gt; result =  createResponse(enabled);</span><br><span class="line">        labelDebugger.setEnabled(enabled);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(result,HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; <span class="title function_">createResponse</span><span class="params">(Boolean enabled)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Map.of(KEY_SUCCESS,Boolean.TRUE,KEY_ENABLED,enabled);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LabelService"><a href="#LabelService" class="headerlink" title="LabelService"></a>LabelService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.Messages;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.PluginMessages;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.RequestEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LabelService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_LABELS_MVC</span> <span class="operator">=</span> <span class="string">&quot;/service/labels.mvc&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Messages messages;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PluginMessages pluginMessages;</span><br><span class="line">    <span class="meta">@GetMapping(path = URL_LABELS_MVC,produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Properties&gt; <span class="title function_">fetchLeabels</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">allProperties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        allProperties.putAll(messages.getMessages());</span><br><span class="line">        allProperties.putAll(pluginMessages.getMessages());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(allProperties, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LessonInfoService"><a href="#LessonInfoService" class="headerlink" title="LessonInfoService"></a>LessonInfoService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.LessonInfoModel;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonInfoService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/service/lessoninfo.mvc&quot;,produces = &quot;application/json&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> LessonInfoModel <span class="title function_">getLessonInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Lesson</span> <span class="variable">lesson</span> <span class="operator">=</span> webSession.getCurrentLesson();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LessonInfoModel</span>(lesson.getTitle(),<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LessonMenuService"><a href="#LessonMenuService" class="headerlink" title="LessonMenuService"></a>LessonMenuService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.*;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.Course;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.LessonTracker;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTracker;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTrackerRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.parameters.P;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonMenuService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_LESSONMENU_MVC</span> <span class="operator">=</span> <span class="string">&quot;/service/lessonmenu.mvc&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Course course;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">private</span> UserTrackerRepository userTrackerRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;&#x27;$&#123;exclude.categories&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String &gt; excludeCategories;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;&#x27;$&#123;exclude.lessons&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String &gt; excludeLessons;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = URL_LESSONMENU_MVC,produces = &quot;application/json&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> List&lt;LessonMenuItem&gt; <span class="title function_">showLeftNav</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;LessonMenuItem&gt; menu = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Category&gt; categories = course.getCategories();</span><br><span class="line">        <span class="type">UserTracker</span> <span class="variable">userTracker</span> <span class="operator">=</span> userTrackerRepository.findByUser(webSession.getUserName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Category category: categories)&#123;</span><br><span class="line">            <span class="keyword">if</span> (excludeCategories.contains(category.name()))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">LessonMenuItem</span> <span class="variable">categoryItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LessonMenuItem</span>();</span><br><span class="line">            categoryItem.setName(category.getName());</span><br><span class="line">            categoryItem.setType(LessonMenuItemType.CATEGORY);</span><br><span class="line"></span><br><span class="line">            List&lt;Lesson&gt; lessons = course.getLessons(category);</span><br><span class="line">            lessons = lessons.stream().sorted(Comparator.comparing(Lesson::getTitle)).toList();</span><br><span class="line">            <span class="keyword">for</span> (Lesson lesson:lessons)&#123;</span><br><span class="line">                <span class="keyword">if</span> (excludeLessons.contains(lesson.getName()))&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">LessonMenuItem</span> <span class="variable">lessonItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LessonMenuItem</span>();</span><br><span class="line">                lessonItem.setName(lesson.getTitle());</span><br><span class="line">                lessonItem.setLink(lesson.getLink());</span><br><span class="line">                lessonItem.setType(LessonMenuItemType.LESSON);</span><br><span class="line">                <span class="type">LessonTracker</span> <span class="variable">lessonTracker</span> <span class="operator">=</span> userTracker.getLessonTracker(lesson);</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">lessonSolved</span> <span class="operator">=</span> lessonCompleted(lessonTracker.getLessonOverview(),lesson);</span><br><span class="line">                lessonItem.setComplete(lessonSolved);</span><br><span class="line">                categoryItem.addChild(lessonItem);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            categoryItem.getChildren().sort(((o1, o2) -&gt; o1.getRanking() - o2.getRanking()));</span><br><span class="line">            menu.add(categoryItem);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">lessonCompleted</span><span class="params">(Map&lt;Assignment,Boolean&gt; map,Lesson currentLesson)</span>&#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Assignment,Boolean&gt; entry : map.entrySet())&#123;</span><br><span class="line">            <span class="type">Assignment</span> <span class="variable">storedAssignment</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="keyword">for</span> (Assignment lessonAssignment : currentLesson.getAssignments())&#123;</span><br><span class="line">                <span class="keyword">if</span> (lessonAssignment.getName().equals(storedAssignment.getName()))&#123;</span><br><span class="line">                    result = result &amp;&amp; entry.getValue();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="LessonProgressService"><a href="#LessonProgressService" class="headerlink" title="LessonProgressService"></a>LessonProgressService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Assignment;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTrackerRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonProgressService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserTrackerRepository userTrackerRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/service/lessonoverview.mvc&quot;,produces = &quot;application/json&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;LessonOverview&gt; <span class="title function_">lessonOverview</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span>  <span class="variable">userTracker</span> <span class="operator">=</span> userTrackerRepository.findByUser(webSession.getUserName());</span><br><span class="line">        <span class="type">var</span> <span class="variable">currentLesson</span> <span class="operator">=</span> webSession.getCurrentLesson();</span><br><span class="line">        <span class="keyword">if</span> (currentLesson != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">var</span> <span class="variable">lessonTracker</span> <span class="operator">=</span> userTracker.getLessonTracker(currentLesson);</span><br><span class="line">            <span class="keyword">return</span> lessonTracker.getLessonOverview().entrySet().stream()</span><br><span class="line">                    .map(entry -&gt; <span class="keyword">new</span> <span class="title class_">LessonOverview</span>(entry.getKey(),entry.getValue()))</span><br><span class="line">                    .toList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> List.of();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LessonOverview</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Assignment assignment;</span><br><span class="line">        <span class="keyword">private</span> Boolean solved;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="LessonTitleService"><a href="#LessonTitleService" class="headerlink" title="LessonTitleService"></a>LessonTitleService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonTitleService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LessonTitleService</span><span class="params">(<span class="keyword">final</span> WebSession webSession)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.webSession = webSession;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/service/lessontitle.mvc&quot;,produces = &quot;application/html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> String <span class="title function_">showPlan</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Lesson</span> <span class="variable">lesson</span> <span class="operator">=</span> webSession.getCurrentLesson();</span><br><span class="line">        <span class="keyword">return</span> lesson != <span class="literal">null</span> ? lesson.getTitle() :<span class="string">&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ReportCardService"><a href="#ReportCardService" class="headerlink" title="ReportCardService"></a>ReportCardService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.PluginMessages;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.Course;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.LessonTracker;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTracker;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTrackerRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportCardService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserTrackerRepository userTrackerRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Course course;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PluginMessages pluginMessages;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(path = &quot;/service/reportcard.mvc&quot;,produces = &quot;application/json&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ReportCard <span class="title function_">reportCard</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ReportCard</span> <span class="variable">reportCard</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReportCard</span>();</span><br><span class="line">        reportCard.setTotalNumberOfLessons(course.getTotalOfLessons());</span><br><span class="line">        reportCard.setTotalNumberOfAssignments(course.getTotalOfAssignments());</span><br><span class="line"></span><br><span class="line">        <span class="type">UserTracker</span> <span class="variable">userTracker</span> <span class="operator">=</span> userTrackerRepository.findByUser(webSession.getUserName());</span><br><span class="line">        reportCard.setNumberOfAssignmentsSolved(userTracker.numberOfAssignmentsSolved());</span><br><span class="line">        reportCard.setNumberOfLessonsSolved(userTracker.numberOfLessonsSolved());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Lesson lesson : course.getLessons())&#123;</span><br><span class="line">            <span class="type">LessonTracker</span> <span class="variable">lessonTracker</span> <span class="operator">=</span> userTracker.getLessonTracker(lesson);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">LessonStatistics</span> <span class="variable">lessonStatistics</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LessonStatistics</span>();</span><br><span class="line">            lessonStatistics.setName(pluginMessages.getMessage(lesson.getTitle()));</span><br><span class="line">            lessonStatistics.setNumberOfAttempts(lessonTracker.getNumberOfAttempts());</span><br><span class="line">            lessonStatistics.setSolved(lessonTracker.isLessonSolved());</span><br><span class="line">            reportCard.lessonStatistics.add(lessonStatistics);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reportCard;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ReportCard</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> totalNumberOfLessons;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> totalNumberOfAssignments;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> solvedLessons;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> numberOfAssignmentsSolved;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> numberOfLessonsSolved;</span><br><span class="line">        <span class="keyword">private</span> List&lt;LessonStatistics&gt; lessonStatistics =  <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LessonStatistics</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> solved;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> numberOfAttempts;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RestartLessonService"><a href="#RestartLessonService" class="headerlink" title="RestartLessonService"></a>RestartLessonService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Initializeable;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTracker;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.users.UserTrackerRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.flywaydb.core.Flyway;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestartLessonService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserTrackerRepository userTrackerRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Function&lt;String , Flyway&gt; flywayLessons;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Initializeable&gt; lessonsToInitialize;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/service/restartlesson.mvc&quot;,produces = &quot;text/text&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(value = HttpStatus.OK)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restartLesson</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Lesson</span> <span class="variable">al</span> <span class="operator">=</span> webSession.getCurrentLesson();</span><br><span class="line">        log.debug(<span class="string">&quot;Restarting lesson: &quot;</span>,al);</span><br><span class="line"></span><br><span class="line">        <span class="type">UserTracker</span> <span class="variable">userTracker</span> <span class="operator">=</span> userTrackerRepository.findByUser(webSession.getUserName());</span><br><span class="line">        userTracker.reset(al);</span><br><span class="line">        userTrackerRepository.save(userTracker);</span><br><span class="line">        <span class="type">var</span> <span class="variable">flyway</span> <span class="operator">=</span> flywayLessons.apply(webSession.getUserName());</span><br><span class="line">        flyway.clean();</span><br><span class="line">        flyway.migrate();</span><br><span class="line">        lessonsToInitialize.forEach(i-&gt;i.initialize(webSession.getUser()));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SessionService"><a href="#SessionService" class="headerlink" title="SessionService"></a>SessionService</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.Messages;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.WebSession;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSession webSession;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestartLessonService restartLessonService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Messages messages;</span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/service/enable-security.mvc&quot;,produces = &quot;application/json&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">applySecurity</span><span class="params">()</span>&#123;</span><br><span class="line">        webSession.toggleSecurity();</span><br><span class="line">        restartLessonService.restartLesson();</span><br><span class="line">        </span><br><span class="line">        <span class="type">var</span> <span class="variable">msg</span> <span class="operator">=</span> webSession.isSecurityEnable() ? <span class="string">&quot;security.enabled&quot;</span>:<span class="string">&quot;security.disabled&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> messages.getMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="users-2"><a href="#users-2" class="headerlink" title="users"></a>users</h2><h3 id="RegistrationController"><a href="#RegistrationController" class="headerlink" title="RegistrationController"></a>RegistrationController</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Value;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegistrationController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserValidator userValidator;</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/registration&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showForm</span><span class="params">(UserForm userForm)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;registration&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register.mvc&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">registration</span><span class="params">(<span class="meta">@ModelAttribute(&quot;userForm&quot;)</span> <span class="meta">@Valid</span> UserForm userForm, BindingResult bindingResult, HttpServletRequest request)</span> <span class="keyword">throws</span> ServletException&#123;</span><br><span class="line">        userValidator.validate(userForm,bindingResult);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bindingResult.hasErrors())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;registration&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        userService.addUser(userForm.getUsername(),userForm.getPassword());</span><br><span class="line">        request.login(userForm.getUsername(),userForm.getPassword());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/attack&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserValidator"><a href="#UserValidator" class="headerlink" title="UserValidator"></a>UserValidator</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Validator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//实现bean的注入,当我们的类不属于@controller @services的时候我们就可以使用@component来标注这个类</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UserForm.class.equals(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Object o, Errors errors)</span>&#123;</span><br><span class="line">        <span class="type">UserForm</span> <span class="variable">userForm</span> <span class="operator">=</span> (UserForm) o;</span><br><span class="line">        <span class="keyword">if</span> (userRepository.findByUsername(userForm.getUsername()) != <span class="literal">null</span>)&#123;</span><br><span class="line">            errors.rejectValue(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;username.duplicate&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userForm.getMatchingPassword().equals(userForm.getPassword()))&#123;</span><br><span class="line">            errors.rejectValue(<span class="string">&quot;matchingPassword&quot;</span>,<span class="string">&quot;password.diff&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserForm"><a href="#UserForm" class="headerlink" title="UserForm"></a>UserForm</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserForm</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min = 6,max = 45)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;[a-z0-9-]*&quot;,message = &quot;can only contain lowercase letters.digits,and -&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"><span class="comment">//    表单数据中的username</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min = 6,max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min = 6,max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String matchingPassword;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String agree;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Scoreboard"><a href="#Scoreboard" class="headerlink" title="Scoreboard"></a>Scoreboard</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.i18n.PluginMessages;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.Course;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Scoreboard</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span>  UserTrackerRepository userTrackerRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span>  UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Course course;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PluginMessages pluginMessages;</span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Ranking</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String username;</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; flagsCaptured;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/scoreboard-data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Ranking&gt; <span class="title function_">getRankings</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;WebGoatUser&gt; allUsers = userRepository.findAll();</span><br><span class="line">        List&lt;Ranking&gt; rankings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (WebGoatUser user : allUsers)&#123;</span><br><span class="line">            <span class="keyword">if</span> (user.getUsername().startsWith(<span class="string">&quot;csrf-&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">UserTracker</span> <span class="variable">userTracker</span> <span class="operator">=</span> userTrackerRepository.findByUser(user.getUsername());</span><br><span class="line">            rankings.add(<span class="keyword">new</span> <span class="title class_">Ranking</span>(user.getUsername(),challengesSolved(userTracker)));</span><br><span class="line">        &#125;</span><br><span class="line">        rankings.sort((o1,o2) -&gt; o2.getFlagsCaptured().size() - o1.getFlagsCaptured().size());</span><br><span class="line">        <span class="keyword">return</span> rankings;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; <span class="title function_">challengesSolved</span><span class="params">(UserTracker userTracker)</span>&#123;</span><br><span class="line">        List&lt;String&gt; challenges = List.of(<span class="string">&quot;Challenge1&quot;</span>, <span class="string">&quot;Challenge2&quot;</span>, <span class="string">&quot;Challenge3&quot;</span>, <span class="string">&quot;Challenge4&quot;</span>, <span class="string">&quot;Challenge5&quot;</span>, <span class="string">&quot;Challenge6&quot;</span>, <span class="string">&quot;Challenge7&quot;</span>, <span class="string">&quot;Challenge8&quot;</span>, <span class="string">&quot;Challenge9&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> challenges.stream()</span><br><span class="line">                .map(userTracker::getLessonTracker)</span><br><span class="line">                .flatMap(Optional::stream)</span><br><span class="line">                .filter(LessonTracker::isLessonSolved)</span><br><span class="line">                .map(LessonTracker::getLessonName)</span><br><span class="line">                .map(<span class="built_in">this</span>::toLessonTitle)</span><br><span class="line">                .toList();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">toLessonTitle</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">titleKey</span> <span class="operator">=</span> course.getLessons().stream()</span><br><span class="line">                .filter(l-&gt;l.getId().equals(id))</span><br><span class="line">                .findFirst()</span><br><span class="line">                .map(Lesson::getTitle)</span><br><span class="line">                .orElse(<span class="string">&quot;No title&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> pluginMessages.getMessage(titleKey,titleKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserSession"><a href="#UserSession" class="headerlink" title="UserSession"></a>UserSession</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.container.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.eventbus.AllowConcurrentEvents;</span><br><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSession</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> WebGoatUser webGoatUser;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String sessionId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="lessons-5"><a href="#lessons-5" class="headerlink" title="lessons"></a>lessons</h1><p>从下面开始我们就需要去到真正的题目中去了 我们慢慢分析</p>
<h2 id="webgoat-introduction"><a href="#webgoat-introduction" class="headerlink" title="webgoat_introduction"></a>webgoat_introduction</h2><h3 id="WebGoatIntroduction"><a href="#WebGoatIntroduction" class="headerlink" title="WebGoatIntroduction"></a>WebGoatIntroduction</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.webgoat_introduction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//实现bean的注入,当我们的类不属于@controller @services的时候我们就可以使用@component来标注这个类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebGoatIntroduction</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Category.INTRODUCTION;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webgoat.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="排错"><a href="#排错" class="headerlink" title="排错"></a>排错</h3><p>这里写完这些之后启动的时候发现出现了一个非常重要的错误,这里记录一下我去寻找错误代码的过程与思路.</p>
<p>这里的错误就是我们打开之后它没有显示我们的adoc文件的内容</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822162820454.png"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822162915462.png" alt="image-20220822162915462"></p>
<p>首先我们需要去查看有无异常信息的抛出</p>
<p>这里给了一个空指针异常</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822163116038.png" alt="image-20220822163116038"></p>
<p>我们打个断点去查看哪里出现了问题</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822163211392.png" alt="image-20220822163211392"></p>
<p>很明显就是这里的resoucre的名字出现了问题 那么我首先去寻找了一下在哪里有调用了这里computeTemplateResource方法,因为这里很明显传参就出现了问题 其次这里也可以简单的看出来肯定是多了一个&#x2F;或者少了一个&#x2F;导致截取出现了问题 最终路径拼接不起来</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822163301810.png" alt="image-20220822163301810"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822163252038.png" alt="image-20220822163252038"></p>
<p>就这么几个,我们看一下其实都不是我们自己去调用的,而是thymeleaf去给我们调用的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822163605299.png" alt="image-20220822163605299"></p>
<p>那么我们现在有两种思路第一种 我们根据这错误可能的形成原因去搜索可能存在错误的代码 这里肯定是lessons + …去进行拼接.因此我们直接去搜索lessons 在根据连接操作找到了这行代码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822164616384.png" alt="image-20220822164616384"></p>
<p>这里也是与先前推测的连接略有出入,但是这里也是进行截断操作</p>
<p>很明显这里缺少了一个. 导致在替换的时候出现了问题</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822165450004.png" alt="image-20220822165450004"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822165330017.png" alt="image-20220822165330017"></p>
<p>第二种方式 根据我们现在的代码是针对lessons的,因此我们之间找到container 下面的lessons去翻找代码.</p>
<p>成功解决一项错误</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822181047833.png" alt="image-20220822181047833"></p>
<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><p>这里的Category其实是一个枚举类型因此这里其实返回的是关于本关卡的介绍 也就是这个是同一类型的关卡</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823220049876.png" alt="image-20220823220049876"></p>
<p>进行两次查找去看看谁调用了这个方法</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823220128471.png" alt="image-20220823220128471"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823220201729.png" alt="image-20220823220201729"></p>
<p>这里找到了Cource方法,在这里很明显吗这个类就是一个统计关卡的类</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823221755693.png" alt="image-20220823221755693"></p>
<p>LessonMenuService这里很容易理解这里的这个就是在左边栏进行关卡的展示的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823222538587.png" alt="image-20220823222538587"></p>
<p>我们接下来去看看LessonMenuItem</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823224951738.png" alt="image-20220823224951738"></p>
<p>这里的getTitle()其实是配置文件中的这个</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824184332114.png" alt="image-20220824184332114"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824184532463.png" alt="image-20220824184532463"></p>
<h2 id="webwolf-introduction"><a href="#webwolf-introduction" class="headerlink" title="webwolf_introduction"></a>webwolf_introduction</h2><h3 id="WebWolfIntroduction"><a href="#WebWolfIntroduction" class="headerlink" title="WebWolfIntroduction"></a>WebWolfIntroduction</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.webwolf_introduction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebWolfIntroduction</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Category.INTRODUCTION;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">getTitle</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webwolf.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>顺手处理另一个问题</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822210017920.png" alt="image-20220822210017920"></p>
<p>这是原版的链接,点击后会爆404错误,这里我们首先想到的肯定是这个路径没有对应进去我们的系统,那么这里我们首先进行全局搜索</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822210043380.png" alt="image-20220822210043380"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822210149301.png" alt="image-20220822210149301"></p>
<p>这里首先发现并没有这个路径,那么接下来由于WebWolf是我们添加的默认前缀,那么我们只需要去搜索后面的&#x2F;home就好</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822210327510.png" alt="image-20220822210327510"></p>
<p>这里除去上面的dockerfile的home,那么我们首先看到的就是这里的addViewController(),这里匹配的路径是&#x2F;home,那么我们就有两个思路去修复,一是去更改html代码,使之进行匹配,第二就是更改这里在前面添加上&#x2F;WebWolf,这里我们进行添加并重启进行尝试</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822210604697.png" alt="image-20220822210604697"></p>
<p>成功跳转 但是这里出现了一个重要的问题 当我们直接从这里去打开 这里跳转的是&#x2F;home 两种情况出现差别主要是处理的逻辑不同</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823185716907.png" alt="image-20220823185716907"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823185649325.png" alt="image-20220823185649325"></p>
<p>我们先看第一种的操作</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823190012198.png" alt="image-20220823190012198"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823190046301.png" alt="image-20220823190046301"></p>
<p>可以清楚的看到这里其实是直接通过链接进行访问的webwolf</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823190130574.png" alt="image-20220823190130574"></p>
<p>而第二种其实是通过重定向跳转的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823185925351.png" alt="image-20220823185925351"></p>
<p>稍做修改 就可以成功跳转了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823192905208.png" alt="image-20220823192905208"></p>
<h3 id="MailAssignment"><a href="#MailAssignment" class="headerlink" title="MailAssignment"></a>MailAssignment</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.webwolf_introduction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestClientException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">//@RestController 是@controller和@ResponseBody 的结合</span></span><br><span class="line"><span class="comment">//@Controller 将当前修饰的类注入到springboot ioc容器,使得从该类所在的项目跑起来的过程中,这个类就被实例化</span></span><br><span class="line"><span class="comment">//@ResponseBody 它的作用简短的说就是指该类中的api即可返回的数据 不管对应方法返回map或者其他的object,它会以json字符串的形式返回给客户端</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailAssignment</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String webWolfURL;</span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"><span class="comment">//    restTemplat像一个封装好的网络请求工具类这里我们使用它来去发送url请求</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MailAssignment</span><span class="params">(RestTemplate restTemplate, <span class="meta">@Value(&quot;$&#123;webwolf.mail.url&#125;&quot;)</span> String webWolfURL)</span>&#123;</span><br><span class="line"><span class="comment">//        这里的@Value的值可以在application-webgoat.properties中找到,其实是webwolf的email的url</span></span><br><span class="line">        <span class="built_in">this</span>.restTemplate =restTemplate;</span><br><span class="line">        <span class="built_in">this</span>.webWolfURL = webWolfURL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/WebWolf/mail/send&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">sendEmail</span><span class="params">(<span class="meta">@RequestParam</span> String email)</span>&#123;</span><br><span class="line"><span class="comment">//        获取post请求中的email参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> email.substring(<span class="number">0</span>,email.indexOf(<span class="string">&quot;@&quot;</span>));</span><br><span class="line"><span class="comment">//        通过先获取@的位置接着截取@之前的值如 123@test.com 就会截取123</span></span><br><span class="line">        <span class="keyword">if</span> (username.equalsIgnoreCase(getWebSession().getUserName()))&#123;</span><br><span class="line"><span class="comment">//            将得到的值忽略大小写与当前用户名进行对比</span></span><br><span class="line">            <span class="type">Email</span> <span class="variable">mailEvent</span> <span class="operator">=</span> Email.builder()</span><br><span class="line"><span class="comment">//                    由于我们在email类中设置了@Data 与 @Builder注解 这样我们就可以进行链式赋值 首先调用了builder()</span></span><br><span class="line">                    .recipient(username)</span><br><span class="line">                    .title(<span class="string">&quot;Test messages from WebWolf&quot;</span>)</span><br><span class="line">                    .contents(<span class="string">&quot;This is a test message from WebWolf, your unique code is: &quot;</span>+ StringUtils.reverse(username))</span><br><span class="line"><span class="comment">//                    这里书写了邮箱内容 并附带了unique code</span></span><br><span class="line">                    .sender(<span class="string">&quot;webgoat@owasp.org&quot;</span>)</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                restTemplate.postForEntity(webWolfURL,mailEvent,Object.class);</span><br><span class="line"><span class="comment">//                这里是进行了一个post网络请求 Object.class是以对象发送? 解释看下图</span></span><br><span class="line">            &#125;<span class="keyword">catch</span> (RestClientException e)&#123;</span><br><span class="line">                <span class="keyword">return</span> informationMessage(<span class="built_in">this</span>).feedback(<span class="string">&quot;webwolf.email_failed&quot;</span>).output(e.getMessage()).build();</span><br><span class="line"><span class="comment">//                这里是没请求成功后的返回html的信息 这里进informationMessage进行查看</span></span><br><span class="line"><span class="comment">//                由于之前的messages已经获取了配置文件 ,那么这里我们之间读取配置文件并进行赋值</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>  informationMessage(<span class="built_in">this</span>).feedback(<span class="string">&quot;webwolf.email_send&quot;</span>).feedbackArgs(email).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> informationMessage(<span class="built_in">this</span>).feedback(<span class="string">&quot;webwolf.email_mismatch&quot;</span>).feedbackArgs(username).build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/WebWolf/mail&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String uniqueCode)</span>&#123;</span><br><span class="line"><span class="comment">//        首先获取post表单 uniqueCode</span></span><br><span class="line">        <span class="keyword">if</span> (uniqueCode.equals(StringUtils.reverse(getWebSession().getUserName())))&#123;</span><br><span class="line"><span class="comment">//            将获取到的值进行逆序与当前用户名进行对比 为什么是逆序看上面的mailEvent 赋值操作</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line"><span class="comment">//            这里如果相等就完成了这项挑战调用success </span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedbackArgs(<span class="string">&quot;webwolf.code_incorrect&quot;</span>).feedbackArgs(uniqueCode).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824191613764.png" alt="image-20220824191613764"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824201107883.png" alt="image-20220824201107883"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824202804678.png" alt="image-20220824202804678"></p>
<p>这里可以看到是自动装配的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824204453426.png" alt="image-20220824204453426"></p>
<p>这里也查找的Bean容器可见下面仅仅是设置了一下基础信息 我们进去pluginMessages()构造方法看看先</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824204703643.png" alt="image-20220824204703643"></p>
<p>这里也是比较简单的进行了基础值的赋值操作 我们先来看看这个Messages</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824204828368.png" alt="image-20220824204828368"></p>
<p>可以看到这里的setBasename</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824210408565.png" alt="image-20220824210408565"></p>
<p>清楚看到可以读取这里的messages配置文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824210505308.png" alt="image-20220824210505308"></p>
<p>我们接着去看refreshProperties</p>
<p>这里可以看到我们自己并没有去调用这个refreshProperties() 说明这里也是框架给我们调用的 这里我们分析一下</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824205225984.png" alt="image-20220824205225984"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824213012109.png" alt="image-20220824213012109"></p>
<h3 id="Email-1"><a href="#Email-1" class="headerlink" title="Email"></a>Email</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.webwolf_introduction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="comment">// @Builder作用见下图</span></span><br><span class="line"><span class="comment">//可以通过链式调用的方法给类中的参数进行赋值</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//作为数据类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Email</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String contents;</span><br><span class="line">    <span class="keyword">private</span> String sender;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String recipient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824191142252.png" alt="image-20220824191142252"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824191212840.png" alt="image-20220824191212840"></p>
<p>简单易懂</p>
<h3 id="排错-1"><a href="#排错-1" class="headerlink" title="排错"></a>排错</h3><p>但是这里发送邮箱会报错</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822215626523.png" alt="image-20220822215626523"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822215626523.png"></p>
<p>将id自增策略更改如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GeneratedValue(strategy =  GenerationType.IDENTITY)</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220822215551416.png" alt="image-20220822215551416"></p>
<p>这里更改完成之后遇到了一个无法解决的报错 说表并不存在 但是我翻遍了也没找到这个表在哪建的 因此我觉得换回原先的hsqldb数据库,但是这个数据库存在一个极大的弊端就是他的连接只能存在一个也就是如果项目启动起来的时候,就无法通过</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823123531389.png" alt="image-20220823123531389"></p>
<h3 id="更换为hsqldb并进行连接查看"><a href="#更换为hsqldb并进行连接查看" class="headerlink" title="更换为hsqldb并进行连接查看"></a>更换为hsqldb并进行连接查看</h3><p>首先我们换回配置文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124025849.png" alt="image-20220823124025849"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124210014.png" alt="image-20220823124210014"></p>
<p>这里成功启动起来</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124233038.png" alt="image-20220823124233038"></p>
<p>我们尝试去连接 </p>
<p>首先这里存在几个值路径信息 url 数据库 用户 和密码 很明显这里的路径信息和数据库肯定是用来拼接最后的url的,首先我们尝试获取一下这里的值</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124328862.png" alt="image-20220823124328862"></p>
<p>一种比较简单的方式就是去查看我们项目启动后输出的日志信息</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124454018.png" alt="image-20220823124454018"></p>
<p>第二种方式 这里我们可以去自己去寻找具体路径是如何进行拼接的然后自己去查看位置</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124542653.png" alt="image-20220823124542653"></p>
<p>第三种方式我们尝试去输出一下日志信息</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823124943809.png" alt="image-20220823124943809"></p>
<p>下一个问题我们如何去寻找用户名密码 首先我尝试了无密码的认证方式,发现并未通过</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125109247.png" alt="image-20220823125109247"></p>
<p>接下来我开始翻看这些文件 在这里发现了两个特殊的参数 前面这个SA一看就是用户名 后面的一看就是一个MD5值</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125145717.png" alt="image-20220823125145717"></p>
<p>发现是空密码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125245662.png" alt="image-20220823125245662"></p>
<p>但是第一次其实并没有连接成功主要原因其实就是我的项目已经启动了,因此占用着这个进程,导致我的连接失败了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125438715.png" alt="image-20220823125438715"></p>
<p>停止项目之后就连接成功了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125547412.png" alt="image-20220823125547412"></p>
<p>其次这里需要在架构这里添加上所有的数据库</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125800211.png" alt="image-20220823125800211"></p>
<p>这里我们如果想要去更改用户名和密码的话,相信你也能想到了</p>
<p>更改这个文件并更改配置文件即可</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125647530.png" alt="image-20220823125647530"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823130027522.png" alt="image-20220823130027522"></p>
<p>现在便成功的连接上了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125824892.png" alt="image-20220823125824892"></p>
<p>当需要启动项目时点击停用即可 不知道有没有方式可以去实现同时连接</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823125901966.png" alt="image-20220823125901966"></p>
<p>这里需要先对数据进行初始化</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823181703373.png" alt="image-20220823181703373"></p>
<p>测试下邮箱功能 注意这里的@前面需要是一个你注册的用户名</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823210827974.png" alt="image-20220823210827974"></p>
<p>去webwolf可以查看到</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823210956649.png" alt="image-20220823210956649"></p>
<p>这里根据这个unique也可以查看到成功完成了这项挑战</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220823211013116.png" alt="image-20220823211013116"></p>
<h3 id="LandingAssignment"><a href="#LandingAssignment" class="headerlink" title="LandingAssignment"></a>LandingAssignment</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.webwolf_introduction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LandingAssignment</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;webwolf.landingpage.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String landingPageUrl;</span><br><span class="line"><span class="comment">//    同样的webwolf的landing的url在配置文件中可找</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/WebWolf/landing&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">click</span><span class="params">(String uniqueCode)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.reverse(getWebSession().getUserName()).equals(uniqueCode))&#123;</span><br><span class="line"><span class="comment">//           如果将当前用户名字逆向对比为外部输入uniqueCode</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;webwolf.landing_wrong&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/WebWolf/landing/password-reset&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">openPasswordReset</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> URISyntaxException&#123;</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(request.getRequestURI().toString());</span><br><span class="line"><span class="comment">//        对一个url进行拆分 如http 127.0.0.1 8081 /webwolf</span></span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;webwolfUrl&quot;</span>,landingPageUrl);</span><br><span class="line"><span class="comment">//        添加两个model 一个url 一个 uncode</span></span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;uniqueCode&quot;</span>,StringUtils.reverse(getWebSession().getUserName()));</span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;lessons/webwolf_introduction/templates/webwolfPasswordReset.html&quot;</span>);</span><br><span class="line"><span class="comment">//        设置视图 映射到哪一个html文件 根据路径去可以简单找到</span></span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824222750024.png" alt="image-20220824222750024"></p>
<p>可以看到这里是一个form表单 而且当点击save之后会向webwolfurl去发送请求</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824222816406.png" alt="image-20220824222816406"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220824223002352.png" alt="image-20220824223002352"></p>
<p>到这里我们先放一下去看一下webwolf 的landing是怎么配置的</p>
<p>这里也比较简单能够理解就是当请求&#x2F;landing&#x2F;**路径下时会打印一个日志 这里我们暂时看不出问题来 所以我们先去看requests</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825095155593.png" alt="image-20220825095155593"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825095148670.png" alt="image-20220825095148670"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825095920808.png" alt="image-20220825095920808"></p>
<p>这里很容易找到其实这里的初始化操作是在@Bean执行的而且是交给spring容器管理的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825095907977.png" alt="image-20220825095907977"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825100305798.png" alt="image-20220825100305798"></p>
<p>现在我们已经知道了我们的http请求其实是存放在traces中的,那么是在什么时候添加进去的呢?</p>
<p>可以看到其实是spring自动调用的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825110424447.png" alt="image-20220825110424447"></p>
<p>这里我进行了简单的尝试,发现在进入return语句之后 在log.trace执行之前调用了add方法.这里不太能理解为什么.主要是一个http请求应该包括响应 那么按理应该是在所有的return结束之后在调用才对啊.</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825110800731.png" alt="image-20220825110800731"></p>
<p>我们去看一下request</p>
<p> 这里可能有点难以理解 刚开始我不知道这个t是如何去赋值的 其实这里简单的理解 就是首先我们traceRepository.findAllTraces() 这个获取的是一个list 而后面的stream()其实就代表着一个一个的去读取 接着呢 在每一次读取之中进行了过滤filter 操作 ,而由于每一次读取的时候是读取到了一个HttpTrace对象,那么这个参数t自然就是读取到的这个HttpTrace对象了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825113223673.png" alt="image-20220825113223673"></p>
<p>下面这里也很好理解就是转换成json格式的数据</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825144305039.png" alt="image-20220825144305039"></p>
<p>将得到的值进行存入</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825145014574.png" alt="image-20220825145014574"></p>
<p>现在可以完全理解这个系统了吗</p>
<p>这里的更改密码其实是攻击者伪造的更改密码链接 但是其实这里点击save之后会跳转 实战时是需要进行重新修改的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825145300839.png" alt="image-20220825145300839"></p>
<p>当我们更改之后就会将更改的密码发送到</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825145344751.png" alt="image-20220825145344751"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825150618105.png" alt="image-20220825150618105"></p>
<p>由于webwolf会存储landing路径下的请求因此这里会进行展示</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825150857974.png" alt="image-20220825150857974"></p>
<p>提交即可过关</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825150925418.png" alt="image-20220825150925418"></p>
<h2 id="http-basics"><a href="#http-basics" class="headerlink" title="http_basics"></a>http_basics</h2><h3 id="HttpBasics"><a href="#HttpBasics" class="headerlink" title="HttpBasics"></a>HttpBasics</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.http_basics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//实现bean的注入,当我们的类不属于@controller @services的时候我们就可以使用@component来标注这个类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpBasics</span>  <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.GENERAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1.http-basics.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>介绍</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825153410260.png" alt="image-20220825153410260"></p>
<h3 id="HttpBasicsLesson"><a href="#HttpBasicsLesson" class="headerlink" title="HttpBasicsLesson"></a>HttpBasicsLesson</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.http_basics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AssignmentHints(&#123;&quot;http-basics.hints.http_basics_lesson.1&quot;&#125;)</span></span><br><span class="line"><span class="comment">//这里的hints需要我们重点去看</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpBasicsLesson</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/HttpBasics/attack1&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String person)</span>&#123;</span><br><span class="line"><span class="comment">//        获取person参数</span></span><br><span class="line">        <span class="keyword">if</span> (!person.isBlank())&#123;</span><br><span class="line"><span class="comment">//            如果字符串不仅仅是包含空字符</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>)</span><br><span class="line">                    .feedback(<span class="string">&quot;http-basics.reversed&quot;</span>)</span><br><span class="line">                    .feedbackArgs(<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(person).reverse().toString())</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;http-basics.empty&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的show hints其实是注解 我们需要去看看</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825155519406.png" alt="image-20220825155519406"></p>
<p>这里存在我们对AssignmentHints接口的定义 其中有一个value参数</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825155628662.png" alt="image-20220825155628662"></p>
<p>在这里我们找到了用法</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825155726264.png" alt="image-20220825155726264"></p>
<p>一步步往上查找</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825160517445.png" alt="image-20220825160517445"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825160538706.png" alt="image-20220825160538706"></p>
<p>这里可见对course进行了bean的注入</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825160729294.png" alt="image-20220825160729294"></p>
<p>感觉这里其实是无法调用到的 找遍也没有发现那个请求发送到这里 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825161854634.png" alt="image-20220825161854634"></p>
<p>其次在StartLesson类的构造方法我并未找到有用户调用 那么原因是不是由于@Controller导致该类有springboot帮助我们去调用了</p>
<p>接着我们去看bean对象的赋值</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825164550766.png" alt="image-20220825164550766"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825164632442.png" alt="image-20220825164632442"></p>
<p>现在我们去看new Assignment</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825164901828.png" alt="image-20220825164901828"></p>
<p>现在我们已经理解了hints存储在了哪里,接下来我们去寻找哪里进行了调用获取hints</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825170206161.png" alt="image-20220825170206161"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825170219828.png" alt="image-20220825170219828"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825170449078.png" alt="image-20220825170449078"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825171015851.png" alt="image-20220825171015851"></p>
<p>一个hint 一个路径</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825171032480.png" alt="image-20220825171032480"></p>
<p>聪明的你一定发现了 这里的hint并不是点击请求的而是一次性请求 存储在前端的</p>
<p>那么这关我们只要不输入空字符即可过关</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825171630319.png" alt="image-20220825171630319"></p>
<h3 id="HttpBasicsQuiz"><a href="#HttpBasicsQuiz" class="headerlink" title="HttpBasicsQuiz"></a>HttpBasicsQuiz</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.http_basics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentPath;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AssignmentHints(&#123;&quot;http-basics.hints.http_basic_quiz.1&quot;,&quot;http-basics.hints.http_basic_quiz.2&quot;&#125;)</span></span><br><span class="line"><span class="meta">@AssignmentPath(&quot;HttpBasics/attack2&quot;)</span></span><br><span class="line"><span class="comment">//这里AssignmentPath 需要去看下</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpBasicsQuiz</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/HttpBasics/attack2&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String answer,<span class="meta">@RequestParam</span> String magic_answer,<span class="meta">@RequestParam</span> String magic_num)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equalsIgnoreCase(answer) &amp;&amp; magic_answer.equals(magic_num))&#123;</span><br><span class="line"><span class="comment">//            如果post请求参数中answer与POST字符相同并且参数中magic_answer 与 magic_num相同就过关</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&quot;POST&quot;</span>.equalsIgnoreCase(answer))&#123;</span><br><span class="line">                <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;http-basics.incorrect&quot;</span>).build();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!magic_answer.equals(magic_num))&#123;</span><br><span class="line">                <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;http-basics.magic&quot;</span>).build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> failed(<span class="built_in">this</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里AssignmentPath 并没有去使用 推测可能是webgoat没有写完</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825180659450.png" alt="image-20220825180659450"></p>
<p>这里可能需要去抓包 先去看一下请求方式和 magic number</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825180917463.png" alt="image-20220825180917463"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825180911483.png" alt="image-20220825180911483"></p>
<p>或者直接观察前端代码</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825181029995.png" alt="image-20220825181029995"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825181103415.png" alt="image-20220825181103415"></p>
<h2 id="http-proxies"><a href="#http-proxies" class="headerlink" title="http_proxies"></a>http_proxies</h2><h3 id="HttpProxies"><a href="#HttpProxies" class="headerlink" title="HttpProxies"></a>HttpProxies</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.http_proxies;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpProxies</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.GENERAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;2.http-proxies.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpBasicsInterceptRequest"><a href="#HttpBasicsInterceptRequest" class="headerlink" title="HttpBasicsInterceptRequest"></a>HttpBasicsInterceptRequest</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.http_proxies;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpBasicsInterceptRequest</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/HttpProxies/intercept-request&quot;,method = &#123;RequestMethod.POST,RequestMethod.GET&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestHeader(value = &quot;x-request-intercepted&quot;,required = false)</span>Boolean headerValue, <span class="meta">@RequestParam(value = &quot;changeMe&quot;,required = false)</span> String paramValue, HttpServletRequest request)</span>&#123;</span><br><span class="line"><span class="comment">//        获取请求头中的x-request-intercepted required = false表示可以有也可以没有</span></span><br><span class="line"><span class="comment">//        将请求参数中的changeMe 绑定为paramValue</span></span><br><span class="line">        <span class="keyword">if</span> (HttpMethod.POST.matches(request.getMethod()))&#123;</span><br><span class="line"><span class="comment">//            如果请求是post就失败</span></span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;http-proxies.intercept.failure&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (headerValue != <span class="literal">null</span> &amp;&amp; paramValue != <span class="literal">null</span> &amp;&amp; headerValue &amp;&amp; <span class="string">&quot;Requests are tampered easily&quot;</span>.equalsIgnoreCase(paramValue))&#123;</span><br><span class="line"><span class="comment">//            如果headerValue 不为空 paramValue 不为空 headerValue为true 并且paramValue与字符串相等</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).feedback(<span class="string">&quot;http-proxies.intercept.success&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;http-proxies.intercept.failure&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成题目 主要是教会你抓包并修改请求包</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825185451367.png" alt="image-20220825185451367"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825190444738.png" alt="image-20220825190444738"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825190909702.png" alt="image-20220825190909702"></p>
<h2 id="chrome-dev-tools"><a href="#chrome-dev-tools" class="headerlink" title="chrome_dev_tools"></a>chrome_dev_tools</h2><h3 id="ChromeDevTools"><a href="#ChromeDevTools" class="headerlink" title="ChromeDevTools"></a>ChromeDevTools</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.chrome_dev_tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChromeDevTools</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.GENERAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;3.chrome-dev-tools.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="chrome-dev-tools-1"><a href="#chrome-dev-tools-1" class="headerlink" title="chrome_dev_tools"></a>chrome_dev_tools</h2><h3 id="NetworkDummy"><a href="#NetworkDummy" class="headerlink" title="NetworkDummy"></a>NetworkDummy</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.chrome_dev_tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.UserSessionData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkDummy</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/ChromeDevTools/dummy&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String successMessage)</span>&#123;</span><br><span class="line"><span class="comment">//        获取successMessage参数</span></span><br><span class="line">        <span class="type">UserSessionData</span> <span class="variable">userSessionData</span> <span class="operator">=</span> getUserSessionData();</span><br><span class="line"><span class="comment">//        这里我们去看 UserSessionData在哪里赋值的</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> (String) userSessionData.getValue(<span class="string">&quot;randValue&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (successMessage != <span class="literal">null</span> &amp;&amp; successMessage.equals(answer))&#123;</span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).feedback(<span class="string">&quot;xss-dom-message-success&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;xss-dom-message-failure&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825202707349.png" alt="image-20220825202707349"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825204113787.png" alt="image-20220825204113787"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825204311496.png" alt="image-20220825204311496"></p>
<p>那么暂时情况下我们没有找到给userSessionData.Value(“randValue”)赋值的地方 这里我们首先去查找一下哪里调用了这个setValue </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825212624529.png" alt="image-20220825212624529"></p>
<p>很明显这里其实暂时仅仅有一个地方调用了 那么现在读下来其实我们这道题目是无法去做的 因此我选择去看前端的题目要求</p>
<p>可以简单的理解一下就是像让我们去通过console去调用这个js方法 这里找了半天才找到这个js文件</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825210117176.png" alt="image-20220825210117176"></p>
<p>尝试去调用的时候也是很明显的出现了问题那么我们现在需要去做的是看看哪里有关于这个路径的信息</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825212829615.png" alt="image-20220825212829615"></p>
<p>这里在xss关卡其实有调用</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825212931962.png" alt="image-20220825212931962"></p>
<p>因此这里选择去先写这个文件</p>
<h4 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h4><h5 id="DOMCrossSiteScripting"><a href="#DOMCrossSiteScripting" class="headerlink" title="DOMCrossSiteScripting"></a>DOMCrossSiteScripting</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.xss;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.UserSessionData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DOMCrossSiteScripting</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/CrossSiteScripting/phone-home-xss&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> Integer param1, <span class="meta">@RequestParam</span> Integer param2, HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">UserSessionData</span> <span class="variable">userSessionData</span> <span class="operator">=</span> getUserSessionData();</span><br><span class="line">        <span class="type">SecureRandom</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureRandom</span>();</span><br><span class="line">        <span class="comment">//        new 一个生成随机数的对象</span></span><br><span class="line">        userSessionData.setValue(<span class="string">&quot;randValue&quot;</span>,String.valueOf(number.nextInt()));</span><br><span class="line"><span class="comment">//        生成一个随机数并给randValue赋值</span></span><br><span class="line">        <span class="keyword">if</span> (param1 == <span class="number">42</span> &amp;&amp; param2 == <span class="number">24</span> &amp;&amp; request.getHeader(<span class="string">&quot;webgoat-requested-by&quot;</span>).equals(<span class="string">&quot;dom-xss-vuln&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).output(<span class="string">&quot;phoneHome Response is &quot;</span> + userSessionData.getValue(<span class="string">&quot;randValue&quot;</span>).toString()).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825221701018.png" alt="image-20220825221701018"></p>
<p>由于在上面进行了对比successMessage.equals(answer)</p>
<p>所以这里的phoneHome需要我们提交进去就可以过关</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825221928248.png" alt="image-20220825221928248"></p>
<p>这里过关之后我会删除xss&#x2F;DOMCrossSiteScripting.java</p>
<h3 id="NetworkLesson"><a href="#NetworkLesson" class="headerlink" title="NetworkLesson"></a>NetworkLesson</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.chrome_dev_tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AssignmentHints(&#123;&quot;networkHint1&quot;,&quot;networkHint2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkLesson</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/ChromeDevTools/network&quot;,params = &#123;&quot;network_num&quot;,&quot;number&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String network_num,<span class="meta">@RequestParam</span> String number)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (network_num.equals(number))&#123;</span><br><span class="line"><span class="comment">//            这里主要是判断输入的两个值是否相同</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).feedback(<span class="string">&quot;network.success&quot;</span>).output(<span class="string">&quot;&quot;</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;network.failed&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/ChromeDevTools/network&quot;,params = &quot;networkNum&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; ok(<span class="meta">@RequestParam</span> String networkNum)&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825230036188.png" alt="image-20220825230036188"></p>
<p>根据network去查看一下向 ChromeDevTools&#x2F;network 发送的payload</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825230129245.png" alt="image-20220825230129245"></p>
<p>输入即可过关</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825230236518.png" alt="image-20220825230236518"></p>
<p>当然也可通过check抓取值</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220825230325870.png" alt="image-20220825230325870"></p>
<h2 id="cia"><a href="#cia" class="headerlink" title="cia"></a>cia</h2><h3 id="CIA"><a href="#CIA" class="headerlink" title="CIA"></a>CIA</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.cia;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CIA</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.GENERAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;4.cia.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CIAQuiz"><a href="#CIAQuiz" class="headerlink" title="CIAQuiz"></a>CIAQuiz</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.cia;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CIAQuiz</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    String[] solutions = &#123;<span class="string">&quot;Solution 3&quot;</span>,<span class="string">&quot;Solution 1&quot;</span>,<span class="string">&quot;Solution 4&quot;</span>, <span class="string">&quot;Solution 2&quot;</span>&#125;;</span><br><span class="line">    <span class="type">boolean</span>[] guesses = <span class="keyword">new</span> <span class="title class_">boolean</span>[solutions.length];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/cia/quiz&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String[] question_0_solution,<span class="meta">@RequestParam</span> String[] question_1_solution,<span class="meta">@RequestParam</span> String[] question_2_solution,<span class="meta">@RequestParam</span> String [] question_3_solution)</span>&#123;</span><br><span class="line"><span class="comment">//        这里可见请求参数这里其实是使用的String [] 数组,那么当我们传入多个相同参数的时候就会全部获取存放到数组之中</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">correctAnswers</span> <span class="operator">=</span><span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">        String[] givenAnswers = &#123;question_0_solution[<span class="number">0</span>],question_1_solution[<span class="number">0</span>],question_2_solution[<span class="number">0</span>],question_3_solution[<span class="number">0</span>]&#125;;</span><br><span class="line"><span class="comment">//        获取每个参数中个的第一个值 并存放到givenAnswers中去</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; solutions.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (givenAnswers[i].contains(solutions[i]))&#123;</span><br><span class="line"><span class="comment">//                如果第一个参数中包含 Solution 3</span></span><br><span class="line">                correctAnswers++;</span><br><span class="line"><span class="comment">//                正确答案的数量加1</span></span><br><span class="line">                guesses[i] = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//                就猜对了</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                guesses[i] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (correctAnswers == solutions.length)&#123;</span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/cia/quiz&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span>[] getResults()&#123;</span><br><span class="line"><span class="comment">//        返回这个guesses数组</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.guesses;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里也比较简单 看下发送的 请求 可以发现当提交了答案之后会立马去get请求一次答案</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827122239088.png" alt="image-20220827122239088"></p>
<p>第一种过关方法就是一个个试去找正确答案</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827122334897.png" alt="image-20220827122334897"></p>
<p>另一种方式就是根据检查答案的方式 既然答案检查的是是否包含这个字段,那么我们只要把字段全部包含就可了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827122624570.png" alt="image-20220827122624570"></p>
<p>但是呢实际这样写并不会通过,我们来看看可以发现这里的请求参数默认以,进行了分割,导致并没有取到值</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827122843143.png" alt="image-20220827122843143"></p>
<p>这样写即可完成</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827123050738.png" alt="image-20220827123050738"></p>
<h2 id="lesson-template"><a href="#lesson-template" class="headerlink" title="lesson_template"></a>lesson_template</h2><h3 id="LessonTemplate"><a href="#LessonTemplate" class="headerlink" title="LessonTemplate"></a>LessonTemplate</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.lesson_template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LessonTemplate</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.GENERAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;lesson-template.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SampleAttack"><a href="#SampleAttack" class="headerlink" title="SampleAttack"></a>SampleAttack</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.lesson_template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.UserSessionData;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AssignmentHints(&#123;&quot;lesson-template.hints.1&quot;,&quot;lesson-template.hints.2&quot;,&quot;lesson-template.hints.3&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SampleAttack</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">secretValue</span> <span class="operator">=</span> <span class="string">&quot;secr37Value&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserSessionData userSessionData;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/lesson-template/sample-attack&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam(&quot;param1&quot;)</span>String param1,<span class="meta">@RequestParam(&quot;param2&quot;)</span>String param2)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userSessionData.getValue(<span class="string">&quot;some-value&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (secretValue.equals(param1))&#123;</span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>)</span><br><span class="line">                    .output(<span class="string">&quot;Custom Output ...if you want, for success&quot;</span>)</span><br><span class="line">                    .feedback(<span class="string">&quot;lesson-template.sample-attack.success&quot;</span>)</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;lesson-template.sample-attack.failure-2&quot;</span>)</span><br><span class="line">                .output(<span class="string">&quot;Custom output for this failure scenario, usually html that will get rendered directly ... yes, you can self-xss if you want&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/lesson-template/shop/&#123;user&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; <span class="title function_">getItemsInBasket</span><span class="params">(<span class="meta">@PathVariable(&quot;user&quot;)</span>String user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> List.of(<span class="keyword">new</span> <span class="title class_">Item</span>(<span class="string">&quot;WG-1&quot;</span>,<span class="string">&quot;WebGoat promo&quot;</span>,<span class="number">12.8</span>),<span class="keyword">new</span> <span class="title class_">Item</span>(<span class="string">&quot;WG-2&quot;</span>,<span class="string">&quot;webGoat sticker&quot;</span>,<span class="number">0.00</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Item</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String number;</span><br><span class="line">        <span class="keyword">private</span> String description;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一关其实就是教我们如何自己去出题目的,那么其实这里就是样例</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827133344581.png" alt="image-20220827133344581"></p>
<p>简单通过阅读代码发现只要第一个参数与密钥相同就可过关</p>
<h2 id="hijacksession"><a href="#hijacksession" class="headerlink" title="hijacksession"></a>hijacksession</h2><h3 id="HijackSession"><a href="#HijackSession" class="headerlink" title="HijackSession"></a>HijackSession</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.hijacksession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HijackSession</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.A1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hijacksession.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HijackSessionAssignment"><a href="#HijackSessionAssignment" class="headerlink" title="HijackSessionAssignment"></a>HijackSessionAssignment</h3><p>这里说明一下这里的顺序其实是代表着书写的顺序 如果需要去阅读的话建议从后向前读更好理解 或者先写一遍 然后理解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.hijacksession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.lessons.hijacksession.cas.Authentication;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.lessons.hijacksession.cas.HijackSessionAuthenticationProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AssignmentHints(&#123;</span></span><br><span class="line"><span class="meta">        &quot;hijacksession.hints.1&quot;,</span></span><br><span class="line"><span class="meta">        &quot;hijacksession.hints.2&quot;,</span></span><br><span class="line"><span class="meta">        &quot;hijacksession.hints.3&quot;,</span></span><br><span class="line"><span class="meta">        &quot;hijacksession.hints.4&quot;,</span></span><br><span class="line"><span class="meta">        &quot;hijacksession.hints.5&quot;,</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HijackSessionAssignment</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">COOKIE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hijack_cookie&quot;</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HijackSessionAuthenticationProvider provider;</span><br><span class="line"><span class="comment">//    这里自动注入了</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/HijackSession/login&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">login</span><span class="params">(<span class="meta">@RequestParam</span> String username, <span class="meta">@RequestParam</span> String password,</span></span><br><span class="line"><span class="params">                              <span class="meta">@CookieValue(value = COOKIE_NAME,required = false)</span> String cookieValue,</span></span><br><span class="line"><span class="params">                              HttpServletResponse response)</span>&#123;</span><br><span class="line">        Authentication authentication;</span><br><span class="line"><span class="comment">//        定义authentication对象</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(cookieValue))&#123;</span><br><span class="line"><span class="comment">//            如果cookieValue是空的</span></span><br><span class="line">            authentication = provider.authenticate(Authentication.builder().name(username).credentials(password).build());</span><br><span class="line">            setCookie(response,authentication.getId());</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            authentication = provider.authenticate(Authentication.builder().id(cookieValue).build());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (authentication.isAuthenticated())&#123;</span><br><span class="line"><span class="comment">//            如果已经认证了</span></span><br><span class="line">            <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> failed(<span class="built_in">this</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setCookie</span><span class="params">(HttpServletResponse response,String cookieValue)</span>&#123;</span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(COOKIE_NAME,cookieValue);</span><br><span class="line">        cookie.setPath(<span class="string">&quot;/WebGoat&quot;</span>);</span><br><span class="line">        cookie.setSecure(<span class="literal">true</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="cas"><a href="#cas" class="headerlink" title="cas"></a>cas</h3><h4 id="HijackSessionAuthenticationProvider"><a href="#HijackSessionAuthenticationProvider" class="headerlink" title="HijackSessionAuthenticationProvider"></a>HijackSessionAuthenticationProvider</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.hijacksession.cas;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.annotation.ApplicationScope;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadLocalRandom;</span><br><span class="line"><span class="keyword">import</span> java.util.function.DoublePredicate;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApplicationScope</span></span><br><span class="line"><span class="comment">//没太读懂 这里是指这个类与@Bean类注解的相似 但是会将作用域放到SCOPE_APPLICATION里面?</span></span><br><span class="line"><span class="comment">//我理解就是用springboot自动去加载管理只不过作用域不同</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HijackSessionAuthenticationProvider</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationProvider</span>&lt;Authentication&gt; &#123;</span><br><span class="line"><span class="comment">//    这里也很简单就可以理解 首先实现的是AuthenticationProvider 而这里的Authentication 就相当于实参去传递给了T</span></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;String&gt; sessions = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//    用于在处理之前保存元素的集合</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextLong() &amp; Long.MAX_VALUE;</span><br><span class="line"><span class="comment">//    这里其实不太能理解 前面是生成一个long类型的随机数 这个 &amp; 是什么意思 表表示最大是 Long.MAX_VALUE?</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_SESSIONS</span> <span class="operator">=</span> <span class="number">50</span> ;</span><br><span class="line"><span class="comment">//    这里其实是作为session 最大值的一个定义</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DoublePredicate</span> <span class="variable">PROBABILITY_DOUBLE_PREDICATE</span> <span class="operator">=</span> pr -&gt; pr &lt; <span class="number">0.75</span>;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Supplier&lt;String&gt; GENERATE_SESSION_ID = () -&gt; ++id + <span class="string">&quot;-&quot;</span> + Instant.now().toEpochMilli();</span><br><span class="line"><span class="comment">//    这里简单理解就是 id先自加一 再拼接起当前时间戳</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Supplier&lt;Authentication&gt; AUTHENTICATION_SUPPLIER = () -&gt; Authentication</span><br><span class="line">            .builder()</span><br><span class="line">            .id(GENERATE_SESSION_ID.get())</span><br><span class="line"><span class="comment">//        get()获取结果的提供者 就是获取Authentication创建的时间</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line"><span class="comment">//        进行认证</span></span><br><span class="line">        <span class="keyword">if</span> (authentication == <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            如果没有authentication 则返回一个</span></span><br><span class="line">            <span class="keyword">return</span> AUTHENTICATION_SUPPLIER.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(authentication.getId()) &amp;&amp; sessions.contains(authentication.getId())) &#123;</span><br><span class="line"><span class="comment">//      如果id不是空 并且 sessions 包含id</span></span><br><span class="line">            authentication.setAuthenticated(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//            认证成功</span></span><br><span class="line">            <span class="keyword">return</span> authentication;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(authentication.getId()))&#123;</span><br><span class="line"><span class="comment">//            如果id是空</span></span><br><span class="line">            authentication.setId(GENERATE_SESSION_ID.get());</span><br><span class="line"><span class="comment">//            救赋值</span></span><br><span class="line">        &#125;</span><br><span class="line">        authorizedUserAutoLogin();</span><br><span class="line"><span class="comment">//        认证的用户自动登录</span></span><br><span class="line">        <span class="keyword">return</span> authentication;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span>  <span class="title function_">authorizedUserAutoLogin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!PROBABILITY_DOUBLE_PREDICATE.test(ThreadLocalRandom.current().nextDouble()))&#123;</span><br><span class="line"><span class="comment">//            生成一个随机 数判断与 0.75 大小   如果大于0.75</span></span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> AUTHENTICATION_SUPPLIER.get();</span><br><span class="line">            authentication.setAuthenticated(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//            设置成已认证</span></span><br><span class="line">            addSession(authentication.getId());</span><br><span class="line"><span class="comment">//            添加一个session  为id</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">addSession</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sessions.size() &gt;= MAX_SESSIONS) &#123;</span><br><span class="line">            sessions.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sessions.add(sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getSessionsSize</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sessions.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.hijacksession.cas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Principal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Authentication</span> <span class="keyword">implements</span> <span class="title class_">Principal</span> &#123;</span><br><span class="line"><span class="comment">//    这里很明显继承了 Principal 那么应该是 AuthenticationProvider中的 T参数了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">authenticated</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Object credentials;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line"><span class="comment">//    可进行链式赋值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Authentication</span><span class="params">(<span class="type">boolean</span> authenticated, String name, Object credentials, String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.credentials = credentials;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="keyword">void</span> <span class="title function_">setAuthenticated</span><span class="params">(<span class="type">boolean</span> authenticated)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.authenticated = authenticated;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="AuthenticationProvider"><a href="#AuthenticationProvider" class="headerlink" title="AuthenticationProvider"></a>AuthenticationProvider</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.hijacksession.cas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Principal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="comment">//简单来说就是这个是标记是否符合接口的定义 这个接口必须只有一个抽象方法 目的是为了方便Lambda表达式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationProvider</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Principal</span> &gt;&#123;</span><br><span class="line"><span class="comment">//    这里其实不太能理解 推测并不是代表这个类去继承Principal 而是代表的这个T 参数是继承于Principal 但是写在了类上面造成了误解</span></span><br><span class="line"><span class="comment">//    其实可以把这里的T 理解成形参 实参在HijackSessionAuthenticationProvider传入</span></span><br><span class="line">    T <span class="title function_">authenticate</span><span class="params">(T t)</span>;</span><br><span class="line"><span class="comment">//    那么这里自然这个 t 参数类型就是代表着 必须继承自Principal</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>简单分析一下</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827203154209.png" alt="image-20220827203154209"></p>
<p>当第一次请求的时候cookie其实是空的</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827203533200.png" alt="image-20220827203533200"></p>
<p>先创建一个username 和 passwd 的authentication</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827203719088.png" alt="image-20220827203719088"></p>
<p>这里两个false  直接跳到下一个if里面 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828133534770.png" alt="image-20220828133534770"></p>
<p>调用的 GENERATE_SESSION_ID 去获取一个id </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828133632268.png" alt="image-20220828133632268"></p>
<p>这里的id 首先是一个静态的值 紧接着去自加一 与 当前时间戳进行拼接</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134048342.png" alt="image-20220828134048342"></p>
<p>这里需要注意的是 这里的 authentication 是这个 @23160 还有这个id 最后是657</p>
<p>紧接着跳到了authorizedUserAutoLogin()中去</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827203818440.png" alt="image-20220827203818440"></p>
<p>仔细看着一行 其实 这里是有一定概率才能进到这个if中的,原因就是这里的 数字是随机生成的 进入if的概率呢就是 0.25</p>
<p>因此我们在if里面下个断点然后不断重复请求进入if看看先</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134226576.png" alt="image-20220828134226576"></p>
<p>进来以后发现创建了一个 使用的是 AUTHENTICATION_SUPPLIER.get()创建了一个新的authentication </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828133124860.png" alt="image-20220828133124860"></p>
<p>因此就调到了这里面这里很明显示构建一个Authentication 但是这里的 id 其实是调用的 GENERATE_SESSION_ID 首先这里进行了id的自加一 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828133255565.png" alt="image-20220828133255565"></p>
<p>这里的id其实是静态的 因此 先自加后拼接当前时间戳</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134226576.png" alt="image-20220828134226576"></p>
<p>仔细看这里的 @23164 与 id 最后是236 这里其实出现了不同 那是由于我们下了断点导致执行时间出现了较大差异 假设我们不下断点的话 这两个值应该是相同的 我们可以做个简单的测试 后面会讲到</p>
<p>并将Authenticated赋值成了 true </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134536803.png" alt="image-20220828134536803"></p>
<p>接着进行了addSession操作 将当前的 authentication.getId() 进行了存入</p>
<p>但是这里还需要注意的是如果sessions 的数量大于50 就会移除</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134625719.png" alt="image-20220828134625719"></p>
<p>接着返回了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134710287.png" alt="image-20220828134710287"></p>
<p>回来之后的authentication是我们第一次的 @23160</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828102713506.png" alt="image-20220828102713506"></p>
<p>接着将这里的setcookie</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828134809977.png" alt="image-20220828134809977"></p>
<p>可以发现当cookie是空的时候会给请求设置一个cookie</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828102747572.png" alt="image-20220828102747572"></p>
<p>从这里我们也可以测试一下设置cookie的规律</p>
<p>我们只在return 这里下一个断点 </p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828135240545.png" alt="image-20220828135240545"></p>
<p>不断请求到截断到为止 这里发现后缀是235</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828135408612.png" alt="image-20220828135408612"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828135442335.png" alt="image-20220828135442335"></p>
<p>放行之后发现这里的后面时间戳其实是相同的 而只有前面由于自加一出现了差异</p>
<p>接着我们给cookie添加上去</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827204845082.png" alt="image-20220827204845082"></p>
<p>这里由于sessions 中没有包含我们的cookie 因此两个都是false</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220827205205113.png" alt="image-20220827205205113"></p>
<p>这里当然也能进来 不过这次生成的cookie并不会返回到页面上面</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828135916911.png" alt="image-20220828135916911"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828140003139.png" alt="image-20220828140003139"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828140028337.png" alt="image-20220828140028337"></p>
<p>到现在我们的思路就是先 使用 不带cookie的去请求获取得到的cookie 接着将得到的cookie 进行+1操作 因为实际存入到sessions中的其实是+过1的 接着使用这个cookie去请求</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828140933908.png" alt="image-20220828140933908"></p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828140941870.png" alt="image-20220828140941870"></p>
<h2 id="idor"><a href="#idor" class="headerlink" title="idor"></a>idor</h2><h3 id="IDOR"><a href="#IDOR" class="headerlink" title="IDOR"></a>IDOR</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.idor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Category;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.lessons.Lesson;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IDOR</span> <span class="keyword">extends</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Category <span class="title function_">getDefaultCategory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Category.A1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;idor.title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="IDORLogin"><a href="#IDORLogin" class="headerlink" title="IDORLogin"></a>IDORLogin</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wanan.webgoat.lessons.idor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentEndpoint;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AssignmentHints;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.assignments.AttackResult;</span><br><span class="line"><span class="keyword">import</span> com.wanan.webgoat.container.session.UserSessionData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AssignmentHints(&#123;&quot;idor.hints.idor_login&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IDORLogin</span> <span class="keyword">extends</span> <span class="title class_">AssignmentEndpoint</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Map&lt;String,String &gt;&gt; idorUserInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//    外面map用来存储用户  内部的map 用来存储用户的信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initIDORInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        idorUserInfo.put(<span class="string">&quot;tom&quot;</span>,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;());</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;tom&quot;</span>).put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;cat&quot;</span>);</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;tom&quot;</span>).put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;2342384&quot;</span>);</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;tom&quot;</span>).put(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;tom&quot;</span>).put(<span class="string">&quot;size&quot;</span>,<span class="string">&quot;small&quot;</span>);</span><br><span class="line"></span><br><span class="line">        idorUserInfo.put(<span class="string">&quot;bill&quot;</span>,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;());</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;bill&quot;</span>).put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;buffalo&quot;</span>);</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;bill&quot;</span>).put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;2342388&quot;</span>);</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;bill&quot;</span>).put(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;brown&quot;</span>);</span><br><span class="line">        idorUserInfo.get(<span class="string">&quot;bill&quot;</span>).put(<span class="string">&quot;size&quot;</span>,<span class="string">&quot;large&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/IDOR/login&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> AttackResult <span class="title function_">completed</span><span class="params">(<span class="meta">@RequestParam</span> String username,<span class="meta">@RequestParam</span> String password)</span>&#123;</span><br><span class="line">        initIDORInfo();</span><br><span class="line"><span class="comment">//        先进行用户的初始化</span></span><br><span class="line">        <span class="type">UserSessionData</span> <span class="variable">userSessionData</span> <span class="operator">=</span> getUserSessionData();</span><br><span class="line">        <span class="keyword">if</span> (idorUserInfo.containsKey(username))&#123;</span><br><span class="line"><span class="comment">//            如果idorUserInfo包含这个用户</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;tom&quot;</span>.equals(username) &amp;&amp; idorUserInfo.get(<span class="string">&quot;tom&quot;</span>).get(<span class="string">&quot;password&quot;</span>).equals(password))&#123;</span><br><span class="line">                userSessionData.setValue(<span class="string">&quot;idor-authenticated-as&quot;</span>,username);</span><br><span class="line">                userSessionData.setValue(<span class="string">&quot;idor-authenticated-user-id&quot;</span>,idorUserInfo.get(username).get(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                <span class="keyword">return</span> success(<span class="built_in">this</span>).feedback(<span class="string">&quot;idor.login.success&quot;</span>).feedbackArgs(username).build();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;idor.login.failure&quot;</span>).build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;idor.login.failure&quot;</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先看下UserSessionData</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828154959520.png" alt="image-20220828154959520"></p>
<p>这里也比较简单就是 一个map的简单功能</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828155228978.png" alt="image-20220828155228978"></p>
<p>这里只要登录就可过关了</p>
<p><img src="https://wanan-1310031509.cos.ap-beijing.myqcloud.com/image-20220828155303545.png" alt="image-20220828155303545"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a><a class="post-meta__tags" href="/tags/webgoat%E5%88%86%E6%9E%90/">webgoat分析</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.pixabay.com/photo/2016/04/20/19/47/wolves-1341881_1280.jpg" data-sites="qq,wechat,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/java/java/springboot/"><img class="prev-cover" src="https://cdn.pixabay.com/photo/2016/10/18/21/28/seljalandsfoss-1751463_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">springboot学习</div></div></a></div><div class="next-post pull-right"><a href="/misc/Misc/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cmisc/"><img class="next-cover" src="https://cdn.pixabay.com/photo/2018/08/23/07/35/thunderstorm-3625405_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">misc</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/java/java/RMI/" title="java的RMI协议"><img class="cover" src="https://cdn.pixabay.com/photo/2018/06/09/17/25/trees-3464777_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-30</div><div class="title">java的RMI协议</div></div></a></div><div><a href="/java/java/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="shiro反序列化"><img class="cover" src="https://cdn.pixabay.com/photo/2017/07/19/01/41/clouds-2517653_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-30</div><div class="title">shiro反序列化</div></div></a></div><div><a href="/java/java/codeql/" title="codeql"><img class="cover" src="https://cdn.pixabay.com/photo/2017/02/22/17/02/beach-2089936_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-30</div><div class="title">codeql</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85webgoat"><span class="toc-number">1.</span> <span class="toc-text">安装webgoat</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyWebGoat"><span class="toc-number">2.</span> <span class="toc-text">MyWebGoat</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server"><span class="toc-number">3.</span> <span class="toc-text">Server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#server-StartWebGoat"><span class="toc-number">3.1.</span> <span class="toc-text">server.StartWebGoat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container"><span class="toc-number">4.</span> <span class="toc-text">container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebGoat"><span class="toc-number">4.1.</span> <span class="toc-text">WebGoat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#users"><span class="toc-number">4.2.</span> <span class="toc-text">users</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebGoatUser"><span class="toc-number">4.2.1.</span> <span class="toc-text">WebGoatUser</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lessons"><span class="toc-number">4.3.</span> <span class="toc-text">lessons</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Assignment"><span class="toc-number">4.3.1.</span> <span class="toc-text">Assignment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lesson"><span class="toc-number">4.3.2.</span> <span class="toc-text">Lesson</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Category"><span class="toc-number">4.3.3.</span> <span class="toc-text">Category</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebSession"><span class="toc-number">4.3.4.</span> <span class="toc-text">WebSession</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session"><span class="toc-number">4.4.</span> <span class="toc-text">session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserSessionData"><span class="toc-number">4.4.1.</span> <span class="toc-text">UserSessionData</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webwolf"><span class="toc-number">5.</span> <span class="toc-text">webwolf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebWolf"><span class="toc-number">5.1.</span> <span class="toc-text">WebWolf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#requests"><span class="toc-number">5.2.</span> <span class="toc-text">requests</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebWolfTraceRepository"><span class="toc-number">5.2.1.</span> <span class="toc-text">WebWolfTraceRepository</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E5%BC%82%E5%B8%B8%E5%90%AF%E5%8A%A8"><span class="toc-number">6.</span> <span class="toc-text">修复异常启动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container-1"><span class="toc-number">7.</span> <span class="toc-text">container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MvcConfiguration"><span class="toc-number">7.1.</span> <span class="toc-text">MvcConfiguration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lessons-1"><span class="toc-number">7.2.</span> <span class="toc-text">lessons</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonScanner"><span class="toc-number">7.2.1.</span> <span class="toc-text">LessonScanner</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LessonTemplateResolver"><span class="toc-number">7.3.</span> <span class="toc-text">LessonTemplateResolver</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AsciiDoctorTemplateResolver-java"><span class="toc-number">7.4.</span> <span class="toc-text">AsciiDoctorTemplateResolver.java</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#asciidoc"><span class="toc-number">7.5.</span> <span class="toc-text">asciidoc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebWolfMacro"><span class="toc-number">7.5.1.</span> <span class="toc-text">WebWolfMacro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EnvironmentExposure"><span class="toc-number">7.5.2.</span> <span class="toc-text">EnvironmentExposure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebWolfRootMacro"><span class="toc-number">7.5.3.</span> <span class="toc-text">WebWolfRootMacro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebGoatVersionMacro"><span class="toc-number">7.5.4.</span> <span class="toc-text">WebGoatVersionMacro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebGoatTmpDirMacro"><span class="toc-number">7.5.5.</span> <span class="toc-text">WebGoatTmpDirMacro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OperatingSystemMacro"><span class="toc-number">7.5.6.</span> <span class="toc-text">OperatingSystemMacro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UsernameMacro"><span class="toc-number">7.5.7.</span> <span class="toc-text">UsernameMacro</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#i18n"><span class="toc-number">7.6.</span> <span class="toc-text">i18n</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PluginMessages"><span class="toc-number">7.6.1.</span> <span class="toc-text">PluginMessages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Language"><span class="toc-number">7.6.2.</span> <span class="toc-text">Language</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Messages"><span class="toc-number">7.6.3.</span> <span class="toc-text">Messages</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session-1"><span class="toc-number">7.7.</span> <span class="toc-text">session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LabelDebugger"><span class="toc-number">7.7.1.</span> <span class="toc-text">LabelDebugger</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%AF%95%E4%B8%80%E4%B8%8B"><span class="toc-number">8.</span> <span class="toc-text">启动试一下</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container-2"><span class="toc-number">9.</span> <span class="toc-text">container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebSecurityConfig"><span class="toc-number">9.1.</span> <span class="toc-text">WebSecurityConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#users-1"><span class="toc-number">9.2.</span> <span class="toc-text">users</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserService"><span class="toc-number">9.2.1.</span> <span class="toc-text">UserService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserRepository"><span class="toc-number">9.2.2.</span> <span class="toc-text">UserRepository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserTrackerRepository"><span class="toc-number">9.2.3.</span> <span class="toc-text">UserTrackerRepository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserTracker"><span class="toc-number">9.2.4.</span> <span class="toc-text">UserTracker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonTracker"><span class="toc-number">9.2.5.</span> <span class="toc-text">LessonTracker</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AjaxAuthenticationEntryPoint"><span class="toc-number">9.3.</span> <span class="toc-text">AjaxAuthenticationEntryPoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lessons-2"><span class="toc-number">9.4.</span> <span class="toc-text">lessons</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Initializeable"><span class="toc-number">9.4.1.</span> <span class="toc-text">Initializeable</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DatabaseConfiguration"><span class="toc-number">9.5.</span> <span class="toc-text">DatabaseConfiguration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LessonDataSource"><span class="toc-number">9.6.</span> <span class="toc-text">LessonDataSource</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lessons-3"><span class="toc-number">9.7.</span> <span class="toc-text">lessons</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonConnectionInvocationHandler"><span class="toc-number">9.7.1.</span> <span class="toc-text">LessonConnectionInvocationHandler</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%8B"><span class="toc-number">10.</span> <span class="toc-text">启动一下</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BAmysql"><span class="toc-number">11.</span> <span class="toc-text">更改数据库为mysql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#server"><span class="toc-number">12.</span> <span class="toc-text">server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#StartWebGoat"><span class="toc-number">12.1.</span> <span class="toc-text">StartWebGoat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container-3"><span class="toc-number">13.</span> <span class="toc-text">container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HammerHead"><span class="toc-number">13.1.</span> <span class="toc-text">HammerHead</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session-2"><span class="toc-number">13.2.</span> <span class="toc-text">session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Course"><span class="toc-number">13.2.1.</span> <span class="toc-text">Course</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#assignments"><span class="toc-number">13.3.</span> <span class="toc-text">assignments</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AssignmentHints"><span class="toc-number">13.3.1.</span> <span class="toc-text">AssignmentHints</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AssignmentPath"><span class="toc-number">13.3.2.</span> <span class="toc-text">AssignmentPath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AssignmentEndpoint"><span class="toc-number">13.3.3.</span> <span class="toc-text">AssignmentEndpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AttackResult"><span class="toc-number">13.3.4.</span> <span class="toc-text">AttackResult</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonTrackerInterceptor"><span class="toc-number">13.3.5.</span> <span class="toc-text">LessonTrackerInterceptor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#controller"><span class="toc-number">13.4.</span> <span class="toc-text">controller</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Welcome"><span class="toc-number">13.4.1.</span> <span class="toc-text">Welcome</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#StartLesson"><span class="toc-number">13.4.2.</span> <span class="toc-text">StartLesson</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lessons-4"><span class="toc-number">13.5.</span> <span class="toc-text">lessons</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CourseConfiguration"><span class="toc-number">13.5.1.</span> <span class="toc-text">CourseConfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hint"><span class="toc-number">13.5.2.</span> <span class="toc-text">Hint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonInfoModel"><span class="toc-number">13.5.3.</span> <span class="toc-text">LessonInfoModel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonMenuItem"><span class="toc-number">13.5.4.</span> <span class="toc-text">LessonMenuItem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonMenuItemType"><span class="toc-number">13.5.5.</span> <span class="toc-text">LessonMenuItemType</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebWolfRedirect"><span class="toc-number">13.6.</span> <span class="toc-text">WebWolfRedirect</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webwolf-1"><span class="toc-number">14.</span> <span class="toc-text">webwolf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#user"><span class="toc-number">14.1.</span> <span class="toc-text">user</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserService-1"><span class="toc-number">14.1.1.</span> <span class="toc-text">UserService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserRepository-1"><span class="toc-number">14.1.2.</span> <span class="toc-text">UserRepository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebGoatUser-1"><span class="toc-number">14.1.3.</span> <span class="toc-text">WebGoatUser</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebSecurityConfig-1"><span class="toc-number">14.2.</span> <span class="toc-text">WebSecurityConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MvcConfiguration-1"><span class="toc-number">14.3.</span> <span class="toc-text">MvcConfiguration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#requests-1"><span class="toc-number">14.4.</span> <span class="toc-text">requests</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Requests"><span class="toc-number">14.4.1.</span> <span class="toc-text">Requests</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LandingPage"><span class="toc-number">14.4.2.</span> <span class="toc-text">LandingPage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FileServer"><span class="toc-number">14.5.</span> <span class="toc-text">FileServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mailbox"><span class="toc-number">14.6.</span> <span class="toc-text">mailbox</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Email"><span class="toc-number">14.6.1.</span> <span class="toc-text">Email</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MailboxController"><span class="toc-number">14.6.2.</span> <span class="toc-text">MailboxController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MailboxRepository"><span class="toc-number">14.6.3.</span> <span class="toc-text">MailboxRepository</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jwt"><span class="toc-number">14.7.</span> <span class="toc-text">jwt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWTController"><span class="toc-number">14.7.1.</span> <span class="toc-text">JWTController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWTToken"><span class="toc-number">14.7.2.</span> <span class="toc-text">JWTToken</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resources"><span class="toc-number">14.8.</span> <span class="toc-text">resources</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container-4"><span class="toc-number">15.</span> <span class="toc-text">container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#service"><span class="toc-number">15.1.</span> <span class="toc-text">service</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EnvironmentService"><span class="toc-number">15.1.1.</span> <span class="toc-text">EnvironmentService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HintService"><span class="toc-number">15.1.2.</span> <span class="toc-text">HintService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LabelDebugService"><span class="toc-number">15.1.3.</span> <span class="toc-text">LabelDebugService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LabelService"><span class="toc-number">15.1.4.</span> <span class="toc-text">LabelService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonInfoService"><span class="toc-number">15.1.5.</span> <span class="toc-text">LessonInfoService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonMenuService"><span class="toc-number">15.1.6.</span> <span class="toc-text">LessonMenuService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonProgressService"><span class="toc-number">15.1.7.</span> <span class="toc-text">LessonProgressService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonTitleService"><span class="toc-number">15.1.8.</span> <span class="toc-text">LessonTitleService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReportCardService"><span class="toc-number">15.1.9.</span> <span class="toc-text">ReportCardService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RestartLessonService"><span class="toc-number">15.1.10.</span> <span class="toc-text">RestartLessonService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SessionService"><span class="toc-number">15.1.11.</span> <span class="toc-text">SessionService</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#users-2"><span class="toc-number">15.2.</span> <span class="toc-text">users</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RegistrationController"><span class="toc-number">15.2.1.</span> <span class="toc-text">RegistrationController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserValidator"><span class="toc-number">15.2.2.</span> <span class="toc-text">UserValidator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserForm"><span class="toc-number">15.2.3.</span> <span class="toc-text">UserForm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scoreboard"><span class="toc-number">15.2.4.</span> <span class="toc-text">Scoreboard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserSession"><span class="toc-number">15.2.5.</span> <span class="toc-text">UserSession</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lessons-5"><span class="toc-number">16.</span> <span class="toc-text">lessons</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#webgoat-introduction"><span class="toc-number">16.1.</span> <span class="toc-text">webgoat_introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebGoatIntroduction"><span class="toc-number">16.1.1.</span> <span class="toc-text">WebGoatIntroduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%94%99"><span class="toc-number">16.1.2.</span> <span class="toc-text">排错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90"><span class="toc-number">16.1.3.</span> <span class="toc-text">解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webwolf-introduction"><span class="toc-number">16.2.</span> <span class="toc-text">webwolf_introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebWolfIntroduction"><span class="toc-number">16.2.1.</span> <span class="toc-text">WebWolfIntroduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MailAssignment"><span class="toc-number">16.2.2.</span> <span class="toc-text">MailAssignment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Email-1"><span class="toc-number">16.2.3.</span> <span class="toc-text">Email</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%94%99-1"><span class="toc-number">16.2.4.</span> <span class="toc-text">排错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E4%B8%BAhsqldb%E5%B9%B6%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%E6%9F%A5%E7%9C%8B"><span class="toc-number">16.2.5.</span> <span class="toc-text">更换为hsqldb并进行连接查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LandingAssignment"><span class="toc-number">16.2.6.</span> <span class="toc-text">LandingAssignment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http-basics"><span class="toc-number">16.3.</span> <span class="toc-text">http_basics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpBasics"><span class="toc-number">16.3.1.</span> <span class="toc-text">HttpBasics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpBasicsLesson"><span class="toc-number">16.3.2.</span> <span class="toc-text">HttpBasicsLesson</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpBasicsQuiz"><span class="toc-number">16.3.3.</span> <span class="toc-text">HttpBasicsQuiz</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http-proxies"><span class="toc-number">16.4.</span> <span class="toc-text">http_proxies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpProxies"><span class="toc-number">16.4.1.</span> <span class="toc-text">HttpProxies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpBasicsInterceptRequest"><span class="toc-number">16.4.2.</span> <span class="toc-text">HttpBasicsInterceptRequest</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chrome-dev-tools"><span class="toc-number">16.5.</span> <span class="toc-text">chrome_dev_tools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ChromeDevTools"><span class="toc-number">16.5.1.</span> <span class="toc-text">ChromeDevTools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chrome-dev-tools-1"><span class="toc-number">16.6.</span> <span class="toc-text">chrome_dev_tools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NetworkDummy"><span class="toc-number">16.6.1.</span> <span class="toc-text">NetworkDummy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xss"><span class="toc-number">16.6.1.1.</span> <span class="toc-text">xss</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#DOMCrossSiteScripting"><span class="toc-number">16.6.1.1.1.</span> <span class="toc-text">DOMCrossSiteScripting</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NetworkLesson"><span class="toc-number">16.6.2.</span> <span class="toc-text">NetworkLesson</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cia"><span class="toc-number">16.7.</span> <span class="toc-text">cia</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CIA"><span class="toc-number">16.7.1.</span> <span class="toc-text">CIA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CIAQuiz"><span class="toc-number">16.7.2.</span> <span class="toc-text">CIAQuiz</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson-template"><span class="toc-number">16.8.</span> <span class="toc-text">lesson_template</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LessonTemplate"><span class="toc-number">16.8.1.</span> <span class="toc-text">LessonTemplate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SampleAttack"><span class="toc-number">16.8.2.</span> <span class="toc-text">SampleAttack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hijacksession"><span class="toc-number">16.9.</span> <span class="toc-text">hijacksession</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HijackSession"><span class="toc-number">16.9.1.</span> <span class="toc-text">HijackSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HijackSessionAssignment"><span class="toc-number">16.9.2.</span> <span class="toc-text">HijackSessionAssignment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cas"><span class="toc-number">16.9.3.</span> <span class="toc-text">cas</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HijackSessionAuthenticationProvider"><span class="toc-number">16.9.3.1.</span> <span class="toc-text">HijackSessionAuthenticationProvider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Authentication"><span class="toc-number">16.9.3.2.</span> <span class="toc-text">Authentication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AuthenticationProvider"><span class="toc-number">16.9.3.3.</span> <span class="toc-text">AuthenticationProvider</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#idor"><span class="toc-number">16.10.</span> <span class="toc-text">idor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IDOR"><span class="toc-number">16.10.1.</span> <span class="toc-text">IDOR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IDORLogin"><span class="toc-number">16.10.2.</span> <span class="toc-text">IDORLogin</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By wanan</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'RjFSSKpeg1lxuvDjmLndzaLO-MdYXbMMI',
      appKey: '8qrAyIwMaJTebKjjzPnV0SFT',
      avatar: 'monsterid',
      serverURLs: 'https://valine.wanan.red',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://www.wanan.red/java/java/webgoat/'
    this.page.identifier = '/java/java/webgoat/'
    this.page.title = 'webgoat分析'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://www-wanan-red.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script>(function(d, w, c) {
    w.ChatraID = 'LAbfxFAsFCbvYgjHY';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>